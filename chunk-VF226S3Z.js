import{a as G}from"./chunk-5MZUWGRQ.js";import{a as I}from"./chunk-G5DRJZ63.js";import{e as R}from"./chunk-E7GKI5ZX.js";import{a as O,b as M,d as U,g as h}from"./chunk-D7E25M7D.js";import{K as T,y as x}from"./chunk-UB6LWR2H.js";import{a as b}from"./chunk-FIS22N7N.js";import{a as D}from"./chunk-PTJ4CXVK.js";var p=new h,S=new h,P=new h,d={getScene:()=>{},eyeAtCamera:!0};function N(t,r,e){let a=e.asArray(),l=r.asArray();for(let i=0;i<16;i++)a[i]=l[i];return a[12]-=t.x,a[13]-=t.y,a[14]-=t.z,e.markAsUpdated(),e}function y(t,r,e){return M(r,S),N(t,S,P),M(P,e),e}function F(t,r,e){if(!d.eyeAtCamera)return y(t,r,e);let a=e.asArray(),l=r.asArray();for(let i=0;i<16;i++)a[i]=l[i];return a[12]=0,a[13]=0,a[14]=0,e.markAsUpdated(),e}function g(t,r,e,a){return O(F(t,r,a),e,a),a}function ne(t,r,e,a,l){for(let i=0;i<a;++i)z(t,r[i],e[i],S),S.copyToArray(l,i*16);return l}function v(t,r,e,a){return M(e,S),O(r,S,P),N(t,P,S),F(t,e,P),O(S,P,a),a}function z(t,r,e,a){return y(t,r,P),O(P,e,a),a}function B(t,r,e,a,l,i){return M(e,S),O(r,S,P),N(t,P,S),g(t,a,l,P),O(S,P,i),i}function V(t,r){let e=d.getScene();if(!e||p===r)return r;p.updateFlag=r.updateFlag;let a=e.floatingOriginOffset;switch(t){case"world":return N(a,r,p);case"view":return F(a,r,p);case"worldView":return v(a,r,e.getViewMatrix(),p);case"viewProjection":return g(a,e.getViewMatrix(),e.getProjectionMatrix(),p);case"worldViewProjection":return B(a,r,e.getTransformMatrix(),e.getViewMatrix(),e.getProjectionMatrix(),p);default:if(t.startsWith("u_")){if(t.startsWith("u_WorldViewProjection"))return B(a,r,e.getTransformMatrix(),e.getViewMatrix(),e.getProjectionMatrix(),p);if(t.startsWith("u_ViewProjection"))return g(a,e.getViewMatrix(),e.getProjectionMatrix(),p);if(t.startsWith("u_WorldView"))return v(a,r,e.getViewMatrix(),p);if(t.startsWith("u_World"))return N(a,r,p);if(t.startsWith("u_View"))return F(a,r,p)}return r}}var f=G,m=x,X=f.prototype._updateMatrixForUniform,W=x.prototype.setMatrix;function oe(){x.prototype.setMatrix=W,m._setMatrixOverride=void 0,f.prototype._updateMatrixForUniform=X,f.prototype._updateMatrixForUniformOverride=void 0}function se(){m.prototype._setMatrixOverride=W,m.prototype.setMatrix=function(t,r){return this._setMatrixOverride(t,V(t,r)),this},f.prototype._updateMatrixForUniformOverride=X,f.prototype._updateMatrixForUniform=function(t,r){this._updateMatrixForUniformOverride(t,V(t,r))}}function ce(t){t.indexOf("vClipPlane")===-1&&t.push("vClipPlane"),t.indexOf("vClipPlane2")===-1&&t.push("vClipPlane2"),t.indexOf("vClipPlane3")===-1&&t.push("vClipPlane3"),t.indexOf("vClipPlane4")===-1&&t.push("vClipPlane4"),t.indexOf("vClipPlane5")===-1&&t.push("vClipPlane5"),t.indexOf("vClipPlane6")===-1&&t.push("vClipPlane6")}function Re(t,r,e){let a=!!(t.clipPlane??r.clipPlane),l=!!(t.clipPlane2??r.clipPlane2),i=!!(t.clipPlane3??r.clipPlane3),E=!!(t.clipPlane4??r.clipPlane4),n=!!(t.clipPlane5??r.clipPlane5),u=!!(t.clipPlane6??r.clipPlane6);a&&e.push("#define CLIPPLANE"),l&&e.push("#define CLIPPLANE2"),i&&e.push("#define CLIPPLANE3"),E&&e.push("#define CLIPPLANE4"),n&&e.push("#define CLIPPLANE5"),u&&e.push("#define CLIPPLANE6")}function k(t,r,e){let a=!1,l=!!(t.clipPlane??r.clipPlane),i=!!(t.clipPlane2??r.clipPlane2),E=!!(t.clipPlane3??r.clipPlane3),n=!!(t.clipPlane4??r.clipPlane4),u=!!(t.clipPlane5??r.clipPlane5),c=!!(t.clipPlane6??r.clipPlane6);return e.CLIPPLANE!==l&&(e.CLIPPLANE=l,a=!0),e.CLIPPLANE2!==i&&(e.CLIPPLANE2=i,a=!0),e.CLIPPLANE3!==E&&(e.CLIPPLANE3=E,a=!0),e.CLIPPLANE4!==n&&(e.CLIPPLANE4=n,a=!0),e.CLIPPLANE5!==u&&(e.CLIPPLANE5=u,a=!0),e.CLIPPLANE6!==c&&(e.CLIPPLANE6=c,a=!0),a}function pe(t,r,e){let a=r.clipPlane??e.clipPlane;L(t,"vClipPlane",a),a=r.clipPlane2??e.clipPlane2,L(t,"vClipPlane2",a),a=r.clipPlane3??e.clipPlane3,L(t,"vClipPlane3",a),a=r.clipPlane4??e.clipPlane4,L(t,"vClipPlane4",a),a=r.clipPlane5??e.clipPlane5,L(t,"vClipPlane5",a),a=r.clipPlane6??e.clipPlane6,L(t,"vClipPlane6",a)}function L(t,r,e){if(e){let a=d.getScene()?.floatingOriginOffset||U.ZeroReadOnly;t.setFloat4(r,e.normal.x,e.normal.y,e.normal.z,e.d+U.Dot(e.normal,a))}}var H=(()=>{class t{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(e){this._BaseWeightTextureEnabled!==e&&(this._BaseWeightTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(e){this._BaseDiffuseRoughnessTextureEnabled!==e&&(this._BaseDiffuseRoughnessTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(e){this._DetailTextureEnabled!==e&&(this._DetailTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(e){this._DecalMapEnabled!==e&&(this._DecalMapEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,T.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(e){this._RefractionIntensityTextureEnabled!==e&&(this._RefractionIntensityTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(e){this._TranslucencyIntensityTextureEnabled!==e&&(this._TranslucencyIntensityTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(e){this._TranslucencyColorTextureEnabled!==e&&(this._TranslucencyColorTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(e){this._IridescenceTextureEnabled!==e&&(this._IridescenceTextureEnabled=e,T.MarkAllMaterialsAsDirty(1))}}return t._DiffuseTextureEnabled=!0,t._BaseWeightTextureEnabled=!0,t._BaseDiffuseRoughnessTextureEnabled=!0,t._DetailTextureEnabled=!0,t._DecalMapEnabled=!0,t._AmbientTextureEnabled=!0,t._OpacityTextureEnabled=!0,t._ReflectionTextureEnabled=!0,t._EmissiveTextureEnabled=!0,t._SpecularTextureEnabled=!0,t._BumpTextureEnabled=!0,t._LightmapTextureEnabled=!0,t._RefractionTextureEnabled=!0,t._ColorGradingTextureEnabled=!0,t._FresnelEnabled=!0,t._ClearCoatTextureEnabled=!0,t._ClearCoatBumpTextureEnabled=!0,t._ClearCoatTintTextureEnabled=!0,t._SheenTextureEnabled=!0,t._AnisotropicTextureEnabled=!0,t._ThicknessTextureEnabled=!0,t._RefractionIntensityTextureEnabled=!0,t._TranslucencyIntensityTextureEnabled=!0,t._TranslucencyColorTextureEnabled=!0,t._IridescenceTextureEnabled=!0,t})();function Ce(t,r,e){if(!t||t.LOGARITHMICDEPTH||t.indexOf&&t.indexOf("LOGARITHMICDEPTH")>=0){let a=e.activeCamera;a.mode===1&&D.Error("Logarithmic depth is not compatible with orthographic cameras!",20),r.setFloat("logarithmicDepthConstant",2/(Math.log(a.maxZ+1)/Math.LN2))}}var w={r:0,g:0,b:0},C={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function Ue(t,r,e,a=!1){e&&t.fogEnabled&&(!r||r.applyFog)&&t.fogMode!==0&&(e.setFloat4("vFogInfos",t.fogMode,t.fogStart,t.fogEnd,t.fogDensity),a?(t.fogColor.toLinearSpaceToRef(w,t.getEngine().useExactSrgbConversions),e.setColor3("vFogColor",w)):e.setColor3("vFogColor",t.fogColor))}function he(t,r,e,a,l,i,E,n,u,c){let s=t.numMaxInfluencers||t.numInfluencers;return s<=0?0:(r.push("#define MORPHTARGETS"),t.hasPositions&&r.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),t.hasNormals&&r.push("#define MORPHTARGETTEXTURE_HASNORMALS"),t.hasTangents&&r.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),t.hasUVs&&r.push("#define MORPHTARGETTEXTURE_HASUVS"),t.hasUV2s&&r.push("#define MORPHTARGETTEXTURE_HASUV2S"),t.hasColors&&r.push("#define MORPHTARGETTEXTURE_HASCOLORS"),t.supportsPositions&&l&&r.push("#define MORPHTARGETS_POSITION"),t.supportsNormals&&i&&r.push("#define MORPHTARGETS_NORMAL"),t.supportsTangents&&E&&r.push("#define MORPHTARGETS_TANGENT"),t.supportsUVs&&n&&r.push("#define MORPHTARGETS_UV"),t.supportsUV2s&&u&&r.push("#define MORPHTARGETS_UV2"),t.supportsColors&&c&&r.push("#define MORPHTARGETS_COLOR"),r.push("#define NUM_MORPH_INFLUENCERS "+s),t.isUsingTextureForTargets&&r.push("#define MORPHTARGETS_TEXTURE"),C.NUM_MORPH_INFLUENCERS=s,C.NORMAL=i,C.TANGENT=E,C.UV=n,C.UV2=u,C.COLOR=c,Y(e,a,C,l),s)}function Y(t,r,e,a=!0){let l=e.NUM_MORPH_INFLUENCERS;if(l>0&&b.LastCreatedEngine){let i=b.LastCreatedEngine.getCaps().maxVertexAttribs,E=r.morphTargetManager;if(E?.isUsingTextureForTargets)return;let n=E&&E.supportsPositions&&a,u=E&&E.supportsNormals&&e.NORMAL,c=E&&E.supportsTangents&&e.TANGENT,s=E&&E.supportsUVs&&e.UV1,_=E&&E.supportsUV2s&&e.UV2,o=E&&E.supportsColors&&e.VERTEXCOLOR;for(let A=0;A<l;A++)n&&t.push("position"+A),u&&t.push("normal"+A),c&&t.push("tangent"+A),s&&t.push("uv_"+A),_&&t.push("uv2_"+A),o&&t.push("color"+A),t.length>i&&D.Error("Cannot add more vertex attributes for mesh "+r.name)}}function Z(t,r=!1){t.push("world0"),t.push("world1"),t.push("world2"),t.push("world3"),r&&(t.push("previousWorld0"),t.push("previousWorld1"),t.push("previousWorld2"),t.push("previousWorld3"))}function Fe(t,r){let e=t.morphTargetManager;!t||!e||r.setFloatArray("morphTargetInfluences",e.influences)}function de(t,r){r.bindToEffect(t,"Scene")}function He(t,r,e,a,l=null,i=!1,E=!1,n=!1,u=!1,c=!1,s=!1,_=0){if(t.texturesEnabled&&l&&H.ReflectionTextureEnabled){if(e.updateMatrix("reflectionMatrix",l.getReflectionTextureMatrix()),e.updateFloat2("vReflectionInfos",l.level*t.iblIntensity,_),n&&l.boundingBoxSize){let o=l;e.updateVector3("vReflectionPosition",o.boundingBoxPosition),e.updateVector3("vReflectionSize",o.boundingBoxSize)}if(i){let o=l.getSize().width;e.updateFloat2("vReflectionFilteringInfo",o,Math.log2(o))}if(c&&!r.USEIRRADIANCEMAP){let o=l.sphericalPolynomial;if(r.USESPHERICALFROMREFLECTIONMAP&&o)if(r.SPHERICAL_HARMONICS){let A=o.preScaledHarmonics;e.updateVector3("vSphericalL00",A.l00),e.updateVector3("vSphericalL1_1",A.l1_1),e.updateVector3("vSphericalL10",A.l10),e.updateVector3("vSphericalL11",A.l11),e.updateVector3("vSphericalL2_2",A.l2_2),e.updateVector3("vSphericalL2_1",A.l2_1),e.updateVector3("vSphericalL20",A.l20),e.updateVector3("vSphericalL21",A.l21),e.updateVector3("vSphericalL22",A.l22)}else e.updateFloat3("vSphericalX",o.x.x,o.x.y,o.x.z),e.updateFloat3("vSphericalY",o.y.x,o.y.y,o.y.z),e.updateFloat3("vSphericalZ",o.z.x,o.z.y,o.z.z),e.updateFloat3("vSphericalXX_ZZ",o.xx.x-o.zz.x,o.xx.y-o.zz.y,o.xx.z-o.zz.z),e.updateFloat3("vSphericalYY_ZZ",o.yy.x-o.zz.x,o.yy.y-o.zz.y,o.yy.z-o.zz.z),e.updateFloat3("vSphericalZZ",o.zz.x,o.zz.y,o.zz.z),e.updateFloat3("vSphericalXY",o.xy.x,o.xy.y,o.xy.z),e.updateFloat3("vSphericalYZ",o.yz.x,o.yz.y,o.yz.z),e.updateFloat3("vSphericalZX",o.zx.x,o.zx.y,o.zx.z)}else u&&r.USEIRRADIANCEMAP&&r.USE_IRRADIANCE_DOMINANT_DIRECTION&&e.updateVector3("vReflectionDominantDirection",l.irradianceTexture._dominantDirection);E&&e.updateFloat3("vReflectionMicrosurfaceInfos",l.getSize().width,l.lodGenerationScale,l.lodGenerationOffset)}s&&e.updateColor3("vReflectionColor",a)}function be(t,r,e,a=null,l=!1){if(a&&H.ReflectionTextureEnabled){r.LODBASEDMICROSFURACE?e.setTexture("reflectionSampler",a):(e.setTexture("reflectionSampler",a._lodTextureMid||a),e.setTexture("reflectionSamplerLow",a._lodTextureLow||a),e.setTexture("reflectionSamplerHigh",a._lodTextureHigh||a)),r.USEIRRADIANCEMAP&&e.setTexture("irradianceSampler",a.irradianceTexture);let i=t.iblCdfGenerator;l&&i&&e.setTexture("icdfSampler",i.getIcdfTexture())}}function ge(t,r,e){r._needUVs=!0,r[e]=!0,t.optimizeUVAllocation&&t.getTextureMatrix().isIdentityAs3x2()?(r[e+"DIRECTUV"]=t.coordinatesIndex+1,r["MAINUV"+(t.coordinatesIndex+1)]=!0):r[e+"DIRECTUV"]=0}function me(t,r,e){let a=t.getTextureMatrix();r.updateMatrix(e+"Matrix",a)}function Ge(t,r,e){e.BAKED_VERTEX_ANIMATION_TEXTURE&&e.INSTANCES&&t.push("bakedVertexAnimationSettingsInstanced")}function Q(t,r){return r.set(t),r}function ve(t,r,e){if(!(!r||!t)&&(t.computeBonesUsingShaders&&r._bonesComputationForcedToCPU&&(t.computeBonesUsingShaders=!1),t.useBones&&t.computeBonesUsingShaders&&t.skeleton)){let a=t.skeleton;if(a.isUsingTextureForMatrices&&r.getUniformIndex("boneTextureWidth")>-1){let l=a.getTransformMatrixTexture(t);r.setTexture("boneSampler",l),r.setFloat("boneTextureWidth",4*(a.bones.length+1))}else{let l=a.getTransformMatrices(t);l&&(r.setMatrices("mBones",l),e&&t.getScene().prePassRenderer&&t.getScene().prePassRenderer.getIndex(2)&&(e.previousBones[t.uniqueId]||(e.previousBones[t.uniqueId]=l.slice()),r.setMatrices("mPreviousBones",e.previousBones[t.uniqueId]),Q(l,e.previousBones[t.uniqueId])))}}}function j(t,r,e,a,l,i=!0){t._bindLight(r,e,a,l,i)}function Be(t,r,e,a,l=4){let i=Math.min(r.lightSources.length,l);for(let E=0;E<i;E++){let n=r.lightSources[E];j(n,E,t,e,typeof a=="boolean"?a:a.SPECULARTERM,r.receiveShadows)}}function Ve(t,r,e,a){e.NUM_BONE_INFLUENCERS>0&&(a.addCPUSkinningFallback(0,r),t.push("matricesIndices"),t.push("matricesWeights"),e.NUM_BONE_INFLUENCERS>4&&(t.push("matricesIndicesExtra"),t.push("matricesWeightsExtra")))}function ye(t,r){(r.INSTANCES||r.THIN_INSTANCES)&&Z(t,!!r.PREPASS_VELOCITY),r.INSTANCESCOLOR&&t.push("instanceColor")}function Xe(t,r,e=4,a=0){let l=0;for(let i=0;i<e&&t["LIGHT"+i];i++)i>0&&(l=a+i,r.addFallback(l,"LIGHT"+i)),t.SHADOWS||(t["SHADOW"+i]&&r.addFallback(a,"SHADOW"+i),t["SHADOWPCF"+i]&&r.addFallback(a,"SHADOWPCF"+i),t["SHADOWPCSS"+i]&&r.addFallback(a,"SHADOWPCSS"+i),t["SHADOWPOISSON"+i]&&r.addFallback(a,"SHADOWPOISSON"+i),t["SHADOWESM"+i]&&r.addFallback(a,"SHADOWESM"+i),t["SHADOWCLOSEESM"+i]&&r.addFallback(a,"SHADOWCLOSEESM"+i));return l++}function K(t,r){return r.fogEnabled&&t.applyFog&&r.fogMode!==0}function We(t,r,e,a,l,i,E,n=!1,u=!1,c,s){if(E._areMiscDirty){E.LOGARITHMICDEPTH=e,E.POINTSIZE=a,E.FOG=l&&K(t,r),E.NONUNIFORMSCALING=t.nonUniformScaling,E.ALPHATEST=i,E.DECAL_AFTER_DETAIL=n,E.USE_VERTEX_PULLING=u;let _=c?.geometry?.getIndexBuffer();E.VERTEX_PULLING_USE_INDEX_BUFFER=!!_,E.VERTEX_PULLING_INDEX_BUFFER_32BITS=_?_.is32Bits:!1,E.VERTEXOUTPUT_INVARIANT=!!s}}function ke(t,r,e,a,l=4,i=!1){if(!e._areLightsDirty)return e._needNormals;let E=0,n={needNormals:e._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(t.lightsEnabled&&!i){for(let s of r.lightSources)if(q(t,r,s,E,e,a,n),E++,E===l)break}e.SPECULARTERM=n.specularEnabled,e.SHADOWS=n.shadowEnabled;let u=Math.max(l,e.MAXLIGHTCOUNT||0);for(let s=E;s<u;s++)e["LIGHT"+s]!==void 0&&(e["LIGHT"+s]=!1,e["HEMILIGHT"+s]=!1,e["POINTLIGHT"+s]=!1,e["DIRLIGHT"+s]=!1,e["SPOTLIGHT"+s]=!1,e["AREALIGHT"+s]=!1,e["CLUSTLIGHT"+s]=!1,e["SHADOW"+s]=!1,e["SHADOWCSM"+s]=!1,e["SHADOWCSMDEBUG"+s]=!1,e["SHADOWCSMNUM_CASCADES"+s]=!1,e["SHADOWCSMUSESHADOWMAXZ"+s]=!1,e["SHADOWCSMNOBLEND"+s]=!1,e["SHADOWCSM_RIGHTHANDED"+s]=!1,e["SHADOWPCF"+s]=!1,e["SHADOWPCSS"+s]=!1,e["SHADOWPOISSON"+s]=!1,e["SHADOWESM"+s]=!1,e["SHADOWCLOSEESM"+s]=!1,e["SHADOWCUBE"+s]=!1,e["SHADOWLOWQUALITY"+s]=!1,e["SHADOWMEDIUMQUALITY"+s]=!1);e.MAXLIGHTCOUNT=l;let c=t.getEngine().getCaps();return e.SHADOWFLOAT===void 0&&(n.needRebuild=!0),e.SHADOWFLOAT=n.shadowEnabled&&(c.textureFloatRender&&c.textureFloatLinearFiltering||c.textureHalfFloatRender&&c.textureHalfFloatLinearFiltering),e.LIGHTMAPEXCLUDED=n.lightmapMode,n.needRebuild&&e.rebuild(),n.needNormals}function we(t,r,e,a=!1,l=8,i=!1){if(r&&H.ReflectionTextureEnabled){if(!r.isReadyOrNotBlocking())return!1;e._needNormals=!0,e.REFLECTION=!0,e.GAMMAREFLECTION=r.gammaSpace,e.RGBDREFLECTION=r.isRGBD,e.LODINREFLECTIONALPHA=r.lodLevelInAlpha,e.LINEARSPECULARREFLECTION=r.linearSpecularLOD,e.USEIRRADIANCEMAP=!1;let E=t.getEngine();switch(a&&l>0?(e.NUM_SAMPLES=""+l,E._features.needTypeSuffixInShaderConstants&&(e.NUM_SAMPLES=e.NUM_SAMPLES+"u"),e.REALTIME_FILTERING=!0,t.iblCdfGenerator&&(e.IBL_CDF_FILTERING=!0)):e.REALTIME_FILTERING=!1,e.INVERTCUBICMAP=r.coordinatesMode===R.INVCUBIC_MODE,e.REFLECTIONMAP_3D=r.isCube,e.REFLECTIONMAP_OPPOSITEZ=e.REFLECTIONMAP_3D&&t.useRightHandedSystem?!r.invertZ:r.invertZ,e.REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,r.coordinatesMode){case R.EXPLICIT_MODE:e.REFLECTIONMAP_EXPLICIT=!0;break;case R.PLANAR_MODE:e.REFLECTIONMAP_PLANAR=!0;break;case R.PROJECTION_MODE:e.REFLECTIONMAP_PROJECTION=!0;break;case R.SKYBOX_MODE:e.REFLECTIONMAP_SKYBOX=!0;break;case R.SPHERICAL_MODE:e.REFLECTIONMAP_SPHERICAL=!0;break;case R.EQUIRECTANGULAR_MODE:e.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case R.FIXED_EQUIRECTANGULAR_MODE:e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case R.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case R.CUBIC_MODE:case R.INVCUBIC_MODE:default:e.REFLECTIONMAP_CUBIC=!0,e.USE_LOCAL_REFLECTIONMAP_CUBIC=!!r.boundingBoxSize;break}r.coordinatesMode!==R.SKYBOX_MODE&&(r.irradianceTexture?(e.USEIRRADIANCEMAP=!0,e.USESPHERICALFROMREFLECTIONMAP=!1,e.USESPHERICALINVERTEX=!1,r.irradianceTexture._dominantDirection&&(e.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):r.isCube&&(e.USESPHERICALFROMREFLECTIONMAP=!0,e.USEIRRADIANCEMAP=!1,e.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,e.USESPHERICALINVERTEX=i))}else e.REFLECTION=!1,e.REFLECTIONMAP_3D=!1,e.REFLECTIONMAP_SPHERICAL=!1,e.REFLECTIONMAP_PLANAR=!1,e.REFLECTIONMAP_CUBIC=!1,e.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,e.REFLECTIONMAP_PROJECTION=!1,e.REFLECTIONMAP_SKYBOX=!1,e.REFLECTIONMAP_EXPLICIT=!1,e.REFLECTIONMAP_EQUIRECTANGULAR=!1,e.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,e.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,e.INVERTCUBICMAP=!1,e.USESPHERICALFROMREFLECTIONMAP=!1,e.USEIRRADIANCEMAP=!1,e.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,e.USESPHERICALINVERTEX=!1,e.REFLECTIONMAP_OPPOSITEZ=!1,e.LODINREFLECTIONALPHA=!1,e.GAMMAREFLECTION=!1,e.RGBDREFLECTION=!1,e.LINEARSPECULARREFLECTION=!1;return!0}function q(t,r,e,a,l,i,E){switch(E.needNormals=!0,l["LIGHT"+a]===void 0&&(E.needRebuild=!0),l["LIGHT"+a]=!0,l["SPOTLIGHT"+a]=!1,l["HEMILIGHT"+a]=!1,l["POINTLIGHT"+a]=!1,l["DIRLIGHT"+a]=!1,l["AREALIGHT"+a]=!1,l["CLUSTLIGHT"+a]=!1,e.prepareLightSpecificDefines(l,a),l["LIGHT_FALLOFF_PHYSICAL"+a]=!1,l["LIGHT_FALLOFF_GLTF"+a]=!1,l["LIGHT_FALLOFF_STANDARD"+a]=!1,e.falloffType){case I.FALLOFF_GLTF:l["LIGHT_FALLOFF_GLTF"+a]=!0;break;case I.FALLOFF_PHYSICAL:l["LIGHT_FALLOFF_PHYSICAL"+a]=!0;break;case I.FALLOFF_STANDARD:l["LIGHT_FALLOFF_STANDARD"+a]=!0;break}if(i&&!e.specular.equalsFloats(0,0,0)&&(E.specularEnabled=!0),l["SHADOW"+a]=!1,l["SHADOWCSM"+a]=!1,l["SHADOWCSMDEBUG"+a]=!1,l["SHADOWCSMNUM_CASCADES"+a]=!1,l["SHADOWCSMUSESHADOWMAXZ"+a]=!1,l["SHADOWCSMNOBLEND"+a]=!1,l["SHADOWCSM_RIGHTHANDED"+a]=!1,l["SHADOWPCF"+a]=!1,l["SHADOWPCSS"+a]=!1,l["SHADOWPOISSON"+a]=!1,l["SHADOWESM"+a]=!1,l["SHADOWCLOSEESM"+a]=!1,l["SHADOWCUBE"+a]=!1,l["SHADOWLOWQUALITY"+a]=!1,l["SHADOWMEDIUMQUALITY"+a]=!1,r&&r.receiveShadows&&t.shadowsEnabled&&e.shadowEnabled){let n=e.getShadowGenerator(t.activeCamera)??e.getShadowGenerator();if(n){let u=n.getShadowMap();u&&u.renderList&&u.renderList.length>0&&(E.shadowEnabled=!0,n.prepareDefines(l,a))}}e.lightmapMode!=I.LIGHTMAP_DEFAULT?(E.lightmapMode=!0,l["LIGHTMAPEXCLUDED"+a]=!0,l["LIGHTMAPNOSPECULAR"+a]=e.lightmapMode==I.LIGHTMAP_SHADOWSONLY):(l["LIGHTMAPEXCLUDED"+a]=!1,l["LIGHTMAPNOSPECULAR"+a]=!1)}function ze(t,r,e,a,l,i=null,E=!1){let n=te(t,a);i!==!1&&(n=k(e,t,a)),a.DEPTHPREPASS!==!r.getColorWrite()&&(a.DEPTHPREPASS=!a.DEPTHPREPASS,n=!0),a.INSTANCES!==l&&(a.INSTANCES=l,n=!0),a.THIN_INSTANCES!==E&&(a.THIN_INSTANCES=E,n=!0),n&&a.markAsUnprocessed()}function J(t,r){if(t.useBones&&t.computeBonesUsingShaders&&t.skeleton){r.NUM_BONE_INFLUENCERS=t.numBoneInfluencers;let e=r.BONETEXTURE!==void 0;if(t.skeleton.isUsingTextureForMatrices&&e)r.BONETEXTURE=!0;else{r.BonesPerMesh=t.skeleton.bones.length+1,r.BONETEXTURE=e?!1:void 0;let a=t.getScene().prePassRenderer;if(a&&a.enabled){let l=a.excludedSkinnedMesh.indexOf(t)===-1;r.BONES_VELOCITY_ENABLED=l}}}else r.NUM_BONE_INFLUENCERS=0,r.BonesPerMesh=0,r.BONETEXTURE!==void 0&&(r.BONETEXTURE=!1)}function $(t,r){let e=t.morphTargetManager;e?(r.MORPHTARGETS_UV=e.supportsUVs&&r.UV1,r.MORPHTARGETS_UV2=e.supportsUV2s&&r.UV2,r.MORPHTARGETS_TANGENT=e.supportsTangents&&r.TANGENT,r.MORPHTARGETS_NORMAL=e.supportsNormals&&r.NORMAL,r.MORPHTARGETS_POSITION=e.supportsPositions,r.MORPHTARGETS_COLOR=e.supportsColors,r.MORPHTARGETTEXTURE_HASUVS=e.hasUVs,r.MORPHTARGETTEXTURE_HASUV2S=e.hasUV2s,r.MORPHTARGETTEXTURE_HASTANGENTS=e.hasTangents,r.MORPHTARGETTEXTURE_HASNORMALS=e.hasNormals,r.MORPHTARGETTEXTURE_HASPOSITIONS=e.hasPositions,r.MORPHTARGETTEXTURE_HASCOLORS=e.hasColors,r.NUM_MORPH_INFLUENCERS=e.numMaxInfluencers||e.numInfluencers,r.MORPHTARGETS=r.NUM_MORPH_INFLUENCERS>0,r.MORPHTARGETS_TEXTURE=e.isUsingTextureForTargets):(r.MORPHTARGETS_UV=!1,r.MORPHTARGETS_UV2=!1,r.MORPHTARGETS_TANGENT=!1,r.MORPHTARGETS_NORMAL=!1,r.MORPHTARGETS_POSITION=!1,r.MORPHTARGETS_COLOR=!1,r.MORPHTARGETTEXTURE_HASUVS=!1,r.MORPHTARGETTEXTURE_HASUV2S=!1,r.MORPHTARGETTEXTURE_HASTANGENTS=!1,r.MORPHTARGETTEXTURE_HASNORMALS=!1,r.MORPHTARGETTEXTURE_HASPOSITIONS=!1,r.MORPHTARGETTEXTURE_HAS_COLORS=!1,r.MORPHTARGETS=!1,r.NUM_MORPH_INFLUENCERS=0)}function ee(t,r){let e=t.bakedVertexAnimationManager;r.BAKED_VERTEX_ANIMATION_TEXTURE=!!(e&&e.isEnabled)}function Ye(t,r,e,a,l=!1,i=!0,E=!0){if(!r._areAttributesDirty&&r._needNormals===r._normals&&r._needUVs===r._uvs)return!1;r._normals=r._needNormals,r._uvs=r._needUVs,r.NORMAL=r._needNormals&&t.isVerticesDataPresent("normal"),r._needNormals&&t.isVerticesDataPresent("tangent")&&(r.TANGENT=!0);for(let n=1;n<=6;++n)r["UV"+n]=r._needUVs?t.isVerticesDataPresent(`uv${n===1?"":n}`):!1;if(e){let n=t.useVertexColors&&t.isVerticesDataPresent("color");r.VERTEXCOLOR=n,r.VERTEXALPHA=t.hasVertexAlpha&&n&&i}return t.isVerticesDataPresent("instanceColor")&&(t.hasInstances||t.hasThinInstances)&&(r.INSTANCESCOLOR=!0),a&&J(t,r),l&&$(t,r),E&&ee(t,r),!0}function Ze(t,r){if(t.activeCamera){let e=r.MULTIVIEW;r.MULTIVIEW=t.activeCamera.outputRenderTarget!==null&&t.activeCamera.outputRenderTarget.getViewCount()>1,r.MULTIVIEW!=e&&r.markAsUnprocessed()}}function Qe(t,r,e){let a=r.ORDER_INDEPENDENT_TRANSPARENCY,l=r.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;r.ORDER_INDEPENDENT_TRANSPARENCY=t.useOrderIndependentTransparency&&e,r.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!t.getEngine().getCaps().textureFloatLinearFiltering,(a!==r.ORDER_INDEPENDENT_TRANSPARENCY||l!==r.ORDER_INDEPENDENT_TRANSPARENCY_16BITS)&&r.markAsUnprocessed()}function je(t,r,e){let a=r.PREPASS;if(!r._arePrePassDirty)return;let l=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(t.prePassRenderer&&t.prePassRenderer.enabled&&e){r.PREPASS=!0,r.SCENE_MRT_COUNT=t.prePassRenderer.mrtCount,r.PREPASS_NORMAL_WORLDSPACE=t.prePassRenderer.generateNormalsInWorldSpace,r.PREPASS_COLOR=!0,r.PREPASS_COLOR_INDEX=0;for(let i=0;i<l.length;i++){let E=t.prePassRenderer.getIndex(l[i].type);E!==-1?(r[l[i].define]=!0,r[l[i].index]=E):r[l[i].define]=!1}}else{r.PREPASS=!1;for(let i=0;i<l.length;i++)r[l[i].define]=!1}r.PREPASS!=a&&(r.markAsUnprocessed(),r.markAsImageProcessingDirty())}function te(t,r){let e=!1;if(t.activeCamera){let a=r.CAMERA_ORTHOGRAPHIC?1:0,l=r.CAMERA_PERSPECTIVE?1:0,i=t.activeCamera.mode===1?1:0,E=t.activeCamera.mode===0?1:0;(a^i||l^E)&&(r.CAMERA_ORTHOGRAPHIC=i===1,r.CAMERA_PERSPECTIVE=E===1,e=!0)}return e}function re(t,r,e,a,l=null,i=!1,E=!1,n=!1){l&&l.push("Light"+t),!i&&(r.push("vLightData"+t,"vLightDiffuse"+t,"vLightSpecular"+t,"vLightDirection"+t,"vLightWidth"+t,"vLightHeight"+t,"vLightFalloff"+t,"vLightGround"+t,"vSliceData"+t,"vSliceRanges"+t,"lightMatrix"+t,"shadowsInfo"+t,"depthValues"+t),e.push("shadowTexture"+t),e.push("depthTexture"+t),r.push("viewFrustumZ"+t,"cascadeBlendFactor"+t,"lightSizeUVCorrection"+t,"depthCorrection"+t,"penumbraDarkness"+t,"frustumLengths"+t),a&&(e.push("projectionLightTexture"+t),r.push("textureProjectionMatrix"+t)),E&&e.push("iesLightTexture"+t),n&&(e.push("lightDataTexture"+t),e.push("tileMaskTexture"+t)))}function Ke(t,r,e){let a=["vReflectionMicrosurfaceInfos","vReflectionDominantDirection","reflectionMatrix","vReflectionInfos","vReflectionPosition","vReflectionSize","vReflectionColor","vReflectionFilteringInfo"];e&&a.push("vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22"),t.push(...a);let l=["reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","icdfSampler"];r.push(...l)}function qe(t,r,e,a=4){let l,i;if(t.uniformsNames){let E=t;l=E.uniformsNames,i=E.uniformBuffersNames,r=E.samplers,e=E.defines,a=E.maxSimultaneousLights||0}else l=t,r||(r=[]);for(let E=0;E<a&&e["LIGHT"+E];E++)re(E,l,r,e["PROJECTEDLIGHTTEXTURE"+E],i,!1,e["IESLIGHTTEXTURE"+E],e["CLUSTLIGHT"+E]);e.NUM_MORPH_INFLUENCERS&&(l.push("morphTargetInfluences"),l.push("morphTargetCount")),e.BAKED_VERTEX_ANIMATION_TEXTURE&&(l.push("bakedVertexAnimationSettings"),l.push("bakedVertexAnimationTextureSizeInverted"),l.push("bakedVertexAnimationTime"),r.push("bakedVertexAnimationTexture"))}function Je(t,r=!1,e=!1,a=!1,l=!1,i=!1){t.addUniform("vReflectionInfos",2),t.addUniform("reflectionMatrix",16),r&&t.addUniform("vReflectionMicrosurfaceInfos",3),e&&(t.addUniform("vReflectionPosition",3),t.addUniform("vReflectionSize",3)),a&&(t.addUniform("vReflectionFilteringInfo",2),t.addUniform("vReflectionDominantDirection",3)),i&&t.addUniform("vReflectionColor",3),l&&(t.addUniform("vSphericalL00",3),t.addUniform("vSphericalL1_1",3),t.addUniform("vSphericalL10",3),t.addUniform("vSphericalL11",3),t.addUniform("vSphericalL2_2",3),t.addUniform("vSphericalL2_1",3),t.addUniform("vSphericalL20",3),t.addUniform("vSphericalL21",3),t.addUniform("vSphericalL22",3),t.addUniform("vSphericalX",3),t.addUniform("vSphericalY",3),t.addUniform("vSphericalZ",3),t.addUniform("vSphericalXX_ZZ",3),t.addUniform("vSphericalYY_ZZ",3),t.addUniform("vSphericalZZ",3),t.addUniform("vSphericalXY",3),t.addUniform("vSphericalYZ",3),t.addUniform("vSphericalZX",3))}export{d as a,ne as b,z as c,oe as d,se as e,ce as f,Re as g,pe as h,H as i,Ce as j,Ue as k,he as l,Y as m,Z as n,Fe as o,de as p,He as q,be as r,ge as s,me as t,Ge as u,ve as v,j as w,Be as x,Ve as y,ye as z,Xe as A,K as B,We as C,ke as D,we as E,q as F,ze as G,J as H,$ as I,Ye as J,Ze as K,Qe as L,je as M,te as N,re as O,Ke as P,qe as Q,Je as R};
