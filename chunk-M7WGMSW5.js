import{b as y,c as V}from"./chunk-WMKW4FWA.js";import{a as v}from"./chunk-LU3OERCI.js";import{d as n}from"./chunk-D7E25M7D.js";import{b as u}from"./chunk-OPJEXU7D.js";import{f as h}from"./chunk-VBN2JSHE.js";var c=class{constructor(e,i,p,f){this.name=e,this.worldAxisForNormal=i,this.worldAxisForFileX=p,this.worldAxisForFileY=f}},F=class{static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();let i=e.getSize().width,p=e.readPixels(0,void 0,void 0,!1),f=e.readPixels(1,void 0,void 0,!1),A,s;e.isRenderTarget?(A=e.readPixels(3,void 0,void 0,!1),s=e.readPixels(2,void 0,void 0,!1)):(A=e.readPixels(2,void 0,void 0,!1),s=e.readPixels(3,void 0,void 0,!1));let _=e.readPixels(4,void 0,void 0,!1),R=e.readPixels(5,void 0,void 0,!1),x=e.gammaSpace,z=5,M=0;return(e.textureType==1||e.textureType==2)&&(M=1),new Promise(S=>{Promise.all([f,p,A,s,_,R]).then(([P,g,l,t,m,d])=>{let w={size:i,right:g,left:P,up:l,down:t,front:m,back:d,format:z,type:M,gammaSpace:x};S(this.ConvertCubeMapToSphericalPolynomial(w))})})}static _AreaElement(e,i){return Math.atan2(e*i,Math.sqrt(e*e+i*i+1))}static ConvertCubeMapToSphericalPolynomial(e){let i=new y,p=0,f=2/e.size,A=f,s=.5*f,_=s-1;for(let S=0;S<6;S++){let P=this._FileFaces[S],g=e[P.name],l=_,t=e.format===5?4:3;for(let m=0;m<e.size;m++){let d=_;for(let w=0;w<e.size;w++){let L=P.worldAxisForFileX.scale(d).add(P.worldAxisForFileY.scale(l)).add(P.worldAxisForNormal);L.normalize();let T=this._AreaElement(d-s,l-s)-this._AreaElement(d-s,l+s)-this._AreaElement(d+s,l-s)+this._AreaElement(d+s,l+s),a=g[m*e.size*t+w*t+0],o=g[m*e.size*t+w*t+1],r=g[m*e.size*t+w*t+2];isNaN(a)&&(a=0),isNaN(o)&&(o=0),isNaN(r)&&(r=0),e.type===0&&(a/=255,o/=255,r/=255),e.gammaSpace&&(a=Math.pow(h(a),u),o=Math.pow(h(o),u),r=Math.pow(h(r),u));let E=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){let N=Math.max(a,o,r);if(N>E){let C=E/N;a*=C,o*=C,r*=C}}else a=h(a,0,E),o=h(o,0,E),r=h(r,0,E);let H=new v(a,o,r);i.addLight(L,H,T),p+=T,d+=f}l+=A}}let M=4*Math.PI*6/6/p;return i.scaleInPlace(M),i.convertIncidentRadianceToIrradiance(),i.convertIrradianceToLambertianRadiance(),V.FromHarmonics(i)}};F._FileFaces=[new c("right",new n(1,0,0),new n(0,0,-1),new n(0,-1,0)),new c("left",new n(-1,0,0),new n(0,0,1),new n(0,-1,0)),new c("up",new n(0,1,0),new n(1,0,0),new n(0,0,1)),new c("down",new n(0,-1,0),new n(1,0,0),new n(0,0,-1)),new c("front",new n(0,0,1),new n(1,0,0),new n(0,-1,0)),new c("back",new n(0,0,-1),new n(-1,0,0),new n(0,-1,0))];F.MAX_HDRI_VALUE=4096;F.PRESERVE_CLAMPED_COLORS=!1;export{F as a};
