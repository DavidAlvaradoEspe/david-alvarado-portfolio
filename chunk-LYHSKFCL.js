import{a as C}from"./chunk-5SDLENZK.js";import{b as V}from"./chunk-3WG2WLZ4.js";import{E as P,a as $,g as z,h as G}from"./chunk-CXW3WAWT.js";import{a as W}from"./chunk-CWQQB2EJ.js";import{a as D}from"./chunk-PMYBMJFK.js";import{a as T}from"./chunk-CJK33JLH.js";import{a as B}from"./chunk-PTJ4CXVK.js";import{a as M}from"./chunk-YVY7FGQB.js";var ue=e=>{if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let s="";for(let t=0;t<e.byteLength;t++)s+=String.fromCharCode(e[t]);return s},X=e=>{let s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="",a,c,o,f,l,d,p,n=0,r=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);for(;n<r.length;)a=r[n++],c=n<r.length?r[n++]:Number.NaN,o=n<r.length?r[n++]:Number.NaN,f=a>>2,l=(a&3)<<4|c>>4,d=(c&15)<<2|o>>6,p=o&63,isNaN(c)?d=p=64:isNaN(o)&&(p=64),t+=s.charAt(f)+s.charAt(l)+s.charAt(d)+s.charAt(p);return t},H=e=>atob(e),J=e=>{let s=H(e),t=s.length,a=new Uint8Array(new ArrayBuffer(t));for(let c=0;c<t;c++)a[c]=s.charCodeAt(c);return a.buffer};var he=(()=>{class e{static Instantiate(t){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[t])return this.RegisteredExternalClasses[t];let a=V(t);if(a)return a;B.Warn(t+" not found, you may have missed an import.");let c=t.split("."),o=window||this;for(let f=0,l=c.length;f<l;f++)o=o[c[f]];return typeof o!="function"?null:o}}return e.RegisteredExternalClasses={},e})();var v=(()=>{class e{}return e.FilesToLoad={},e})();var I=class{static ExponentialBackoff(s=3,t=500){return(a,c,o)=>c.status!==0||o>=s||a.indexOf("file:")!==-1?-1:Math.pow(2,o)*t}};var y=class extends Error{};y._setPrototypeOf=Object.setPrototypeOf||((e,s)=>(e.__proto__=s,e));var F={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002},U=class e extends y{constructor(s,t,a){super(s),this.errorCode=t,this.innerError=a,this.name="RuntimeError",y._setPrototypeOf(this,e.prototype)}};var Q=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),j=class e extends U{constructor(s,t){super(s,F.LoadFileError),this.name="LoadFileError",y._setPrototypeOf(this,e.prototype),t instanceof C?this.request=t:this.file=t}},q=class e extends U{constructor(s,t){super(s,F.RequestFileError),this.request=t,this.name="RequestFileError",y._setPrototypeOf(this,e.prototype)}},N=class e extends U{constructor(s,t){super(s,F.ReadFileError),this.file=t,this.name="ReadFileError",y._setPrototypeOf(this,e.prototype)}},le=e=>(e=e.replace(/#/gm,"%23"),e),g={DefaultRetryStrategy:I.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:e=>e,ScriptBaseUrl:"",ScriptPreprocessUrl:e=>e,CleanUrl:le},Y=(e,s)=>{if(!(e&&e.indexOf("data:")===0)&&g.CorsBehavior)if(typeof g.CorsBehavior=="string"||g.CorsBehavior instanceof String)s.crossOrigin=g.CorsBehavior;else{let t=g.CorsBehavior(e);t&&(s.crossOrigin=t)}},K={getRequiredSize:null},Z=(e,s,t,a,c="",o,f=D.LastCreatedEngine)=>{if(typeof HTMLImageElement>"u"&&!f?._features.forceBitmapOverHTMLImageElement)return t("LoadImage is only supported in web or BabylonNative environments."),null;let l,d=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?typeof Blob<"u"&&typeof URL<"u"?(l=URL.createObjectURL(new Blob([e],{type:c})),d=!0):l=`data:${c};base64,`+X(e):e instanceof Blob?(l=URL.createObjectURL(e),d=!0):(l=g.CleanUrl(e),l=g.PreprocessUrl(l));let p=i=>{if(t){let u=l||e.toString();t(`Error while trying to load image: ${u.indexOf("http")===0||u.length<=128?u:u.slice(0,128)+"..."}`,i)}};if(f?._features.forceBitmapOverHTMLImageElement)return O(l,i=>{f.createImageBitmap(new Blob([i],{type:c}),M({premultiplyAlpha:"none"},o)).then(u=>{s(u),d&&URL.revokeObjectURL(l)}).catch(u=>{t&&t("Error while trying to load image: "+e,u)})},void 0,a||void 0,!0,(i,u)=>{p(u)}),null;let n=new Image;if(K.getRequiredSize){let i=K.getRequiredSize(e);i.width&&(n.width=i.width),i.height&&(n.height=i.height)}Y(l,n);let r=[],h=()=>{for(let i of r)i.target.addEventListener(i.name,i.handler)},m=()=>{for(let i of r)i.target.removeEventListener(i.name,i.handler);r.length=0},E=()=>{m(),s(n),d&&n.src&&URL.revokeObjectURL(n.src)},x=i=>{m(),p(i),d&&n.src&&URL.revokeObjectURL(n.src)},S=i=>{if(i.blockedURI!==n.src||i.disposition==="report")return;m();let u=new Error(`CSP violation of policy ${i.effectiveDirective} ${i.blockedURI}. Current policy is ${i.originalPolicy}`);D.UseFallbackTexture=!1,p(u),d&&n.src&&URL.revokeObjectURL(n.src),n.src=""};r.push({target:n,name:"load",handler:E}),r.push({target:n,name:"error",handler:x}),r.push({target:document,name:"securitypolicyviolation",handler:S}),h();let R=l.substring(0,5)==="blob:",L=l.substring(0,5)==="data:",b=()=>{R||L||!C.IsCustomRequestAvailable?n.src=l:O(l,(i,u,A)=>{let oe=!c&&A?A:c,ae=new Blob([i],{type:oe}),ie=URL.createObjectURL(ae);d=!0,n.src=ie},void 0,a||void 0,!0,(i,u)=>{p(u)})},k=()=>{a&&a.loadImage(l,n)};if(!R&&!L&&a&&a.enableTexturesOffline)a.open(k,b);else{if(l.indexOf("file:")!==-1){let i=decodeURIComponent(l.substring(5).toLowerCase());if(v.FilesToLoad[i]&&typeof URL<"u"){try{let u;try{u=URL.createObjectURL(v.FilesToLoad[i])}catch{u=URL.createObjectURL(v.FilesToLoad[i])}n.src=u,d=!0}catch{n.src=""}return n}}b()}return n},_=(e,s,t,a,c)=>{let o=new FileReader,f={onCompleteObservable:new T,abort:()=>o.abort()};return o.onloadend=()=>f.onCompleteObservable.notifyObservers(f),c&&(o.onerror=()=>{c(new N(`Unable to read ${e.name}`,e))}),o.onload=l=>{s(l.target.result)},t&&(o.onprogress=t),a?o.readAsArrayBuffer(e):o.readAsText(e),f},O=(e,s,t,a,c,o,f)=>{if(e.name)return _(e,s,t,c,o?n=>{o(void 0,n)}:void 0);let l=e;if(l.indexOf("file:")!==-1){let n=decodeURIComponent(l.substring(5).toLowerCase());n.indexOf("./")===0&&(n=n.substring(2));let r=v.FilesToLoad[n];if(r)return _(r,s,t,c,o?h=>o(void 0,new j(h.message,h.file)):void 0)}let{match:d,type:p}=re(l);if(d){let n={onCompleteObservable:new T,abort:()=>()=>{}};try{let r=c?ne(l):se(l);s(r,void 0,p)}catch(r){o?o(void 0,r):B.Error(r.message||"Failed to parse the Data URL")}return G.SetImmediate(()=>{n.onCompleteObservable.notifyObservers(n)}),n}return ee(l,(n,r)=>{s(n,r?.responseURL,r?.getResponseHeader("content-type"))},t,a,c,o?n=>{o(n.request,new j(n.message,n.request))}:void 0,f)},ee=(e,s,t,a,c,o,f)=>{a!==null&&(a??(a=D.LastCreatedScene?.offlineProvider)),e=g.CleanUrl(e),e=g.PreprocessUrl(e);let l=g.BaseUrl+e,d=!1,p={onCompleteObservable:new T,abort:()=>d=!0},n=()=>{let r=new C,h=null,m,E=()=>{r&&(t&&r.removeEventListener("progress",t),m&&r.removeEventListener("readystatechange",m),r.removeEventListener("loadend",x))},x=()=>{E(),p.onCompleteObservable.notifyObservers(p),p.onCompleteObservable.clear(),t=void 0,m=null,x=null,o=void 0,f=void 0,s=void 0};p.abort=()=>{d=!0,x&&x(),r&&r.readyState!==(XMLHttpRequest.DONE||4)&&r.abort(),h!==null&&(clearTimeout(h),h=null),r=null};let S=L=>{let b=L.message||"Unknown error";o&&r?o(new q(b,r)):B.Error(b)},R=L=>{if(r){if(r.open("GET",l),f)try{f(r)}catch(b){S(b);return}c&&(r.responseType="arraybuffer"),t&&r.addEventListener("progress",t),x&&r.addEventListener("loadend",x),m=()=>{if(!(d||!r)&&r.readyState===(XMLHttpRequest.DONE||4)){if(m&&r.removeEventListener("readystatechange",m),r.status>=200&&r.status<300||r.status===0&&(!W()||te())){let i=c?r.response:r.responseText;if(i!==null){try{s&&s(i,r)}catch(u){S(u)}return}}let b=g.DefaultRetryStrategy;if(b){let i=b(l,r,L);if(i!==-1){E(),r=new C,h=setTimeout(()=>R(L+1),i);return}}let k=new q("Error status: "+r.status+" "+r.statusText+" - Unable to load "+l,r);o&&o(k)}},r.addEventListener("readystatechange",m),r.send()}};R(0)};if(a&&a.enableSceneOffline&&!e.startsWith("blob:")){let r=m=>{m&&m.status>400?o&&o(m):n()},h=()=>{a&&a.loadFile(g.BaseUrl+e,m=>{!d&&s&&s(m),p.onCompleteObservable.notifyObservers(p)},t?m=>{!d&&t&&t(m)}:void 0,r,c)};a.open(h,r)}else n();return p},je=e=>{let{match:s,type:t}=re(e);if(s)return t||void 0;let a=e.lastIndexOf(".");switch(e.substring(a+1).toLowerCase()){case"glb":return"model/gltf-binary";case"bin":return"application/octet-stream";case"gltf":return"model/gltf+json";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"ktx":return"image/ktx";case"ktx2":return"image/ktx2";case"avif":return"image/avif";default:return}},te=()=>typeof location<"u"&&location.protocol==="file:",ce=e=>Q.test(e),re=e=>{let s=Q.exec(e);return s===null||s.length===0?{match:!1,type:""}:{match:!0,type:s[0].replace("data:","").replace(";base64,","")}};function ne(e){return J(e.split(",")[1])}var se=e=>H(e.split(",")[1]),fe=()=>{P._FileToolsLoadImage=Z,$.loadFile=O,z.loadFile=O};fe();var w,de=(e,s,t,a,c,o,f,l,d,p)=>{w={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:s,DefaultRetryStrategy:t.DefaultRetryStrategy,BaseUrl:t.BaseUrl,CorsBehavior:t.CorsBehavior,PreprocessUrl:t.PreprocessUrl,IsBase64DataUrl:a,IsFileURL:c,LoadFile:o,LoadImage:f,ReadFile:l,RequestFile:d,SetCorsBehavior:p},Object.defineProperty(w,"DefaultRetryStrategy",{get:function(){return t.DefaultRetryStrategy},set:function(n){t.DefaultRetryStrategy=n}}),Object.defineProperty(w,"BaseUrl",{get:function(){return t.BaseUrl},set:function(n){t.BaseUrl=n}}),Object.defineProperty(w,"PreprocessUrl",{get:function(){return t.PreprocessUrl},set:function(n){t.PreprocessUrl=n}}),Object.defineProperty(w,"CorsBehavior",{get:function(){return t.CorsBehavior},set:function(n){t.CorsBehavior=n}})};de(ne,se,g,ce,te,O,Z,_,ee,Y);export{F as a,U as b,ue as c,X as d,he as e,j as f,g,Y as h,Z as i,_ as j,O as k,ee as l,je as m,ce as n,ne as o};
