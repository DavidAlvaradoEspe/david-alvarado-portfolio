import{a as b}from"./chunk-CJK33JLH.js";function l(t){let e=0,r=Date.now();t.observableParameters=t.observableParameters??{};let s=t.contextObservable.add(a=>{let i=Date.now();e=i-r;let n={startTime:r,currentTime:i,deltaTime:e,completeRate:e/t.timeout,payload:a};t.onTick&&t.onTick(n),t.breakCondition&&t.breakCondition()&&(t.contextObservable.remove(s),t.onAborted&&t.onAborted(n)),e>=t.timeout&&(t.contextObservable.remove(s),t.onEnded&&t.onEnded(n))},t.observableParameters.mask,t.observableParameters.insertFirst,t.observableParameters.scope);return s}var o=class{constructor(e){this.onEachCountObservable=new b,this.onTimerAbortedObservable=new b,this.onTimerEndedObservable=new b,this.onStateChangedObservable=new b,this._observer=null,this._breakOnNextTick=!1,this._tick=r=>{let s=Date.now();this._timer=s-this._startTime;let a={startTime:this._startTime,currentTime:s,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:r},i=this._breakOnNextTick||this._breakCondition(a);i||this._timer>=this._timeToEnd?this._stop(a,i):this.onEachCountObservable.notifyObservers(a)},this._setState(0),this._contextObservable=e.contextObservable,this._observableParameters=e.observableParameters??{},this._breakCondition=e.breakCondition??(()=>!1),this._timeToEnd=e.timeout,e.onEnded&&this.onTimerEndedObservable.add(e.onEnded),e.onTick&&this.onEachCountObservable.add(e.onTick),e.onAborted&&this.onTimerAbortedObservable.add(e.onAborted)}set breakCondition(e){this._breakCondition=e}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(e=this._timeToEnd){if(this._state===1)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=e,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){this._state===1&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(e){this._state=e,this.onStateChangedObservable.notifyObservers(this._state)}_stop(e,r=!1){this._contextObservable.remove(this._observer),this._setState(2),r?this.onTimerAbortedObservable.notifyObservers(e):this.onTimerEndedObservable.notifyObservers(e)}};export{l as a,o as b};
