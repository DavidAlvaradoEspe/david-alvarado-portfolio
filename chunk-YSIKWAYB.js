import{f as i}from"./chunk-SIRYQ23E.js";import"./chunk-Y6OLMIZM.js";import"./chunk-7PKF2HBK.js";import"./chunk-UTB7MUBH.js";import"./chunk-DTW6C2NU.js";import{a as y}from"./chunk-2LR3BD57.js";import"./chunk-IMSFUDDL.js";import"./chunk-CW5F3XFN.js";import"./chunk-NPZEPKVW.js";import"./chunk-FWZ75RMU.js";import"./chunk-OPJEXU7D.js";import{f as u}from"./chunk-YFTPYCF4.js";import"./chunk-YZWYFFYQ.js";import"./chunk-J7UYENZA.js";import"./chunk-CCUABLZY.js";import"./chunk-LYHSKFCL.js";import"./chunk-5SDLENZK.js";import"./chunk-XXSLHR3E.js";import"./chunk-3WG2WLZ4.js";import"./chunk-ZUHEGR2G.js";import"./chunk-SO644OCK.js";import{E as n}from"./chunk-CXW3WAWT.js";import"./chunk-A3WFPZFR.js";import"./chunk-CWQQB2EJ.js";import"./chunk-PMYBMJFK.js";import"./chunk-CJK33JLH.js";import"./chunk-PTJ4CXVK.js";import"./chunk-L3UYHT7M.js";import"./chunk-YVY7FGQB.js";var c=class{constructor(){this._timeElapsedQueryEnded=!1}};n.prototype.getGPUFrameTimeCounter=function(){return this._gpuFrameTime||(this._gpuFrameTime=new y),this._gpuFrameTime};n.prototype.captureGPUFrameTime=function(e){};var a=class{constructor(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=i.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=i.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE,this.forceRenderingWhenOccluded=!1}};n.prototype.createQuery=function(){return null};n.prototype.deleteQuery=function(e){return this};n.prototype.isQueryResultAvailable=function(e){return!1};n.prototype.getQueryResult=function(e){return 0};n.prototype.beginOcclusionQuery=function(e,t){return!1};n.prototype.endOcclusionQuery=function(e){return this};Object.defineProperty(i.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},set:function(e){this._occlusionDataStorage.isOcclusionQueryInProgress=e},enumerable:!1,configurable:!0});Object.defineProperty(i.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new a),this.__occlusionDataStorage},enumerable:!1,configurable:!0});Object.defineProperty(i.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(e){this._occlusionDataStorage.isOccluded=e},enumerable:!0,configurable:!0});Object.defineProperty(i.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(e){this._occlusionDataStorage.occlusionQueryAlgorithmType=e},enumerable:!0,configurable:!0});Object.defineProperty(i.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(e){this._occlusionDataStorage.occlusionType=e},enumerable:!0,configurable:!0});Object.defineProperty(i.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(e){this._occlusionDataStorage.occlusionRetryCount=e},enumerable:!0,configurable:!0});Object.defineProperty(i.prototype,"forceRenderingWhenOccluded",{get:function(){return this._occlusionDataStorage.forceRenderingWhenOccluded},set:function(e){this._occlusionDataStorage.forceRenderingWhenOccluded=e},enumerable:!0,configurable:!0});i.prototype._checkOcclusionQuery=function(){let e=this._occlusionDataStorage;if(e.occlusionType===i.OCCLUSION_TYPE_NONE)return e.isOccluded=!1,!1;let t=this.getEngine();if(!t.getCaps().supportOcclusionQuery||!t.isQueryResultAvailable)return e.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery!==null&&this._occlusionQuery!==void 0)if(t.isQueryResultAvailable(this._occlusionQuery)){let s=t.getQueryResult(this._occlusionQuery);e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=!(s>0)}else if(e.occlusionInternalRetryCounter++,e.occlusionRetryCount!==-1&&e.occlusionInternalRetryCounter>e.occlusionRetryCount)e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=e.occlusionType===i.OCCLUSION_TYPE_OPTIMISTIC?!1:e.isOccluded;else return e.occlusionType===i.OCCLUSION_TYPE_OPTIMISTIC?!1:e.isOccluded;let r=this.getScene();if(r.getBoundingBoxRenderer){let o=r.getBoundingBoxRenderer();this._occlusionQuery===null&&(this._occlusionQuery=t.createQuery()),this._occlusionQuery&&t.beginOcclusionQuery(e.occlusionQueryAlgorithmType,this._occlusionQuery)&&(o.renderOcclusionBoundingBox(this),t.endOcclusionQuery(e.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0)}return e.isOccluded};u.prototype.createQuery=function(){let e=this._gl.createQuery();if(!e)throw new Error("Unable to create Occlusion Query");return e};u.prototype.deleteQuery=function(e){return this._gl.deleteQuery(e),this};u.prototype.isQueryResultAvailable=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE)};u.prototype.getQueryResult=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT)};u.prototype.beginOcclusionQuery=function(e,t){let r=this._getGlAlgorithmType(e);return this._gl.beginQuery(r,t),!0};u.prototype.endOcclusionQuery=function(e){let t=this._getGlAlgorithmType(e);return this._gl.endQuery(t),this};u.prototype._createTimeQuery=function(){let e=this.getCaps().timerQuery;return e.createQueryEXT?e.createQueryEXT():this.createQuery()};u.prototype._deleteTimeQuery=function(e){let t=this.getCaps().timerQuery;if(t.deleteQueryEXT){t.deleteQueryEXT(e);return}this.deleteQuery(e)};u.prototype._getTimeQueryResult=function(e){let t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT):this.getQueryResult(e)};u.prototype._getTimeQueryAvailability=function(e){let t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(e)};u.prototype.startTimeQuery=function(){let e=this.getCaps(),t=e.timerQuery;if(!t)return null;let r=new c;if(this._gl.getParameter(t.GPU_DISJOINT_EXT),e.canUseTimestampForTimerQuery)r._startTimeQuery=this._createTimeQuery(),r._startTimeQuery&&t.queryCounterEXT(r._startTimeQuery,t.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;r._timeElapsedQuery=this._createTimeQuery(),r._timeElapsedQuery&&(t.beginQueryEXT?t.beginQueryEXT(t.TIME_ELAPSED_EXT,r._timeElapsedQuery):this._gl.beginQuery(t.TIME_ELAPSED_EXT,r._timeElapsedQuery)),this._currentNonTimestampToken=r}return r};u.prototype.endTimeQuery=function(e){let t=this.getCaps(),r=t.timerQuery;if(!r||!e)return-1;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery)return-1;e._endTimeQuery||(e._endTimeQuery=this._createTimeQuery(),e._endTimeQuery&&r.queryCounterEXT(e._endTimeQuery,r.TIMESTAMP_EXT))}else if(!e._timeElapsedQueryEnded){if(!e._timeElapsedQuery)return-1;r.endQueryEXT?r.endQueryEXT(r.TIME_ELAPSED_EXT):(this._gl.endQuery(r.TIME_ELAPSED_EXT),this._currentNonTimestampToken=null),e._timeElapsedQueryEnded=!0}let o=this._gl.getParameter(r.GPU_DISJOINT_EXT),s=!1;if(e._endTimeQuery?s=this._getTimeQueryAvailability(e._endTimeQuery):e._timeElapsedQuery&&(s=this._getTimeQueryAvailability(e._timeElapsedQuery)),s&&!o){let l=0;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery||!e._endTimeQuery)return-1;let m=this._getTimeQueryResult(e._startTimeQuery);l=this._getTimeQueryResult(e._endTimeQuery)-m,this._deleteTimeQuery(e._startTimeQuery),this._deleteTimeQuery(e._endTimeQuery),e._startTimeQuery=null,e._endTimeQuery=null}else{if(!e._timeElapsedQuery)return-1;l=this._getTimeQueryResult(e._timeElapsedQuery),this._deleteTimeQuery(e._timeElapsedQuery),e._timeElapsedQuery=null,e._timeElapsedQueryEnded=!1}return l}return-1};u.prototype.captureGPUFrameTime=function(e){if(e!==this._captureGPUFrameTime)if(this._captureGPUFrameTime=e,e){let t=this.getGPUFrameTimeCounter();this._onBeginFrameObserver=this.onBeginFrameObservable.add(()=>{this._gpuFrameTimeToken||(this._gpuFrameTimeToken=this.startTimeQuery())}),this._onEndFrameObserver=this.onEndFrameObservable.add(()=>{if(!this._gpuFrameTimeToken)return;let r=this.endTimeQuery(this._gpuFrameTimeToken);r>-1&&(this._gpuFrameTimeToken=null,t.fetchNewFrame(),t.addCount(r,!0))})}else this.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null};u.prototype._getGlAlgorithmType=function(e){return e===i.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED};
