import{a as P,b as K,c as M,d as Ke,f as je,g as j,h as Qe,i as Ze,j as Q}from"./chunk-IE2EIPPB.js";import{C as we,d as w,q as me}from"./chunk-DQQ4T6LN.js";import{A as Pe,C as Fe,D as Ue,E as ke,G as He,J as Be,K as Ge,L as Ve,M as Xe,P as Ye,Q as ze,R as We,f as xe,h as de,i as l,j as Ie,k as Ce,m as ge,o as be,q as ye,r as Le,s as m,t as x,u as Me,v as Ne,x as Oe,y as De,z as ve}from"./chunk-VF226S3Z.js";import{e as pe}from"./chunk-P7GMCLRU.js";import{b as B}from"./chunk-JIBXETCA.js";import{a as I,c as G}from"./chunk-LU3OERCI.js";import{c as Ae,e as Se,h as Y}from"./chunk-D7E25M7D.js";import{g as U}from"./chunk-ZIF4NNI2.js";import{a as i,c as r,d as a,e as p,f as N,h as Re}from"./chunk-CCUABLZY.js";import{a as W}from"./chunk-3WG2WLZ4.js";import{i as fe}from"./chunk-UB6LWR2H.js";import{a as Ee}from"./chunk-FIS22N7N.js";import{a as ce}from"./chunk-PTJ4CXVK.js";import{a as $}from"./chunk-L3UYHT7M.js";import{a as Te,h as _e}from"./chunk-GXO6EN2N.js";var tt=new RegExp("^([gimus]+)!"),$e=(()=>{class T{constructor(s){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=s,this._scene=s.getScene(),this._engine=this._scene.getEngine()}_addPlugin(s){for(let u=0;u<this._plugins.length;++u)if(this._plugins[u].name===s.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!s.isCompatible(this._material.shaderLanguage))throw`The plugin "${s.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;let t=s.getClassName();T._MaterialPluginClassToMainDefine[t]||(T._MaterialPluginClassToMainDefine[t]="MATERIALPLUGIN_"+ ++T._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(u,A)=>this._handlePluginEvent(u,A),this._plugins.push(s),this._plugins.sort((u,A)=>u.priority-A.priority),this._codeInjectionPoints={};let n={};n[T._MaterialPluginClassToMainDefine[t]]={type:"boolean",default:!0};for(let u of this._plugins)u.collectDefines(n),this._collectPointNames("vertex",u.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",u.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=n,!0}_activatePlugin(s){this._activePlugins.indexOf(s)===-1&&(this._activePlugins.push(s),this._activePlugins.sort((t,n)=>t.priority-n.priority),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),s.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(s),this._activePluginsForExtraEvents.sort((t,n)=>t.priority-n.priority),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(s){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===s)return this._plugins[t];return null}_handlePluginEventIsReadyForSubMesh(s){let t=!0;for(let n of this._activePlugins)t=t&&n.isReadyForSubMesh(s.defines,this._scene,this._engine,s.subMesh);s.isReadyForSubMesh=t}_handlePluginEventPrepareDefinesBeforeAttributes(s){for(let t of this._activePlugins)t.prepareDefinesBeforeAttributes(s.defines,this._scene,s.mesh)}_handlePluginEventPrepareDefines(s){for(let t of this._activePlugins)t.prepareDefines(s.defines,this._scene,s.mesh)}_handlePluginEventHardBindForSubMesh(s){for(let t of this._activePluginsForExtraEvents)t.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,s.subMesh)}_handlePluginEventBindForSubMesh(s){for(let t of this._activePlugins)t.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,s.subMesh)}_handlePluginEventHasRenderTargetTextures(s){let t=!1;for(let n of this._activePluginsForExtraEvents)if(t=n.hasRenderTargetTextures(),t)break;s.hasRenderTargetTextures=t}_handlePluginEventFillRenderTargetTextures(s){for(let t of this._activePluginsForExtraEvents)t.fillRenderTargetTextures(s.renderTargets)}_handlePluginEvent(s,t){switch(s){case 512:{let n=t;for(let u of this._activePlugins)u.getActiveTextures(n.activeTextures);break}case 256:{let n=t;for(let u of this._activePlugins)u.getAnimatables(n.animatables);break}case 1024:{let n=t,u=!1;for(let A of this._activePlugins)if(u=A.hasTexture(n.texture),u)break;n.hasTexture=u;break}case 2:{let n=t;for(let u of this._plugins)u.dispose(n.forceDisposeTextures);break}case 4:{let n=t;n.defineNames=this._defineNamesFromPlugins;break}case 128:{let n=t;for(let u of this._activePlugins)n.fallbackRank=u.addFallbacks(n.defines,n.fallbacks,n.fallbackRank),u.getAttributes(n.attributes,this._scene,n.mesh);this._uniformList.length>0&&n.uniforms.push(...this._uniformList),this._samplerList.length>0&&n.samplers.push(...this._samplerList),this._uboList.length>0&&n.uniformBuffersNames.push(...this._uboList),n.customCode=this._injectCustomCode(n,n.customCode);break}case 8:{let n=t;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];let u=this._material.shaderLanguage===1;for(let A of this._plugins){let c=A.getUniforms(this._material.shaderLanguage);if(c){if(c.ubo)for(let E of c.ubo){if(E.size&&E.type){let f=E.arraySize??0;if(n.ubo.addUniform(E.name,E.size,f),u){let _;switch(E.type){case"mat4":_="mat4x4f";break;case"float":_="f32";break;default:_=`${E.type}f`;break}f>0?this._uboDeclaration+=`uniform ${E.name}: array<${_}, ${f}>;
`:this._uboDeclaration+=`uniform ${E.name}: ${_};
`}else this._uboDeclaration+=`${E.type} ${E.name}${f>0?`[${f}]`:""};
`}this._uniformList.push(E.name)}c.vertex&&(this._vertexDeclaration+=c.vertex+`
`),c.fragment&&(this._fragmentDeclaration+=c.fragment+`
`),c.externalUniforms&&this._uniformList.push(...c.externalUniforms)}A.getSamplers(this._samplerList),A.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(s,t){if(t)for(let n in t)this._codeInjectionPoints[s]||(this._codeInjectionPoints[s]={}),this._codeInjectionPoints[s][n]=!0}_injectCustomCode(s,t){return(n,u)=>{t&&(u=t(n,u)),this._uboDeclaration&&(u=u.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(u=u.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(u=u.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));let A=this._codeInjectionPoints?.[n];if(!A)return u;let c=null;for(let E in A){let f="";for(let _ of this._activePlugins){let o=_.getCustomCode(n,this._material.shaderLanguage)?.[E];o&&(_.resolveIncludes&&(c===null&&(c={defines:[],indexParameters:s.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:$.GetShadersRepository(0),includesShadersStore:$.GetIncludesShadersStore(0),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}),c.isFragment=n==="fragment",fe(o,c,R=>o=R)),f+=o+`
`)}if(f.length>0)if(E.charAt(0)==="!"){E=E.substring(1);let _="g";if(E.charAt(0)==="!")_="",E=E.substring(1);else{let b=tt.exec(E);b&&b.length>=2&&(_=b[1],E=E.substring(_.length+1))}_.indexOf("g")<0&&(_+="g");let o=u,R=new RegExp(E,_),L=R.exec(o);for(;L!==null;){let b=f;for(let D=0;D<L.length;++D)b=b.replace("$"+D,L[D]);u=u.replace(L[0],b),L=R.exec(o)}}else{let _="#define "+E;u=u.replace(_,`
`+f+`
`+_)}}return u}}}return T._MaterialPluginClassToMainDefine={},T._MaterialPluginCounter=0,T})();Ee.OnEnginesDisposedObservable.add(()=>{Je()});var H=[],J=!1,q=null;function nt(T,e){J||(q=P.OnEventObservable.add(t=>{for(let[,n]of H)n(t)},1),J=!0);let s=H.filter(([t,n])=>t===T);s.length>0?s[0][1]=e:H.push([T,e])}function lt(T){for(let e=0;e<H.length;++e)if(H[e][0]===T)return H.splice(e,1),H.length===0&&Je(),!0;return!1}function Je(){H.length=0,J=!1,P.OnEventObservable.remove(q),q=null}var g=class{isCompatible(e){switch(e){case 0:return!0;default:return!1}}_enable(e){e&&this._pluginManager._activatePlugin(this)}constructor(e,s,t,n,u=!0,A=!1,c=!1){this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=e,this.name=s,this.priority=t,this.resolveIncludes=c,e.pluginManager||(e.pluginManager=new $e(e),e.onDisposeObservable.add(()=>{e.pluginManager=void 0})),this._pluginDefineNames=n,this._pluginManager=e.pluginManager,u&&this._pluginManager._addPlugin(this),A&&this._enable(!0),this.markAllDefinesAsDirty=e._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(e,s,t,n){return!0}hardBindForSubMesh(e,s,t,n){}bindForSubMesh(e,s,t,n){}dispose(e){}getCustomCode(e,s=0){return null}collectDefines(e){if(this._pluginDefineNames)for(let s of Object.keys(this._pluginDefineNames)){if(s[0]==="_")continue;let t=typeof this._pluginDefineNames[s];e[s]={type:t==="number"?"number":t==="string"?"string":t==="boolean"?"boolean":"object",default:this._pluginDefineNames[s]}}}prepareDefinesBeforeAttributes(e,s,t){}prepareDefines(e,s,t){}hasTexture(e){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(e){}getActiveTextures(e){}getAnimatables(e){}addFallbacks(e,s,t){return t}getSamplers(e){}getAttributes(e,s,t){}getUniformBuffersNames(e){}getUniforms(e=0){return{}}copyTo(e){B.Clone(()=>e,this)}serialize(){return B.Serialize(this)}parse(e,s,t){B.Parse(()=>this,e,s,t)}};i([a()],g.prototype,"name",void 0);i([a()],g.prototype,"priority",void 0);i([a()],g.prototype,"resolveIncludes",void 0);i([a()],g.prototype,"registerForExtraEvents",void 0);W("BABYLON.MaterialPluginBase",g);var ee=class extends M{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}},C=class T extends g{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(e,s=!0){super(e,"PBRBRDF",90,new ee,s),this._useEnergyConservation=T.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=T.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=T.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=T.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=T.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=T.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=T.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=T.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=T.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=T.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=T.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=T.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=T.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=T.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=T.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=T.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=T.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=T.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=e._dirtyCallbacks[16],this._enable(!0)}prepareDefines(e){e.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,e.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,e.SPHERICAL_HARMONICS=this._useSphericalHarmonics,e.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,e.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,e.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,e.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,e.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,e.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}};C.DEFAULT_USE_ENERGY_CONSERVATION=!0;C.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0;C.DEFAULT_USE_SPHERICAL_HARMONICS=!0;C.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0;C.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0;C.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0;C.DEFAULT_DIFFUSE_MODEL=0;C.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0;C.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0;i([a(),r("_markAllSubMeshesAsMiscDirty")],C.prototype,"useEnergyConservation",void 0);i([a(),r("_markAllSubMeshesAsMiscDirty")],C.prototype,"useSmithVisibilityHeightCorrelated",void 0);i([a(),r("_markAllSubMeshesAsMiscDirty")],C.prototype,"useSphericalHarmonics",void 0);i([a(),r("_markAllSubMeshesAsMiscDirty")],C.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);i([a(),r("_markAllSubMeshesAsMiscDirty")],C.prototype,"mixIblRadianceWithIrradiance",void 0);i([a(),r("_markAllSubMeshesAsMiscDirty")],C.prototype,"useLegacySpecularEnergyConservation",void 0);i([a("baseDiffuseModel"),r("_markAllSubMeshesAsMiscDirty")],C.prototype,"baseDiffuseModel",void 0);i([a("dielectricSpecularModel"),r("_markAllSubMeshesAsMiscDirty")],C.prototype,"dielectricSpecularModel",void 0);i([a("conductorSpecularModel"),r("_markAllSubMeshesAsMiscDirty")],C.prototype,"conductorSpecularModel",void 0);var te=class extends M{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}},y=class T extends g{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e,s=!0){super(e,"PBRClearCoat",100,new te,s),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=T._DefaultIndexOfRefraction,this.indexOfRefraction=T._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=I.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,s,t){if(!this._isEnabled)return!0;let n=this._material._disableBumpMap;return!(e._areTexturesDirty&&s.texturesEnabled&&(this._texture&&l.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking()||this._textureRoughness&&l.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking()||t.getCaps().standardDerivatives&&this._bumpTexture&&l.ClearCoatBumpTextureEnabled&&!n&&!this._bumpTexture.isReady()||this._isTintEnabled&&this._tintTexture&&l.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking()))}prepareDefinesBeforeAttributes(e,s){this._isEnabled?(e.CLEARCOAT=!0,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,e._areTexturesDirty&&s.texturesEnabled&&(this._texture&&l.ClearCoatTextureEnabled?m(this._texture,e,"CLEARCOAT_TEXTURE"):e.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&l.ClearCoatTextureEnabled?m(this._textureRoughness,e,"CLEARCOAT_TEXTURE_ROUGHNESS"):e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&l.ClearCoatBumpTextureEnabled?m(this._bumpTexture,e,"CLEARCOAT_BUMP"):e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===T._DefaultIndexOfRefraction,this._isTintEnabled?(e.CLEARCOAT_TINT=!0,this._tintTexture&&l.ClearCoatTintTextureEnabled?(m(this._tintTexture,e,"CLEARCOAT_TINT_TEXTURE"),e.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):e.CLEARCOAT_TINT_TEXTURE=!1):(e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1))):(e.CLEARCOAT=!1,e.CLEARCOAT_TEXTURE=!1,e.CLEARCOAT_TEXTURE_ROUGHNESS=!1,e.CLEARCOAT_BUMP=!1,e.CLEARCOAT_TINT=!1,e.CLEARCOAT_TINT_TEXTURE=!1,e.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.CLEARCOAT_DEFAULTIOR=!1,e.CLEARCOAT_TEXTUREDIRECTUV=0,e.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,e.CLEARCOAT_BUMPDIRECTUV=0,e.CLEARCOAT_REMAP_F0=!1,e.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,e.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(e,s,t,n){if(!this._isEnabled)return;let u=n.materialDefines,A=this._material.isFrozen,c=this._material._disableBumpMap,E=this._material._invertNormalMapX,f=this._material._invertNormalMapY;if(!e.useUbo||!A||!e.isSync){(this._texture||this._textureRoughness)&&l.ClearCoatTextureEnabled&&(e.updateFloat4("vClearCoatInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._textureRoughness?.coordinatesIndex??0,this._textureRoughness?.level??0),this._texture&&x(this._texture,e,"clearCoat"),this._textureRoughness&&!u.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&x(this._textureRoughness,e,"clearCoatRoughness")),this._bumpTexture&&t.getCaps().standardDerivatives&&l.ClearCoatTextureEnabled&&!c&&(e.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),x(this._bumpTexture,e,"clearCoatBump"),s._mirroredCameraPosition?e.updateFloat2("vClearCoatTangentSpaceParams",E?1:-1,f?1:-1):e.updateFloat2("vClearCoatTangentSpaceParams",E?-1:1,f?-1:1)),this._tintTexture&&l.ClearCoatTintTextureEnabled&&(e.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),x(this._tintTexture,e,"clearCoatTint")),e.updateFloat2("vClearCoatParams",this.intensity,this.roughness);let _=1-this._indexOfRefraction,o=1+this._indexOfRefraction,R=Math.pow(-_/o,2),L=1/this._indexOfRefraction;e.updateFloat4("vClearCoatRefractionParams",R,L,_,o),this._isTintEnabled&&(e.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),e.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}s.texturesEnabled&&(this._texture&&l.ClearCoatTextureEnabled&&e.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!u.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&l.ClearCoatTextureEnabled&&e.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&t.getCaps().standardDerivatives&&l.ClearCoatBumpTextureEnabled&&!c&&e.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&l.ClearCoatTintTextureEnabled&&e.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(e){return this._texture===e||this._textureRoughness===e||this._bumpTexture===e||this._tintTexture===e}getActiveTextures(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness),this._bumpTexture&&e.push(this._bumpTexture),this._tintTexture&&e.push(this._tintTexture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&e.push(this._tintTexture)}dispose(e){e&&(this._texture?.dispose(),this._textureRoughness?.dispose(),this._bumpTexture?.dispose(),this._tintTexture?.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(e,s,t){return e.CLEARCOAT_BUMP&&s.addFallback(t++,"CLEARCOAT_BUMP"),e.CLEARCOAT_TINT&&s.addFallback(t++,"CLEARCOAT_TINT"),e.CLEARCOAT&&s.addFallback(t++,"CLEARCOAT"),t}getSamplers(e){e.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}};y._DefaultIndexOfRefraction=1.5;i([a(),r("_markAllSubMeshesAsTexturesDirty")],y.prototype,"isEnabled",void 0);i([a()],y.prototype,"intensity",void 0);i([a()],y.prototype,"roughness",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],y.prototype,"indexOfRefraction",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],y.prototype,"texture",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],y.prototype,"useRoughnessFromMainTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],y.prototype,"textureRoughness",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],y.prototype,"remapF0OnInterfaceChange",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],y.prototype,"bumpTexture",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],y.prototype,"isTintEnabled",void 0);i([N()],y.prototype,"tintColor",void 0);i([a()],y.prototype,"tintColorAtDistance",void 0);i([a()],y.prototype,"tintThickness",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],y.prototype,"tintTexture",void 0);var se=class extends M{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}},O=class T extends g{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e,s=!0){super(e,"PBRIridescence",110,new se,s),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.minimumThickness=T._DefaultMinimumThickness,this.maximumThickness=T._DefaultMaximumThickness,this.indexOfRefraction=T._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,s){return this._isEnabled?!(e._areTexturesDirty&&s.texturesEnabled&&(this._texture&&l.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking()||this._thicknessTexture&&l.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())):!0}prepareDefinesBeforeAttributes(e,s){this._isEnabled?(e.IRIDESCENCE=!0,e._areTexturesDirty&&s.texturesEnabled&&(this._texture&&l.IridescenceTextureEnabled?m(this._texture,e,"IRIDESCENCE_TEXTURE"):e.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&l.IridescenceTextureEnabled?m(this._thicknessTexture,e,"IRIDESCENCE_THICKNESS_TEXTURE"):e.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(e.IRIDESCENCE=!1,e.IRIDESCENCE_TEXTURE=!1,e.IRIDESCENCE_THICKNESS_TEXTURE=!1,e.IRIDESCENCE_TEXTUREDIRECTUV=0,e.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(e,s){if(!this._isEnabled)return;let t=this._material.isFrozen;(!e.useUbo||!t||!e.isSync)&&((this._texture||this._thicknessTexture)&&l.IridescenceTextureEnabled&&(e.updateFloat4("vIridescenceInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._thicknessTexture?.coordinatesIndex??0,this._thicknessTexture?.level??0),this._texture&&x(this._texture,e,"iridescence"),this._thicknessTexture&&x(this._thicknessTexture,e,"iridescenceThickness")),e.updateFloat4("vIridescenceParams",this.intensity,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)),s.texturesEnabled&&(this._texture&&l.IridescenceTextureEnabled&&e.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&l.IridescenceTextureEnabled&&e.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(e){return this._texture===e||this._thicknessTexture===e}getActiveTextures(e){this._texture&&e.push(this._texture),this._thicknessTexture&&e.push(this._thicknessTexture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture)}dispose(e){e&&(this._texture?.dispose(),this._thicknessTexture?.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(e,s,t){return e.IRIDESCENCE&&s.addFallback(t++,"IRIDESCENCE"),t}getSamplers(e){e.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}};O._DefaultMinimumThickness=100;O._DefaultMaximumThickness=400;O._DefaultIndexOfRefraction=1.3;i([a(),r("_markAllSubMeshesAsTexturesDirty")],O.prototype,"isEnabled",void 0);i([a()],O.prototype,"intensity",void 0);i([a()],O.prototype,"minimumThickness",void 0);i([a()],O.prototype,"maximumThickness",void 0);i([a()],O.prototype,"indexOfRefraction",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],O.prototype,"texture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],O.prototype,"thicknessTexture",void 0);var ie=class extends M{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}},k=class extends g{set angle(e){this.direction.x=Math.cos(e),this.direction.y=Math.sin(e)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(e,s=!0){super(e,"PBRAnisotropic",110,new ie,s),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new Ae(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=e._dirtyCallbacks[16]}isReadyForSubMesh(e,s){return this._isEnabled?!(e._areTexturesDirty&&s.texturesEnabled&&this._texture&&l.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking()):!0}prepareDefinesBeforeAttributes(e,s,t){this._isEnabled?(e.ANISOTROPIC=this._isEnabled,this._isEnabled&&!t.isVerticesDataPresent(U.TangentKind)&&(e._needUVs=!0,e.MAINUV1=!0),e._areTexturesDirty&&s.texturesEnabled&&(this._texture&&l.AnisotropicTextureEnabled?m(this._texture,e,"ANISOTROPIC_TEXTURE"):e.ANISOTROPIC_TEXTURE=!1),e._areMiscDirty&&(e.ANISOTROPIC_LEGACY=this._legacy)):(e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1,e.ANISOTROPIC_TEXTUREDIRECTUV=0,e.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(e,s){if(!this._isEnabled)return;let t=this._material.isFrozen;(!e.useUbo||!t||!e.isSync)&&(this._texture&&l.AnisotropicTextureEnabled&&(e.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),x(this._texture,e,"anisotropy")),e.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),s.texturesEnabled&&this._texture&&l.AnisotropicTextureEnabled&&e.setTexture("anisotropySampler",this._texture)}hasTexture(e){return this._texture===e}getActiveTextures(e){this._texture&&e.push(this._texture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}dispose(e){e&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(e,s,t){return e.ANISOTROPIC&&s.addFallback(t++,"ANISOTROPIC"),t}getSamplers(e){e.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(e,s,t){super.parse(e,s,t),e.legacy===void 0&&(this.legacy=!0)}};i([a(),r("_markAllSubMeshesAsTexturesDirty")],k.prototype,"isEnabled",void 0);i([a()],k.prototype,"intensity",void 0);i([Re()],k.prototype,"direction",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],k.prototype,"texture",void 0);i([a(),r("_markAllSubMeshesAsMiscDirty")],k.prototype,"legacy",void 0);var re=class extends M{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}},v=class extends g{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e,s=!0){super(e,"Sheen",120,new re,s),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=I.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,s){return this._isEnabled?!(e._areTexturesDirty&&s.texturesEnabled&&(this._texture&&l.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking()||this._textureRoughness&&l.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())):!0}prepareDefinesBeforeAttributes(e,s){this._isEnabled?(e.SHEEN=!0,e.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,e.SHEEN_ROUGHNESS=this._roughness!==null,e.SHEEN_ALBEDOSCALING=this._albedoScaling,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,e._areTexturesDirty&&s.texturesEnabled&&(this._texture&&l.SheenTextureEnabled?(m(this._texture,e,"SHEEN_TEXTURE"),e.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):e.SHEEN_TEXTURE=!1,this._textureRoughness&&l.SheenTextureEnabled?m(this._textureRoughness,e,"SHEEN_TEXTURE_ROUGHNESS"):e.SHEEN_TEXTURE_ROUGHNESS=!1)):(e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_TEXTURE_ROUGHNESS=!1,e.SHEEN_LINKWITHALBEDO=!1,e.SHEEN_ROUGHNESS=!1,e.SHEEN_ALBEDOSCALING=!1,e.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,e.SHEEN_GAMMATEXTURE=!1,e.SHEEN_TEXTUREDIRECTUV=0,e.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(e,s,t,n){if(!this._isEnabled)return;let u=n.materialDefines,A=this._material.isFrozen;(!e.useUbo||!A||!e.isSync)&&((this._texture||this._textureRoughness)&&l.SheenTextureEnabled&&(e.updateFloat4("vSheenInfos",this._texture?.coordinatesIndex??0,this._texture?.level??0,this._textureRoughness?.coordinatesIndex??0,this._textureRoughness?.level??0),this._texture&&x(this._texture,e,"sheen"),this._textureRoughness&&!u.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&x(this._textureRoughness,e,"sheenRoughness")),e.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),this._roughness!==null&&e.updateFloat("vSheenRoughness",this._roughness)),s.texturesEnabled&&(this._texture&&l.SheenTextureEnabled&&e.setTexture("sheenSampler",this._texture),this._textureRoughness&&!u.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&l.SheenTextureEnabled&&e.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(e){return this._texture===e||this._textureRoughness===e}getActiveTextures(e){this._texture&&e.push(this._texture),this._textureRoughness&&e.push(this._textureRoughness)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&e.push(this._textureRoughness)}dispose(e){e&&(this._texture?.dispose(),this._textureRoughness?.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(e,s,t){return e.SHEEN&&s.addFallback(t++,"SHEEN"),t}getSamplers(e){e.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}};i([a(),r("_markAllSubMeshesAsTexturesDirty")],v.prototype,"isEnabled",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],v.prototype,"linkSheenWithAlbedo",void 0);i([a()],v.prototype,"intensity",void 0);i([N()],v.prototype,"color",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],v.prototype,"texture",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],v.prototype,"useRoughnessFromMainTexture",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],v.prototype,"roughness",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],v.prototype,"textureRoughness",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],v.prototype,"albedoScaling",void 0);var ae=class extends M{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}},S=class T extends g{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(e){this._scene.enableSubSurfaceForPrePass()&&e&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(e))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(e){e>=1?this._volumeIndexOfRefraction=e:this._volumeIndexOfRefraction=-1}get legacyTransluceny(){return this.legacyTranslucency}set legacyTransluceny(e){this.legacyTranslucency=e}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(e,s=!0){super(e,"PBRSubSurface",130,new ae,s),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=I.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=I.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=T.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTranslucency=T.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=e.getScene(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=e._dirtyCallbacks[32]}isReadyForSubMesh(e,s){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(e._areTexturesDirty&&s.texturesEnabled){if(this._thicknessTexture&&l.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking()||this._refractionIntensityTexture&&l.RefractionIntensityTextureEnabled&&!this._refractionIntensityTexture.isReadyOrNotBlocking()||this._translucencyColorTexture&&l.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking()||this._translucencyIntensityTexture&&l.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;let t=this._getRefractionTexture(s);if(t&&l.RefractionTextureEnabled&&!t.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(e,s){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled){e.SUBSURFACE=!1,e.SS_DISPERSION=!1,e.SS_TRANSLUCENCY=!1,e.SS_SCATTERING=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,e.SS_HAS_THICKNESS=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,e.SS_REFRACTIONMAP_3D=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1,e.SS_USE_GLTF_TEXTURES=!1,e.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,e.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,e.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,e.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1;return}if(e._areTexturesDirty){if(e.SUBSURFACE=!0,e.SS_DISPERSION=this._isDispersionEnabled,e.SS_TRANSLUCENCY=this._isTranslucencyEnabled,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_TRANSLUCENCY_LEGACY=this.legacyTranslucency,e.SS_SCATTERING=this._isScatteringEnabled,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_REFRACTIONINTENSITY_TEXTURE=!1,e.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,e.SS_HAS_THICKNESS=!1,e.SS_USE_GLTF_TEXTURES=!1,e.SS_REFRACTION=!1,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,e.SS_REFRACTIONMAP_3D=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_LINEARSPECULARREFRACTION=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,e.SS_ALBEDOFORREFRACTIONTINT=!1,e.SS_ALBEDOFORTRANSLUCENCYTINT=!1,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,e.SS_USE_THICKNESS_AS_DEPTH=!1,e.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,e.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,e._areTexturesDirty&&s.texturesEnabled&&(this._thicknessTexture&&l.ThicknessTextureEnabled&&m(this._thicknessTexture,e,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&l.RefractionIntensityTextureEnabled&&m(this._refractionIntensityTexture,e,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&l.TranslucencyIntensityTextureEnabled&&m(this._translucencyIntensityTexture,e,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&l.TranslucencyColorTextureEnabled&&(m(this._translucencyColorTexture,e,"SS_TRANSLUCENCYCOLOR_TEXTURE"),e.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),e.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,e.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,e.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,e.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&s.texturesEnabled){let t=this._getRefractionTexture(s);t&&l.RefractionTextureEnabled&&(e.SS_REFRACTION=!0,e.SS_REFRACTIONMAP_3D=t.isCube,e.SS_GAMMAREFRACTION=t.gammaSpace,e.SS_RGBDREFRACTION=t.isRGBD,e.SS_LINEARSPECULARREFRACTION=t.linearSpecularLOD,e.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&t.isCube?!t.invertZ:t.invertZ,e.SS_LODINREFRACTIONALPHA=t.lodLevelInAlpha,e.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,e.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,e.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=t.isCube&&t.boundingBoxSize,e.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(e.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(e,s,t,n){if(!(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled))if(this.maximumThickness===0&&this.minimumThickness===0)e.updateFloat2("vThicknessParam",0,0);else{n.getRenderingMesh().getWorldMatrix().decompose(Y.Vector3[0]);let u=Math.max(Math.abs(Y.Vector3[0].x),Math.abs(Y.Vector3[0].y),Math.abs(Y.Vector3[0].z));e.updateFloat2("vThicknessParam",this.minimumThickness*u,(this.maximumThickness-this.minimumThickness)*u)}}bindForSubMesh(e,s,t,n){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;let u=n.materialDefines,A=this._material.isFrozen,c=this._material.realTimeFiltering,E=u.LODBASEDMICROSFURACE,f=this._getRefractionTexture(s);if(!e.useUbo||!A||!e.isSync){if(this._thicknessTexture&&l.ThicknessTextureEnabled&&(e.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),x(this._thicknessTexture,e,"thickness")),this._refractionIntensityTexture&&l.RefractionIntensityTextureEnabled&&u.SS_REFRACTIONINTENSITY_TEXTURE&&(e.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),x(this._refractionIntensityTexture,e,"refractionIntensity")),this._translucencyColorTexture&&l.TranslucencyColorTextureEnabled&&u.SS_TRANSLUCENCYCOLOR_TEXTURE&&(e.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),x(this._translucencyColorTexture,e,"translucencyColor")),this._translucencyIntensityTexture&&l.TranslucencyIntensityTextureEnabled&&u.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(e.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),x(this._translucencyIntensityTexture,e,"translucencyIntensity")),f&&l.RefractionTextureEnabled){e.updateMatrix("refractionMatrix",f.getRefractionTextureMatrix());let _=1;f.isCube||f.depth&&(_=f.depth);let o=f.getSize().width,R=this.volumeIndexOfRefraction;if(e.updateFloat4("vRefractionInfos",f.level,1/R,_,this._invertRefractionY?-1:1),e.updateFloat4("vRefractionMicrosurfaceInfos",o,f.lodGenerationScale,f.lodGenerationOffset,1/this.indexOfRefraction),c&&e.updateFloat2("vRefractionFilteringInfo",o,Math.log2(o)),f.boundingBoxSize){let L=f;e.updateVector3("vRefractionPosition",L.boundingBoxPosition),e.updateVector3("vRefractionSize",L.boundingBoxSize)}}this._isScatteringEnabled&&e.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),e.updateColor3("vDiffusionDistance",this.diffusionDistance),e.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),e.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),e.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),e.updateFloat("dispersion",this.dispersion)}s.texturesEnabled&&(this._thicknessTexture&&l.ThicknessTextureEnabled&&e.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&l.RefractionIntensityTextureEnabled&&u.SS_REFRACTIONINTENSITY_TEXTURE&&e.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&l.TranslucencyIntensityTextureEnabled&&u.SS_TRANSLUCENCYINTENSITY_TEXTURE&&e.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&l.TranslucencyColorTextureEnabled&&u.SS_TRANSLUCENCYCOLOR_TEXTURE&&e.setTexture("translucencyColorSampler",this._translucencyColorTexture),f&&l.RefractionTextureEnabled&&(E?e.setTexture("refractionSampler",f):(e.setTexture("refractionSampler",f._lodTextureMid||f),e.setTexture("refractionSamplerLow",f._lodTextureLow||f),e.setTexture("refractionSamplerHigh",f._lodTextureHigh||f))))}_getRefractionTexture(e){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?e.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(e){l.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&e.push(this._refractionTexture)}hasTexture(e){return this._thicknessTexture===e||this._refractionTexture===e||this._refractionIntensityTexture===e||this._translucencyIntensityTexture===e||this._translucencyColorTexture===e}hasRenderTargetTextures(){return!!(l.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(e){this._thicknessTexture&&e.push(this._thicknessTexture),this._refractionTexture&&e.push(this._refractionTexture),this._refractionIntensityTexture&&e.push(this._refractionIntensityTexture),this._translucencyColorTexture&&e.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&e.push(this._translucencyIntensityTexture)}getAnimatables(e){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),this._refractionIntensityTexture&&this._refractionIntensityTexture.animations&&this._refractionIntensityTexture.animations.length>0&&e.push(this._refractionIntensityTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&e.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&e.push(this._translucencyIntensityTexture)}dispose(e){e&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._refractionIntensityTexture&&this._refractionIntensityTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(e,s,t){return e.SS_SCATTERING&&s.addFallback(t++,"SS_SCATTERING"),e.SS_TRANSLUCENCY&&s.addFallback(t++,"SS_TRANSLUCENCY"),t}getSamplers(e){e.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}};S.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1;S.DEFAULT_LEGACY_TRANSLUCENCY=!1;i([a(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"isRefractionEnabled",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"isTranslucencyEnabled",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"isDispersionEnabled",void 0);i([a(),r("_markScenePrePassDirty")],S.prototype,"isScatteringEnabled",void 0);i([a()],S.prototype,"_scatteringDiffusionProfileIndex",void 0);i([a()],S.prototype,"refractionIntensity",void 0);i([a()],S.prototype,"translucencyIntensity",void 0);i([a()],S.prototype,"useAlbedoToTintRefraction",void 0);i([a()],S.prototype,"useAlbedoToTintTranslucency",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"thicknessTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"refractionTexture",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"indexOfRefraction",void 0);i([a()],S.prototype,"_volumeIndexOfRefraction",void 0);i([r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"volumeIndexOfRefraction",null);i([a(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertRefractionY",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"linkRefractionWithTransparency",void 0);i([a()],S.prototype,"minimumThickness",void 0);i([a()],S.prototype,"maximumThickness",void 0);i([a()],S.prototype,"useThicknessAsDepth",void 0);i([N()],S.prototype,"tintColor",void 0);i([a()],S.prototype,"tintColorAtDistance",void 0);i([a()],S.prototype,"dispersion",void 0);i([N()],S.prototype,"diffusionDistance",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useMaskFromThicknessTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"refractionIntensityTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"translucencyIntensityTexture",void 0);i([N()],S.prototype,"translucencyColor",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"translucencyColorTexture",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useGltfStyleTextures",void 0);i([a()],S.prototype,"applyAlbedoAfterSubSurface",void 0);i([a()],S.prototype,"legacyTranslucency",void 0);var ne=class extends M{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}},F=class extends g{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(e,s=!0){super(e,"DetailMap",140,new ne,s),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=P.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e._dirtyCallbacks[1]}isReadyForSubMesh(e,s,t){return this._isEnabled?!(e._areTexturesDirty&&s.texturesEnabled&&t.getCaps().standardDerivatives&&this._texture&&l.DetailTextureEnabled&&!this._texture.isReady()):!0}prepareDefines(e,s){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;let t=s.getEngine();e._areTexturesDirty&&(t.getCaps().standardDerivatives&&this._texture&&l.DetailTextureEnabled&&this._isEnabled?(m(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1}bindForSubMesh(e,s){if(!this._isEnabled)return;let t=this._material.isFrozen;(!e.useUbo||!t||!e.isSync)&&this._texture&&l.DetailTextureEnabled&&(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),x(this._texture,e,"detail")),s.texturesEnabled&&this._texture&&l.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture)}hasTexture(e){return this._texture===e}getActiveTextures(e){this._texture&&e.push(this._texture)}getAnimatables(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)}dispose(e){e&&this._texture?.dispose()}getClassName(){return"DetailMapConfiguration"}getSamplers(e){e.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}};i([p("detailTexture"),r("_markAllSubMeshesAsTexturesDirty")],F.prototype,"texture",void 0);i([a()],F.prototype,"diffuseBlendLevel",void 0);i([a()],F.prototype,"roughnessBlendLevel",void 0);i([a()],F.prototype,"bumpLevel",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],F.prototype,"normalBlendMethod",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isEnabled",void 0);var V={effect:null,subMesh:null},le=class extends Qe(M){},Z=class extends Ke(le){constructor(e){super(e),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.USE_VERTEX_PULLING=!1,this.CLUSTLIGHT_SLICES=0,this.CLUSTLIGHT_BATCH=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}},oe=class extends Ze(je){},d=class T extends oe{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(e){this._realTimeFiltering=e,this.markAsDirty(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(e){this._realTimeFilteringQuality=e,this.markAsDirty(1)}get canRenderToMRT(){return!0}constructor(e,s,t=!1){super(e,s,void 0,t||T.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new Se(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=T.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=I.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new I(0,0,0),this._albedoColor=new I(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new I(1,1,1),this._reflectionColor=new I(1,1,1),this._emissiveColor=new I(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=T.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._renderTargets=new pe(16),this._globalAmbientColor=new I(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new C(this),this.clearCoat=new y(this),this.iridescence=new O(this),this.anisotropy=new k(this),this.sheen=new v(this),this.subSurface=new S(this),this.detailMap=new F(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),l.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=Q(this.getScene()),this.prePassConfiguration=new K}get hasRenderTargetTextures(){return l.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget?!0:this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){return this._transparencyMode===T.PBRMATERIAL_OPAQUE||this._transparencyMode===T.PBRMATERIAL_ALPHATEST||this.subSurface?.disableAlphaBlending}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:this._disableAlphaBlending?!1:this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromAlbedoTexture()}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this.subSurface?.disableAlphaBlending?!1:this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===T.PBRMATERIAL_ALPHATEST)}_shouldUseAlphaFromAlbedoTexture(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==T.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha||this._opacityTexture!=null}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(e,s,t){this._uniformBufferLayoutBuilt||this.buildUniformLayout();let n=s._drawWrapper;if(n.effect&&this.isFrozen&&n._wasPreviouslyReady&&n._wasPreviouslyUsingInstances===t)return!0;s.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),s.materialDefines=new Z(this._eventInfo.defineNames));let u=s.materialDefines;if(this._isReadyForSubMesh(s))return!0;let A=this.getScene(),c=A.getEngine();if(u._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,A.texturesEnabled)){if(this._albedoTexture&&l.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking()||this._baseWeightTexture&&l.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking()||this._baseDiffuseRoughnessTexture&&l.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking()||this._ambientTexture&&l.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking()||this._opacityTexture&&l.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;let R=this._getReflectionTexture();if(R&&l.ReflectionTextureEnabled){if(!R.isReadyOrNotBlocking())return!1;if(R.irradianceTexture){if(!R.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!R.sphericalPolynomial&&R.getInternalTexture()?._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&l.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking()||this._emissiveTexture&&l.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(l.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking()||this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking()||this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(c.getCaps().standardDerivatives&&this._bumpTexture&&l.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady()||this._environmentBRDFTexture&&l.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=u,this._eventInfo.subMesh=s,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh||u._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(u.AREALIGHTUSED||u.CLUSTLIGHT_BATCH){for(let R=0;R<e.lightSources.length;R++)if(!e.lightSources[R]._isReady())return!1}!c.getCaps().standardDerivatives&&!e.isVerticesDataPresent(U.NormalKind)&&(e.createNormals(!0),ce.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));let E=s.effect,f=u._areLightsDisposed,_=this._prepareEffect(e,s.getRenderingMesh(),u,this.onCompiled,this.onError,t,null),o=!1;if(_)if(this._onEffectCreatedObservable&&(V.effect=_,V.subMesh=s,this._onEffectCreatedObservable.notifyObservers(V)),this.allowShaderHotSwapping&&E&&!_.isReady()){if(_=E,u.markAsUnprocessed(),o=this.isFrozen,f)return u._areLightsDisposed=!0,!1}else A.resetCachedMaterial(),s.setEffect(_,u,this._materialContext);return!s.effect||!s.effect.isReady()?!1:(u._renderId=A.getRenderId(),n._wasPreviouslyReady=!o,n._wasPreviouslyUsingInstances=!!t,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!!(this._metallic!=null||this._roughness!=null||this._metallicTexture)}_prepareEffect(e,s,t,n=null,u=null,A=null,c=null){if(this._prepareDefines(e,s,t,A,c),!t.isDirty)return null;t.markAsProcessed();let f=this.getScene().getEngine(),_=new me,o=0;t.USESPHERICALINVERTEX&&_.addFallback(o++,"USESPHERICALINVERTEX"),t.FOG&&_.addFallback(o,"FOG"),t.SPECULARAA&&_.addFallback(o,"SPECULARAA"),t.POINTSIZE&&_.addFallback(o,"POINTSIZE"),t.LOGARITHMICDEPTH&&_.addFallback(o,"LOGARITHMICDEPTH"),t.PARALLAX&&_.addFallback(o,"PARALLAX"),t.PARALLAX_RHS&&_.addFallback(o,"PARALLAX_RHS"),t.PARALLAXOCCLUSION&&_.addFallback(o++,"PARALLAXOCCLUSION"),t.ENVIRONMENTBRDF&&_.addFallback(o++,"ENVIRONMENTBRDF"),t.TANGENT&&_.addFallback(o++,"TANGENT"),t.BUMP&&_.addFallback(o++,"BUMP"),o=Pe(t,_,this._maxSimultaneousLights,o++),t.SPECULARTERM&&_.addFallback(o++,"SPECULARTERM"),t.USESPHERICALFROMREFLECTIONMAP&&_.addFallback(o++,"USESPHERICALFROMREFLECTIONMAP"),t.USEIRRADIANCEMAP&&_.addFallback(o++,"USEIRRADIANCEMAP"),t.LIGHTMAP&&_.addFallback(o++,"LIGHTMAP"),t.NORMAL&&_.addFallback(o++,"NORMAL"),t.AMBIENT&&_.addFallback(o++,"AMBIENT"),t.EMISSIVE&&_.addFallback(o++,"EMISSIVE"),t.VERTEXCOLOR&&_.addFallback(o++,"VERTEXCOLOR"),t.MORPHTARGETS&&_.addFallback(o++,"MORPHTARGETS"),t.MULTIVIEW&&_.addFallback(0,"MULTIVIEW");let R=[U.PositionKind];t.NORMAL&&R.push(U.NormalKind),t.TANGENT&&R.push(U.TangentKind);for(let X=1;X<=6;++X)t["UV"+X]&&R.push(`uv${X===1?"":X}`);t.VERTEXCOLOR&&R.push(U.ColorKind),De(R,e,t,_),ve(R,t),ge(R,e,t),Me(R,e,t);let L="pbr",b=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vEmissiveInfos","vReflectivityInfos","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],D=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"];Ye(b,D,!0);let z=["Material","Scene","Mesh"],ue={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:t.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=_,this._eventInfo.fallbackRank=o,this._eventInfo.defines=t,this._eventInfo.uniforms=b,this._eventInfo.attributes=R,this._eventInfo.samplers=D,this._eventInfo.uniformBuffersNames=z,this._eventInfo.customCode=void 0,this._eventInfo.mesh=e,this._eventInfo.indexParameters=ue,this._callbackPluginEventGeneric(128,this._eventInfo),j.AddUniformsAndSamplers(b,D),K.AddUniforms(b),K.AddSamplers(D),xe(b),w&&(w.PrepareUniforms(b,t),w.PrepareSamplers(D,t)),ze({uniformsNames:b,uniformBuffersNames:z,samplers:D,defines:t,maxSimultaneousLights:this._maxSimultaneousLights});let he={};this.customShaderNameResolve&&(L=this.customShaderNameResolve(L,b,z,D,t,R,he));let qe=t.toString(),et=f.createEffect(L,{attributes:R,uniformsNames:b,uniformBuffersNames:z,samplers:D,defines:qe,fallbacks:_,onCompiled:n,onError:u,indexParameters:ue,processFinalCode:he.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:t.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:()=>_e(this,null,function*(){this.shaderLanguage===1?yield Promise.all([import("./chunk-VMZ22MCG.js"),import("./chunk-JCA6BZ5L.js")]):yield Promise.all([import("./chunk-SFMAOP4P.js"),import("./chunk-JARPUL7X.js")]),this._shadersLoaded=!0})},f);return this._eventInfo.customCode=void 0,et}_prepareDefines(e,s,t,n=null,u=null){let A=s.hasThinInstances,c=this.getScene(),E=c.getEngine();Ue(c,e,t,!0,this._maxSimultaneousLights,this._disableLighting),t._needNormals=!0,Ge(c,t);let f=this.needAlphaBlendingForMesh(e)&&this.getScene().useOrderIndependentTransparency;if(Xe(c,t,this.canRenderToMRT&&!f),Ve(c,t,f),j.PrepareDefines(E.currentRenderPassId,e,t),t.METALLICWORKFLOW=this.isMetallicWorkflow(),t._areTexturesDirty){t._needUVs=!1;for(let _=1;_<=6;++_)t["MAINUV"+_]=!1;if(c.texturesEnabled){t.ALBEDODIRECTUV=0,t.BASE_WEIGHTDIRECTUV=0,t.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,t.AMBIENTDIRECTUV=0,t.OPACITYDIRECTUV=0,t.EMISSIVEDIRECTUV=0,t.REFLECTIVITYDIRECTUV=0,t.MICROSURFACEMAPDIRECTUV=0,t.METALLIC_REFLECTANCEDIRECTUV=0,t.REFLECTANCEDIRECTUV=0,t.BUMPDIRECTUV=0,t.LIGHTMAPDIRECTUV=0,E.getCaps().textureLOD&&(t.LODBASEDMICROSFURACE=!0),this._albedoTexture&&l.DiffuseTextureEnabled?(m(this._albedoTexture,t,"ALBEDO"),t.GAMMAALBEDO=this._albedoTexture.gammaSpace):t.ALBEDO=!1,this._baseWeightTexture&&l.BaseWeightTextureEnabled?m(this._baseWeightTexture,t,"BASE_WEIGHT"):t.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&l.BaseDiffuseRoughnessTextureEnabled?m(this._baseDiffuseRoughnessTexture,t,"BASE_DIFFUSE_ROUGHNESS"):t.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&l.AmbientTextureEnabled?(m(this._ambientTexture,t,"AMBIENT"),t.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):t.AMBIENT=!1,this._opacityTexture&&l.OpacityTextureEnabled?(m(this._opacityTexture,t,"OPACITY"),t.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):t.OPACITY=!1;let _=this._getReflectionTexture(),o=this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||E.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture!=null;ke(c,_,t,this.realTimeFiltering,this.realTimeFilteringQuality,!o),this._lightmapTexture&&l.LightmapTextureEnabled?(m(this._lightmapTexture,t,"LIGHTMAP"),t.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,t.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,t.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):t.LIGHTMAP=!1,this._emissiveTexture&&l.EmissiveTextureEnabled?(m(this._emissiveTexture,t,"EMISSIVE"),t.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):t.EMISSIVE=!1,l.SpecularTextureEnabled?(this._metallicTexture?(m(this._metallicTexture,t,"REFLECTIVITY"),t.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,t.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,t.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,t.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,t.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?(m(this._reflectivityTexture,t,"REFLECTIVITY"),t.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,t.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,t.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):t.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(t.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?(m(this._metallicReflectanceTexture,t,"METALLIC_REFLECTANCE"),t.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):t.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?(m(this._reflectanceTexture,t,"REFLECTANCE"),t.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):t.REFLECTANCE=!1):(t.METALLIC_REFLECTANCE=!1,t.REFLECTANCE=!1),this._microSurfaceTexture?m(this._microSurfaceTexture,t,"MICROSURFACEMAP"):t.MICROSURFACEMAP=!1):(t.REFLECTIVITY=!1,t.MICROSURFACEMAP=!1),E.getCaps().standardDerivatives&&this._bumpTexture&&l.BumpTextureEnabled&&!this._disableBumpMap?(m(this._bumpTexture,t,"BUMP"),this._useParallax&&this._albedoTexture&&l.DiffuseTextureEnabled?(t.PARALLAX=!0,t.PARALLAX_RHS=c.useRightHandedSystem,t.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):t.PARALLAX=!1,t.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(t.BUMP=!1,t.PARALLAX=!1,t.PARALLAX_RHS=!1,t.PARALLAXOCCLUSION=!1,t.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&l.ReflectionTextureEnabled?(t.ENVIRONMENTBRDF=!0,t.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(t.ENVIRONMENTBRDF=!1,t.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?t.ALPHAFROMALBEDO=!0:t.ALPHAFROMALBEDO=!1}t.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===T.LIGHTFALLOFF_STANDARD?(t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===T.LIGHTFALLOFF_GLTF?(t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!0):(t.USEPHYSICALLIGHTFALLOFF=!0,t.USEGLTFLIGHTFALLOFF=!1),t.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?t.TWOSIDEDLIGHTING=!0:t.TWOSIDEDLIGHTING=!1,t.MIRRORED=!!c._mirroredCameraPosition,t.SPECULARAA=E.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(t._areTexturesDirty||t._areMiscDirty)&&(t.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,t.PREMULTIPLYALPHA=this.alphaMode===7||this.alphaMode===8,t.ALPHABLEND=this.needAlphaBlendingForMesh(e),t.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,t.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),t._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(t),t.FORCENORMALFORWARD=this._forceNormalForward,t.RADIANCEOCCLUSION=this._useRadianceOcclusion,t.HORIZONOCCLUSION=this._useHorizonOcclusion,t._areMiscDirty&&(Fe(e,c,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(e),t,this._applyDecalMapAfterDetailMap,this._useVertexPulling,s,this._isVertexOutputInvariant),t.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!e.isVerticesDataPresent(U.NormalKind),t.DEBUGMODE=this._debugMode),He(c,E,this,t,!!n,u,A),this._eventInfo.defines=t,this._eventInfo.mesh=e,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),Be(e,t,!0,!0,!0,this._transparencyMode!==T.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(e,s,t){let n=Te({clipPlane:!1,useInstances:!1},t);this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo),(()=>{if(this._breakShaderLoadedCheck)return;let A=new Z(this._eventInfo.defineNames),c=this._prepareEffect(e,e,A,void 0,void 0,n.useInstances,n.clipPlane);this._onEffectCreatedObservable&&(V.effect=c,V.subMesh=null,this._onEffectCreatedObservable.notifyObservers(V)),c.isReady()?s&&s(this):c.onCompileObservable.add(()=>{s&&s(this)})})()}buildUniformLayout(){let e=this._uniformBuffer;e.addUniform("vAlbedoInfos",2),e.addUniform("vBaseWeightInfos",2),e.addUniform("vBaseDiffuseRoughnessInfos",2),e.addUniform("vAmbientInfos",4),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vReflectivityInfos",3),e.addUniform("vMicroSurfaceSamplerInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("albedoMatrix",16),e.addUniform("baseWeightMatrix",16),e.addUniform("baseDiffuseRoughnessMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("reflectivityMatrix",16),e.addUniform("microSurfaceSamplerMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("vAlbedoColor",4),e.addUniform("baseWeight",1),e.addUniform("baseDiffuseRoughness",1),e.addUniform("vLightingIntensity",4),e.addUniform("pointSize",1),e.addUniform("vReflectivityColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("vAmbientColor",3),e.addUniform("vDebugMode",2),e.addUniform("vMetallicReflectanceFactors",4),e.addUniform("vMetallicReflectanceInfos",2),e.addUniform("metallicReflectanceMatrix",16),e.addUniform("vReflectanceInfos",2),e.addUniform("reflectanceMatrix",16),e.addUniform("cameraInfo",4),We(e,!0,!0,!0,!0,!0),super.buildUniformLayout()}bindForSubMesh(e,s,t){let n=this.getScene(),u=t.materialDefines;if(!u)return;let A=t.effect;if(!A)return;this._activeEffect=A,s.getMeshUniformBuffer().bindToEffect(A,"Mesh"),s.transferToEffect(e);let c=n.getEngine();this._uniformBuffer.bindToEffect(A,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,n,s,e,this.isFrozen),j.Bind(c.currentRenderPassId,this._activeEffect,s,e,this);let E=n.activeCamera;E?this._uniformBuffer.updateFloat4("cameraInfo",E.minZ,E.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=t,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),u.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));let f=this._mustRebind(n,A,t,s.visibility);Ne(s,this._activeEffect,this.prePassConfiguration);let _=null,o=this._uniformBuffer;if(f){if(this.bindViewProjection(A),_=this._getReflectionTexture(),!o.useUbo||!this.isFrozen||!o.isSync||t._drawWrapper._forceRebindOnNextCall){if(n.texturesEnabled&&(this._albedoTexture&&l.DiffuseTextureEnabled&&(o.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),x(this._albedoTexture,o,"albedo")),this._baseWeightTexture&&l.BaseWeightTextureEnabled&&(o.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),x(this._baseWeightTexture,o,"baseWeight")),this._baseDiffuseRoughnessTexture&&l.BaseDiffuseRoughnessTextureEnabled&&(o.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),x(this._baseDiffuseRoughnessTexture,o,"baseDiffuseRoughness")),this._ambientTexture&&l.AmbientTextureEnabled&&(o.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),x(this._ambientTexture,o,"ambient")),this._opacityTexture&&l.OpacityTextureEnabled&&(o.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),x(this._opacityTexture,o,"opacity")),this._emissiveTexture&&l.EmissiveTextureEnabled&&(o.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),x(this._emissiveTexture,o,"emissive")),this._lightmapTexture&&l.LightmapTextureEnabled&&(o.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),x(this._lightmapTexture,o,"lightmap")),l.SpecularTextureEnabled&&(this._metallicTexture?(o.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),x(this._metallicTexture,o,"reflectivity")):this._reflectivityTexture&&(o.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),x(this._reflectivityTexture,o,"reflectivity")),this._metallicReflectanceTexture&&(o.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),x(this._metallicReflectanceTexture,o,"metallicReflectance")),this._reflectanceTexture&&u.REFLECTANCE&&(o.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),x(this._reflectanceTexture,o,"reflectance")),this._microSurfaceTexture&&(o.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),x(this._microSurfaceTexture,o,"microSurfaceSampler"))),this._bumpTexture&&c.getCaps().standardDerivatives&&l.BumpTextureEnabled&&!this._disableBumpMap&&(o.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),x(this._bumpTexture,o,"bump"),n._mirroredCameraPosition?o.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):o.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),ye(n,u,o,this._reflectionColor,_,this.realTimeFiltering,!0,!0,!0,!0,!0)),this.pointsCloud&&o.updateFloat("pointSize",this.pointSize),u.METALLICWORKFLOW){G.Color4[0].r=this._metallic===void 0||this._metallic===null?1:this._metallic,G.Color4[0].g=this._roughness===void 0||this._roughness===null?1:this._roughness;let R=this.subSurface?._indexOfRefraction??1.5,L=1;G.Color4[0].b=R;let b=Math.pow((R-L)/(R+L),2);G.Color4[0].a=b,o.updateDirectColor4("vReflectivityColor",G.Color4[0]),o.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else o.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);o.updateColor3("vEmissiveColor",l.EmissiveTextureEnabled?this._emissiveColor:I.BlackReadOnly),!u.SS_REFRACTION&&this.subSurface?._linkRefractionWithTransparency?o.updateColor4("vAlbedoColor",this._albedoColor,1):o.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),o.updateFloat("baseWeight",this._baseWeight),o.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*n.environmentIntensity,this._lightingInfos.w=this._specularIntensity,o.updateVector4("vLightingIntensity",this._lightingInfos),n.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),o.updateColor3("vAmbientColor",this._globalAmbientColor),o.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}n.texturesEnabled&&(this._albedoTexture&&l.DiffuseTextureEnabled&&o.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&l.BaseWeightTextureEnabled&&o.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&l.BaseDiffuseRoughnessTextureEnabled&&o.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&l.AmbientTextureEnabled&&o.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&l.OpacityTextureEnabled&&o.setTexture("opacitySampler",this._opacityTexture),Le(n,u,o,_,this.realTimeFiltering),u.ENVIRONMENTBRDF&&o.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&l.EmissiveTextureEnabled&&o.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&l.LightmapTextureEnabled&&o.setTexture("lightmapSampler",this._lightmapTexture),l.SpecularTextureEnabled&&(this._metallicTexture?o.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&o.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&o.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&u.REFLECTANCE&&o.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&o.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&c.getCaps().standardDerivatives&&l.BumpTextureEnabled&&!this._disableBumpMap&&o.setTexture("bumpSampler",this._bumpTexture)),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(s)&&this.getScene().depthPeelingRenderer.bind(A),this._eventInfo.subMesh=t,this._callbackPluginEventBindForSubMesh(this._eventInfo),de(this._activeEffect,this,n),this.bindEyePosition(A)}else n.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);(f||!this.isFrozen)&&(n.lightsEnabled&&!this._disableLighting&&Oe(n,s,this._activeEffect,u,this._maxSimultaneousLights),(n.fogEnabled&&s.applyFog&&n.fogMode!==we.FOGMODE_NONE||_||this.subSurface.refractionTexture||s.receiveShadows||u.PREPASS||u.CLUSTLIGHT_BATCH)&&this.bindView(A),Ce(n,s,this._activeEffect,!0),u.NUM_MORPH_INFLUENCERS&&be(s,this._activeEffect),u.BAKED_VERTEX_ANIMATION_TEXTURE&&s.bakedVertexAnimationManager?.bind(A,u.INSTANCES),this._imageProcessingConfiguration.bind(this._activeEffect),Ie(u,this._activeEffect,n)),this._afterBind(s,this._activeEffect,t),o.update()}getAnimatables(){let e=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&e.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&e.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&e.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&e.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&e.push(this._microSurfaceTexture),e}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture}getActiveTextures(){let e=super.getActiveTextures();return this._albedoTexture&&e.push(this._albedoTexture),this._baseWeightTexture&&e.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&e.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._metallicReflectanceTexture&&e.push(this._metallicReflectanceTexture),this._reflectanceTexture&&e.push(this._reflectanceTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),e}hasTexture(e){return!!(super.hasTexture(e)||this._albedoTexture===e||this._baseWeightTexture===e||this._baseDiffuseRoughnessTexture===e||this._ambientTexture===e||this._opacityTexture===e||this._reflectionTexture===e||this._emissiveTexture===e||this._reflectivityTexture===e||this._metallicTexture===e||this._metallicReflectanceTexture===e||this._reflectanceTexture===e||this._microSurfaceTexture===e||this._bumpTexture===e||this._lightmapTexture===e)}setPrePassRenderer(){if(!this.subSurface?.isScatteringEnabled)return!1;let e=this.getScene().enableSubSurfaceForPrePass();return e&&(e.enabled=!0),!0}dispose(e,s){this._breakShaderLoadedCheck=!0,s&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._albedoTexture?.dispose(),this._baseWeightTexture?.dispose(),this._baseDiffuseRoughnessTexture?.dispose(),this._ambientTexture?.dispose(),this._opacityTexture?.dispose(),this._reflectionTexture?.dispose(),this._emissiveTexture?.dispose(),this._metallicTexture?.dispose(),this._reflectivityTexture?.dispose(),this._bumpTexture?.dispose(),this._lightmapTexture?.dispose(),this._metallicReflectanceTexture?.dispose(),this._reflectanceTexture?.dispose(),this._microSurfaceTexture?.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(e,s)}};d.PBRMATERIAL_OPAQUE=P.MATERIAL_OPAQUE;d.PBRMATERIAL_ALPHATEST=P.MATERIAL_ALPHATEST;d.PBRMATERIAL_ALPHABLEND=P.MATERIAL_ALPHABLEND;d.PBRMATERIAL_ALPHATESTANDBLEND=P.MATERIAL_ALPHATESTANDBLEND;d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0;d.LIGHTFALLOFF_PHYSICAL=0;d.LIGHTFALLOFF_GLTF=1;d.LIGHTFALLOFF_STANDARD=2;d.ForceGLSL=!1;i([r("_markAllSubMeshesAsMiscDirty")],d.prototype,"debugMode",void 0);var h=class T extends d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(e){this.subSurface.indexOfRefraction=e}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(e){this.subSurface.invertRefractionY=e}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),e?this._lightFalloff=d.LIGHTFALLOFF_PHYSICAL:this._lightFalloff=d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),e?this._lightFalloff=d.LIGHTFALLOFF_GLTF:this._lightFalloff=d.LIGHTFALLOFF_STANDARD)}constructor(e,s,t=!1){super(e,s,t),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=T.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=I.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new I(0,0,0),this.albedoColor=new I(1,1,1),this.baseWeight=1,this.reflectivityColor=new I(1,1,1),this.reflectionColor=new I(1,1,1),this.emissiveColor=new I(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=Q(this.getScene())}getClassName(){return"PBRMaterial"}clone(e,s=!0,t=""){let n=B.Clone(()=>new T(e,this.getScene()),this,{cloneTexturesOnlyOnce:s});return n.id=e,n.name=e,this.stencil.copyTo(n.stencil),this._clonePlugins(n,t),n}serialize(){let e=super.serialize();return e.customType="BABYLON.PBRMaterial",e}static Parse(e,s,t){let n=B.Parse(()=>new T(e.name,s),e,s,t);return e.stencil&&n.stencil.parse(e.stencil,s,t),P._ParsePlugins(e,n,s,t),e.clearCoat&&n.clearCoat.parse(e.clearCoat,s,t),e.anisotropy&&n.anisotropy.parse(e.anisotropy,s,t),e.brdf&&n.brdf.parse(e.brdf,s,t),e.sheen&&n.sheen.parse(e.sheen,s,t),e.subSurface&&n.subSurface.parse(e.subSurface,s,t),e.iridescence&&n.iridescence.parse(e.iridescence,s,t),n}};h.PBRMATERIAL_OPAQUE=d.PBRMATERIAL_OPAQUE;h.PBRMATERIAL_ALPHATEST=d.PBRMATERIAL_ALPHATEST;h.PBRMATERIAL_ALPHABLEND=d.PBRMATERIAL_ALPHABLEND;h.PBRMATERIAL_ALPHATESTANDBLEND=d.PBRMATERIAL_ALPHATESTANDBLEND;h.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS;i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"directIntensity",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"emissiveIntensity",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"environmentIntensity",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"specularIntensity",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"disableBumpMap",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"albedoTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"baseWeightTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"baseDiffuseRoughnessTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"ambientTexture",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"ambientTextureStrength",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"ambientTextureImpactOnAnalyticalLights",void 0);i([p(),r("_markAllSubMeshesAsTexturesAndMiscDirty")],h.prototype,"opacityTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"reflectionTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"emissiveTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"reflectivityTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"metallicTexture",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"metallic",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"roughness",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"metallicF0Factor",void 0);i([N(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"metallicReflectanceColor",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"metallicReflectanceTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"reflectanceTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"microSurfaceTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"bumpTexture",void 0);i([p(),r("_markAllSubMeshesAsTexturesDirty",null)],h.prototype,"lightmapTexture",void 0);i([N("ambient"),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"ambientColor",void 0);i([N("albedo"),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"albedoColor",void 0);i([a("baseWeight"),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"baseWeight",void 0);i([a("baseDiffuseRoughness"),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"baseDiffuseRoughness",void 0);i([N("reflectivity"),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"reflectivityColor",void 0);i([N("reflection"),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"reflectionColor",void 0);i([N("emissive"),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"emissiveColor",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"microSurface",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useLightmapAsShadowmap",void 0);i([a(),r("_markAllSubMeshesAsTexturesAndMiscDirty")],h.prototype,"useAlphaFromAlbedoTexture",void 0);i([a(),r("_markAllSubMeshesAsTexturesAndMiscDirty")],h.prototype,"forceAlphaTest",void 0);i([a(),r("_markAllSubMeshesAsTexturesAndMiscDirty")],h.prototype,"alphaCutOff",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useSpecularOverAlpha",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useRoughnessFromMetallicTextureAlpha",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useRoughnessFromMetallicTextureGreen",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useMetallnessFromMetallicTextureBlue",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useAmbientInGrayScale",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0);i([a()],h.prototype,"usePhysicalLightFalloff",null);i([a()],h.prototype,"useGLTFLightFalloff",null);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useRadianceOverAlpha",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useObjectSpaceNormalMap",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useParallax",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useParallaxOcclusion",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"parallaxScaleBias",void 0);i([a(),r("_markAllSubMeshesAsLightsDirty")],h.prototype,"disableLighting",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"forceIrradianceInFragment",void 0);i([a(),r("_markAllSubMeshesAsLightsDirty")],h.prototype,"maxSimultaneousLights",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"invertNormalMapX",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"invertNormalMapY",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"twoSidedLighting",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useAlphaFresnel",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useLinearAlphaFresnel",void 0);i([r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"environmentBRDFTexture",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"forceNormalForward",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"enableSpecularAntiAliasing",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useHorizonOcclusion",void 0);i([a(),r("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useRadianceOcclusion",void 0);i([a(),r("_markAllSubMeshesAsMiscDirty")],h.prototype,"unlit",void 0);i([a(),r("_markAllSubMeshesAsMiscDirty")],h.prototype,"applyDecalMapAfterDetailMap",void 0);W("BABYLON.PBRMaterial",h);export{nt as a,lt as b,g as c,F as d,y as e,O as f,S as g,d as h,h as i};
