import{a as F}from"./chunk-SO644OCK.js";import{h as m}from"./chunk-OVVEAJWJ.js";import{a as D}from"./chunk-PTJ4CXVK.js";function K(e,i,t,s){switch(i){case 5120:{let r=e.getInt8(t);return s&&(r=Math.max(r/127,-1)),r}case 5121:{let r=e.getUint8(t);return s&&(r=r/255),r}case 5122:{let r=e.getInt16(t,!0);return s&&(r=Math.max(r/32767,-1)),r}case 5123:{let r=e.getUint16(t,!0);return s&&(r=r/65535),r}case 5124:return e.getInt32(t,!0);case 5125:return e.getUint32(t,!0);case 5126:return e.getFloat32(t,!0);default:throw new Error(`Invalid component type ${i}`)}}function B(e,i,t,s,r){switch(i){case 5120:{s&&(r=Math.round(r*127)),e.setInt8(t,r);break}case 5121:{s&&(r=Math.round(r*255)),e.setUint8(t,r);break}case 5122:{s&&(r=Math.round(r*32767)),e.setInt16(t,r,!0);break}case 5123:{s&&(r=Math.round(r*65535)),e.setUint16(t,r,!0);break}case 5124:{e.setInt32(t,r,!0);break}case 5125:{e.setUint32(t,r,!0);break}case 5126:{e.setFloat32(t,r,!0);break}default:throw new Error(`Invalid component type ${i}`)}}function g(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${e}'`)}}function N(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${e}'`)}}function E(e,i,t,s,r,f,l,o){let h=new Array(s),n=new Array(s);if(e instanceof Array){let a=i/4,u=t/4;for(let d=0;d<f;d+=s){for(let c=0;c<s;c++)h[c]=n[c]=e[a+c];o(n,d);for(let c=0;c<s;c++)h[c]!==n[c]&&(e[a+c]=n[c]);a+=u}}else{let a=ArrayBuffer.isView(e)?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(e),u=g(r);for(let d=0;d<f;d+=s){for(let c=0,_=i;c<s;c++,_+=u)h[c]=n[c]=K(a,r,_,l);o(n,d);for(let c=0,_=i;c<s;c++,_+=u)h[c]!==n[c]&&B(a,r,_,l,n[c]);i+=t}}}function T(e,i,t,s,r,f,l,o){let h=i*g(t),n=l*i;if(t!==5126||r!==h){let a=new Float32Array(n);return E(e,s,r,i,t,n,f,(u,d)=>{for(let c=0;c<i;c++)a[d+c]=u[c]}),a}if(!(e instanceof Array||e instanceof Float32Array)||s!==0||e.length!==n)if(e instanceof Array){let a=s/4;return e.slice(a,a+n)}else{if(e instanceof ArrayBuffer)return new Float32Array(e,s,n);{let a=e.byteOffset+s;return(a&3)!==0&&(D.Warn("Float array must be aligned to 4-bytes border"),o=!0),o?new Float32Array(e.buffer.slice(a,a+n*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(e.buffer,a,n)}}return o?e.slice():e}function x(e,i,t,s,r,f,l){let o=g(t),h=N(t),n=f*i;if(Array.isArray(e)){if((s&3)!==0||(r&3)!==0)throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");let _=s/4,b=r/4;if(_+(f-1)*b+i>e.length)throw new Error("Last accessed index is out of bounds.");if(b<i)throw new Error("Data stride cannot be smaller than the component size.");if(b!==i){let y=new h(n);return E(e,s,r,i,t,n,!1,(w,p)=>{for(let I=0;I<i;I++)y[p+I]=w[I]}),y}return new h(e.slice(_,_+n))}let a,u=s;if(e instanceof ArrayBuffer?a=e:(a=e.buffer,u+=e.byteOffset),u+(f-1)*r+i*o>a.byteLength)throw new Error("Last accessed byte is out of bounds.");let c=i*o;if(r<c)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(r!==c){let _=new h(n);return E(a,u,r,i,t,n,!1,(b,A)=>{for(let y=0;y<i;y++)_[A+y]=b[y]}),_}return o!==1&&(u&o-1)!==0&&(D.Warn("Array must be aligned to border of element size. Data will be copied."),l=!0),l?new h(a.slice(u,u+n*o)):new h(a,u,n)}function G(e,i,t,s,r,f,l,o){let h=i*g(t),n=l*i;if(o.length!==n)throw new Error("Output length is not valid");if(t!==5126||r!==h){E(e,s,r,i,t,n,f,(a,u)=>{for(let d=0;d<i;d++)o[u+d]=a[d]});return}if(e instanceof Array){let a=s/4;o.set(e,a)}else if(e instanceof ArrayBuffer){let a=new Float32Array(e,s,n);o.set(a)}else{let a=e.byteOffset+s;if((a&3)!==0){D.Warn("Float array must be aligned to 4-bytes border"),o.set(new Float32Array(e.buffer.slice(a,a+n*Float32Array.BYTES_PER_ELEMENT)));return}let u=new Float32Array(e.buffer,a,n);o.set(u)}}var S=class{get isDisposed(){return this._isDisposed}constructor(i,t,s,r=0,f=!1,l=!1,o=!1,h,n){this._isAlreadyOwned=!1,this._isDisposed=!1,i&&i.getScene?this._engine=i.getScene().getEngine():this._engine=i,this._updatable=s,this._instanced=l,this._divisor=h||1,this._label=n,t instanceof F?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=o?r:r*Float32Array.BYTES_PER_ELEMENT,f||this.create()}createVertexBuffer(i,t,s,r,f,l=!1,o){let h=l?t:t*Float32Array.BYTES_PER_ELEMENT,n=r?l?r:r*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new L(this._engine,this,i,this._updatable,!0,n,f===void 0?this._instanced:f,h,s,void 0,void 0,!0,this._divisor||o)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(i=null){!i&&this._buffer||(i=i||this._data,i&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,i),this._data=i):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(i,this._label),this._data=i):this._buffer=this._engine.createVertexBuffer(i,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.capacity>0){this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.capacity,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.capacity,void 0,this._label);return}D.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(i){this.create(i)}updateDirectly(i,t,s,r=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,i,r?t:t*Float32Array.BYTES_PER_ELEMENT,s?s*this.byteStride:void 0),t===0&&s===void 0?this._data=i:this._data=null)}_increaseReferences(){if(this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}},L=(()=>{class e{get isDisposed(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(t){let s=t!=0;this._instanceDivisor=t,s!==this._instanced&&(this._instanced=s,this._computeHashCode())}get _maxVerticesCount(){let t=this.getData();return t?Array.isArray(t)?t.length/(this.byteStride/4)-this.byteOffset/4:(t.byteLength-this.byteOffset)/this.byteStride:0}constructor(t,s,r,f,l,o,h,n,a,u,d=!1,c=!1,_=1,b=!1){this._isDisposed=!1;let A=!1;if(this.engine=t,typeof f=="object"&&f!==null?(A=f.updatable??!1,l=f.postponeInternalCreation,o=f.stride,h=f.instanced,n=f.offset,a=f.size,u=f.type,d=f.normalized??!1,c=f.useBytes??!1,_=f.divisor??1,b=f.takeBufferOwnership??!1,this._label=f.label):A=!!f,s instanceof S?(this._buffer=s,this._ownsBuffer=b):(this._buffer=new S(t,s,A,o,l,h,c,_,this._label),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=r,u===void 0){let w=this.getData();this.type=w?e.GetDataType(w):e.FLOAT}else this.type=u;let y=g(this.type);c?(this._size=a||(o?o/y:e.DeduceStride(r)),this.byteStride=o||this._buffer.byteStride||this._size*y,this.byteOffset=n||0):(this._size=a||o||e.DeduceStride(r),this.byteStride=o?o*y:this._buffer.byteStride||this._size*y,this.byteOffset=(n||0)*y),this.normalized=d,this._instanced=h!==void 0?h:!1,this._instanceDivisor=h?_:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){this._buffer?._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(t,s){let r=this.getData();return r?T(r,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,t,s):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/g(this.type)}getOffset(){return this.byteOffset/g(this.type)}getSize(t=!1){return t?this._size*g(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(t){this._buffer.create(t),this._alignBuffer()}update(t){this._buffer.update(t),this._alignBuffer()}updateDirectly(t,s,r=!1){this._buffer.updateDirectly(t,s,void 0,r),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(t,s){E(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,(r,f)=>{for(let l=0;l<this._size;l++)s(r[l],f+l)})}_alignBuffer(){}static DeduceStride(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.ColorInstanceKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}}static GetDataType(t){return t instanceof Int8Array?e.BYTE:t instanceof Uint8Array?e.UNSIGNED_BYTE:t instanceof Int16Array?e.SHORT:t instanceof Uint16Array?e.UNSIGNED_SHORT:t instanceof Int32Array?e.INT:t instanceof Uint32Array?e.UNSIGNED_INT:e.FLOAT}static GetTypeByteLength(t){return g(t)}static ForEach(t,s,r,f,l,o,h,n){E(t,s,r,f,l,o,h,(a,u)=>{for(let d=0;d<f;d++)n(a[d],u+d)})}static GetFloatData(t,s,r,f,l,o,h,n){return T(t,s,r,f,l,o,h,n)}}return e._Counter=0,e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.ColorInstanceKind="instanceColor",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e})();var U=class{static GetEffect(i){return i.getPipelineContext===void 0?i.effect:i}constructor(i,t=!0){this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=i.createDrawContext(),t&&(this.materialContext=i.createMaterialContext())}setEffect(i,t,s=!0){this.effect=i,t!==void 0&&(this.defines=t),s&&this.drawContext?.reset()}dispose(i=!1){if(this.effect){let t=this.effect;i?t.dispose():m.SetImmediate(()=>{t.getEngine().onEndFrameObservable.addOnce(()=>{t.dispose()})}),this.effect=null}this.drawContext?.dispose()}};export{N as a,x as b,G as c,S as d,L as e,U as f};
