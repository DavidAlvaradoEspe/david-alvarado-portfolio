import{i as T,j as m,v as w}from"./chunk-P7GMCLRU.js";import{e as p}from"./chunk-E7GKI5ZX.js";import{b as P}from"./chunk-JIBXETCA.js";import{c as A}from"./chunk-SX3EKMWY.js";import{a as M,d as C}from"./chunk-CCUABLZY.js";import{a as y}from"./chunk-3WG2WLZ4.js";import{f as _}from"./chunk-VBN2JSHE.js";import{K as N}from"./chunk-UB6LWR2H.js";import{a as u,b as O,h}from"./chunk-GXO6EN2N.js";var S=(()=>{class e extends A{_gatherImports(a,n){a?(this._webGPUReady=!0,n.push(Promise.all([import("./chunk-QKUVW643.js")]))):n.push(Promise.all([import("./chunk-MLCM4HTX.js")])),super._gatherImports(a,n)}constructor(a,n=null,s){let o=u({name:a,engine:n||w.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:e.FragmentUrl},s);o.engine||(o.engine=w.LastCreatedEngine),super(o)}}return e.FragmentUrl="pass",e})(),F=(()=>{class e extends A{_gatherImports(a,n){a?(this._webGPUReady=!0,n.push(Promise.all([import("./chunk-QUUYJTHK.js")]))):n.push(Promise.all([import("./chunk-6VBUDFX6.js")])),super._gatherImports(a,n)}constructor(a,n=null,s){super(O(u({},s),{name:a,engine:n||w.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:e.FragmentUrl,defines:"#define POSITIVEX"})),this._face=0}get face(){return this._face}set face(a){if(!(a<0||a>5))switch(this._face=a,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ");break}}}return e.FragmentUrl="passCube",e})();var g=class e extends m{getClassName(){return"PassPostProcess"}constructor(r,a,n=null,s,o,t,i=0,l=!1){let f=u({size:typeof a=="number"?a:void 0,camera:n,samplingMode:s,engine:o,reusable:t,textureType:i,blockCompilation:l},a);super(r,S.FragmentUrl,u({effectWrapper:typeof a=="number"||!a.effectWrapper?new S(r,o,f):void 0},f))}static _Parse(r,a,n,s){return P.Parse(()=>new e(r.name,r.options,a,r.renderTargetSamplingMode,r._engine,r.reusable),r,n,s)}};y("BABYLON.PassPostProcess",g);var I=class e extends m{get face(){return this._effectWrapper.face}set face(r){this._effectWrapper.face=r}getClassName(){return"PassCubePostProcess"}constructor(r,a,n=null,s,o,t,i=0,l=!1){let f=u({size:typeof a=="number"?a:void 0,camera:n,samplingMode:s,engine:o,reusable:t,textureType:i,blockCompilation:l},a);super(r,S.FragmentUrl,u({effectWrapper:typeof a=="number"||!a.effectWrapper?new F(r,o,f):void 0},f))}static _Parse(r,a,n,s){return P.Parse(()=>new e(r.name,r.options,a,r.renderTargetSamplingMode,r._engine,r.reusable),r,n,s)}};M([C()],I.prototype,"face",null);N._RescalePostProcessFactory=e=>new g("rescale",1,null,2,e,!1,0);function L(e,r,a,n=!0){let s=e.getScene(),o=s.getEngine(),t=new T("resized"+e.name,{width:r,height:a},s,!e.noMipmap,!0,e._texture.type,!1,e.samplingMode,!1);t.wrapU=e.wrapU,t.wrapV=e.wrapV,t.uOffset=e.uOffset,t.vOffset=e.vOffset,t.uScale=e.uScale,t.vScale=e.vScale,t.uAng=e.uAng,t.vAng=e.vAng,t.wAng=e.wAng,t.coordinatesIndex=e.coordinatesIndex,t.level=e.level,t.anisotropicFilteringLevel=e.anisotropicFilteringLevel,t._texture.isReady=!1,e.wrapU=p.CLAMP_ADDRESSMODE,e.wrapV=p.CLAMP_ADDRESSMODE;let i=new g("pass",1,null,n?p.BILINEAR_SAMPLINGMODE:p.NEAREST_SAMPLINGMODE,o,!1,0);return i.externalTextureSamplerBinding=!0,i.onEffectCreatedObservable.addOnce(l=>{l.executeWhenCompiled(()=>{i.onApply=function(c){c.setTexture("textureSampler",e)};let f=t.renderTarget;f&&(s.postProcessManager.directRender([i],f),o.unBindFramebuffer(f),t.disposeFramebufferObjects(),i.dispose(),t.getInternalTexture().isReady=!0)})}),t}function x(e,r,a,n,s,o,t,i){let l=r.getEngine();return r.isReady=!1,s=s??r.samplingMode,n=n??r.type,o=o??r.format,t=t??r.width,i=i??r.height,n===-1&&(n=0),new Promise(f=>{let c=new m("postprocess",e,null,null,1,null,s,l,!1,void 0,n,void 0,null,!1,o);c.externalTextureSamplerBinding=!0;let d=l.createRenderTargetTexture({width:t,height:i},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:s,type:n,format:o});c.onEffectCreatedObservable.addOnce(E=>{E.executeWhenCompiled(()=>{c.onApply=R=>{R._bindTexture("textureSampler",r),R.setFloat2("scale",1,1)},a.postProcessManager.directRender([c],d,!0),l.restoreDefaultFramebuffer(),l._releaseTexture(r),c&&c.dispose(),d._swapAndDie(r),r.type=n,r.format=5,r.isReady=!0,f(r)})})})}var b,V;function U(e){b||(b=new Float32Array(1),V=new Int32Array(b.buffer)),b[0]=e;let r=V[0],a=r>>16&32768,n=r>>12&2047,s=r>>23&255;return s<103?a:s>142?(a|=31744,a|=(s==255?0:1)&&r&8388607,a):s<113?(n|=2048,a|=(n>>114-s)+(n>>113-s&1),a):(a|=s-112<<10|n>>1,a+=n&1,a)}function v(e){let r=(e&32768)>>15,a=(e&31744)>>10,n=e&1023;return a===0?(r?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):a==31?n?NaN:(r?-1:1)*(1/0):(r?-1:1)*Math.pow(2,a-15)*(1+n/Math.pow(2,10))}function W(e){switch(e){case 36492:case 36493:case 36495:case 36494:case 33779:case 35919:case 33778:case 35918:case 33777:case 33776:case 35917:case 35916:case 37808:case 37840:case 36196:case 37492:case 37493:case 37494:case 37495:case 37496:case 37497:return!0;default:return!1}}function D(e){return h(this,null,function*(){if(e.isReady())return;if(e.loadingError)throw new Error(e.errorObject?.message||`Texture ${e.name} errored while loading.`);let r=e.onLoadObservable;if(r)return yield new Promise(n=>r.addOnce(()=>n()));let a=e._texture?.onLoadedObservable;if(a)return yield new Promise(n=>a.addOnce(()=>n()));throw new Error(`Cannot determine readiness of texture ${e.name}.`)})}function G(e,r,a,n,s){return h(this,null,function*(){let o=e.getScene(),t=o.getEngine();t.isWebGPU?e.isCube?yield import("./chunk-BECO6XZS.js"):yield import("./chunk-VOCF476X.js"):e.isCube?yield import("./chunk-VQGQNIDG.js"):yield import("./chunk-V3FGUUXT.js");let i;if(!e.isCube)i=new m("lod","lod",{uniforms:["lod","gamma"],samplingMode:p.NEAREST_NEAREST_MIPNEAREST,engine:t,shaderLanguage:t.isWebGPU?1:0});else{let c=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];i=new m("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:p.NEAREST_NEAREST_MIPNEAREST,engine:t,defines:c[n],shaderLanguage:t.isWebGPU?1:0})}yield new Promise(c=>{i.onEffectCreatedObservable.addOnce(d=>{d.executeWhenCompiled(()=>{c(0)})})});let l=new T("temp",{width:r,height:a},o,!1);i.onApply=function(c){c.setTexture("textureSampler",e),c.setFloat("lod",s),c.setInt("gamma",e.gammaSpace?1:0)};let f=e.getInternalTexture();try{if(l.renderTarget&&f){let c=f.samplingMode;s!==0?e.updateSamplingMode(p.NEAREST_NEAREST_MIPNEAREST):e.updateSamplingMode(p.NEAREST_NEAREST),o.postProcessManager.directRender([i],l.renderTarget,!0),e.updateSamplingMode(c);let d=yield t.readPixels(0,0,r,a),E=new Uint8Array(d.buffer,0,d.byteLength);return t.unBindFramebuffer(l.renderTarget),E}else throw Error("Render to texture failed.")}finally{l.dispose(),i.dispose()}})}function B(e,r,a,n=0,s=0){return h(this,null,function*(){yield D(e);let{width:o,height:t}=e.getSize(),i=r??o,l=a??t;if(W(e.textureFormat)||i!==o||l!==t)return yield G(e,i,l,n,s);let f=yield e.readPixels(n,s);if(!f)throw new Error(`Failed to read pixels from texture ${e.name}.`);if(f instanceof Float32Array){let c=new Uint8Array(f.length),d=f.length;for(;d--;){let E=f[d];c[d]=Math.round(_(E)*255)}f=c}return f})}var oe={CreateResizedCopy:L,ApplyPostProcess:x,ToHalfFloat:U,FromHalfFloat:v,GetTextureDataAsync:B};export{S as a,F as b,g as c,x as d,U as e,v as f,oe as g};
