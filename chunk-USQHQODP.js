import{b as St,c as yt}from"./chunk-DFECEQQR.js";import{a as vt,c as $}from"./chunk-DE7K33UC.js";import{a as Dt}from"./chunk-OOSHHHZN.js";import{a as lt}from"./chunk-DTW6C2NU.js";import{a as xt}from"./chunk-IMSFUDDL.js";import{b as q}from"./chunk-CW5F3XFN.js";import{a as ot,b as et}from"./chunk-NPZEPKVW.js";import{d as m,e as X,f as P,g as v,h as d}from"./chunk-FWZ75RMU.js";import{d as K}from"./chunk-OPJEXU7D.js";import{e as l}from"./chunk-6KAGRIFJ.js";import{a as T,d as k,i as st,n as It,q as U}from"./chunk-CCUABLZY.js";import{a as _t,b as Mt}from"./chunk-N5PQEAVY.js";import{a as pt,b as bt}from"./chunk-3WG2WLZ4.js";import{E as At}from"./chunk-OVVEAJWJ.js";import{a as R}from"./chunk-A3WFPZFR.js";import{a as z}from"./chunk-CJK33JLH.js";import{a as mt}from"./chunk-PTJ4CXVK.js";import{g as it}from"./chunk-YVY7FGQB.js";function ht(f,t,i){try{let e=f.next();e.done?t(e):e.value?e.value.then(()=>{e.value=void 0,t(e)},i):t(e)}catch(e){i(e)}}function kt(f=25){let t;return(i,e,s)=>{let n=performance.now();t===void 0||n-t>f?(t=n,setTimeout(()=>{ht(i,e,s)},0)):ht(i,e,s)}}function Rt(f,t,i,e,s){let n=()=>{let o,a=c=>{c.done?i(c.value):o===void 0?o=!0:n()};do o=void 0,!s||!s.aborted?t(f,a,e):e(new Error("Aborted")),o===void 0&&(o=!1);while(o)};n()}function ct(f,t){let i;return Rt(f,ht,e=>i=e,e=>{throw e},t),i}function Qt(f,t,i){return it(this,null,function*(){return yield new Promise((e,s)=>{Rt(f,t,e,s,i)})})}function Pt(f,t){return(...i)=>ct(f(...i),t)}var j=class{},w=class f{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=Pt(this._applyToCoroutine.bind(this)),this.uniqueId=f._UniqueIdGenerator,f._UniqueIdGenerator++}set(t,i){switch(t.length||mt.Warn(`Setting vertex data kind '${i}' with an empty array`),i){case l.PositionKind:this.positions=t;break;case l.NormalKind:this.normals=t;break;case l.TangentKind:this.tangents=t;break;case l.UVKind:this.uvs=t;break;case l.UV2Kind:this.uvs2=t;break;case l.UV3Kind:this.uvs3=t;break;case l.UV4Kind:this.uvs4=t;break;case l.UV5Kind:this.uvs5=t;break;case l.UV6Kind:this.uvs6=t;break;case l.ColorKind:this.colors=t;break;case l.MatricesIndicesKind:this.matricesIndices=t;break;case l.MatricesWeightsKind:this.matricesWeights=t;break;case l.MatricesIndicesExtraKind:this.matricesIndicesExtra=t;break;case l.MatricesWeightsExtraKind:this.matricesWeightsExtra=t;break}}applyToMesh(t,i){return this._applyTo(t,i,!1),this}applyToGeometry(t,i){return this._applyTo(t,i,!1),this}updateMesh(t){return this._update(t),this}updateGeometry(t){return this._update(t),this}*_applyToCoroutine(t,i=!1,e){if(this.positions&&(t.setVerticesData(l.PositionKind,this.positions,i),e&&(yield)),this.normals&&(t.setVerticesData(l.NormalKind,this.normals,i),e&&(yield)),this.tangents&&(t.setVerticesData(l.TangentKind,this.tangents,i),e&&(yield)),this.uvs&&(t.setVerticesData(l.UVKind,this.uvs,i),e&&(yield)),this.uvs2&&(t.setVerticesData(l.UV2Kind,this.uvs2,i),e&&(yield)),this.uvs3&&(t.setVerticesData(l.UV3Kind,this.uvs3,i),e&&(yield)),this.uvs4&&(t.setVerticesData(l.UV4Kind,this.uvs4,i),e&&(yield)),this.uvs5&&(t.setVerticesData(l.UV5Kind,this.uvs5,i),e&&(yield)),this.uvs6&&(t.setVerticesData(l.UV6Kind,this.uvs6,i),e&&(yield)),this.colors){let s=this.positions&&this.colors.length===this.positions.length?3:4;t.setVerticesData(l.ColorKind,this.colors,i,s),this.hasVertexAlpha&&t.hasVertexAlpha!==void 0&&(t.hasVertexAlpha=!0),e&&(yield)}if(this.matricesIndices&&(t.setVerticesData(l.MatricesIndicesKind,this.matricesIndices,i),e&&(yield)),this.matricesWeights&&(t.setVerticesData(l.MatricesWeightsKind,this.matricesWeights,i),e&&(yield)),this.matricesIndicesExtra&&(t.setVerticesData(l.MatricesIndicesExtraKind,this.matricesIndicesExtra,i),e&&(yield)),this.matricesWeightsExtra&&(t.setVerticesData(l.MatricesWeightsExtraKind,this.matricesWeightsExtra,i),e&&(yield)),this.indices?(t.setIndices(this.indices,null,i),e&&(yield)):t.setIndices([],null),t.subMeshes&&this.materialInfos&&this.materialInfos.length>1){let s=t;s.subMeshes=[];for(let n of this.materialInfos)new yt(n.materialIndex,n.verticesStart,n.verticesCount,n.indexStart,n.indexCount,s)}return this}_update(t,i,e){return this.positions&&t.updateVerticesData(l.PositionKind,this.positions,i,e),this.normals&&t.updateVerticesData(l.NormalKind,this.normals,i,e),this.tangents&&t.updateVerticesData(l.TangentKind,this.tangents,i,e),this.uvs&&t.updateVerticesData(l.UVKind,this.uvs,i,e),this.uvs2&&t.updateVerticesData(l.UV2Kind,this.uvs2,i,e),this.uvs3&&t.updateVerticesData(l.UV3Kind,this.uvs3,i,e),this.uvs4&&t.updateVerticesData(l.UV4Kind,this.uvs4,i,e),this.uvs5&&t.updateVerticesData(l.UV5Kind,this.uvs5,i,e),this.uvs6&&t.updateVerticesData(l.UV6Kind,this.uvs6,i,e),this.colors&&t.updateVerticesData(l.ColorKind,this.colors,i,e),this.matricesIndices&&t.updateVerticesData(l.MatricesIndicesKind,this.matricesIndices,i,e),this.matricesWeights&&t.updateVerticesData(l.MatricesWeightsKind,this.matricesWeights,i,e),this.matricesIndicesExtra&&t.updateVerticesData(l.MatricesIndicesExtraKind,this.matricesIndicesExtra,i,e),this.matricesWeightsExtra&&t.updateVerticesData(l.MatricesWeightsExtraKind,this.matricesWeightsExtra,i,e),this.indices&&t.setIndices(this.indices,null),this}static _TransformVector3Coordinates(t,i,e=0,s=t.length){let n=d.Vector3[0],o=d.Vector3[1];for(let a=e;a<e+s;a+=3)m.FromArrayToRef(t,a,n),m.TransformCoordinatesToRef(n,i,o),t[a]=o.x,t[a+1]=o.y,t[a+2]=o.z}static _TransformVector3Normals(t,i,e=0,s=t.length){let n=d.Vector3[0],o=d.Vector3[1];for(let a=e;a<e+s;a+=3)m.FromArrayToRef(t,a,n),m.TransformNormalToRef(n,i,o),t[a]=o.x,t[a+1]=o.y,t[a+2]=o.z}static _TransformVector4Normals(t,i,e=0,s=t.length){let n=d.Vector4[0],o=d.Vector4[1];for(let a=e;a<e+s;a+=4)X.FromArrayToRef(t,a,n),X.TransformNormalToRef(n,i,o),t[a]=o.x,t[a+1]=o.y,t[a+2]=o.z,t[a+3]=o.w}static _FlipFaces(t,i=0,e=t.length){for(let s=i;s<i+e;s+=3){let n=t[s+1];t[s+1]=t[s+2],t[s+2]=n}}transform(t){let i=t.determinant()<0;return this.positions&&f._TransformVector3Coordinates(this.positions,t),this.normals&&f._TransformVector3Normals(this.normals,t),this.tangents&&f._TransformVector4Normals(this.tangents,t),i&&this.indices&&f._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];let t=[];for(let i of this.materialInfos){let e=new f;if(this.positions&&(e.positions=this.positions.slice(i.verticesStart*3,(i.verticesCount+i.verticesStart)*3)),this.normals&&(e.normals=this.normals.slice(i.verticesStart*3,(i.verticesCount+i.verticesStart)*3)),this.tangents&&(e.tangents=this.tangents.slice(i.verticesStart*4,(i.verticesCount+i.verticesStart)*4)),this.colors&&(e.colors=this.colors.slice(i.verticesStart*4,(i.verticesCount+i.verticesStart)*4)),this.uvs&&(e.uvs=this.uvs.slice(i.verticesStart*2,(i.verticesCount+i.verticesStart)*2)),this.uvs2&&(e.uvs2=this.uvs2.slice(i.verticesStart*2,(i.verticesCount+i.verticesStart)*2)),this.uvs3&&(e.uvs3=this.uvs3.slice(i.verticesStart*2,(i.verticesCount+i.verticesStart)*2)),this.uvs4&&(e.uvs4=this.uvs4.slice(i.verticesStart*2,(i.verticesCount+i.verticesStart)*2)),this.uvs5&&(e.uvs5=this.uvs5.slice(i.verticesStart*2,(i.verticesCount+i.verticesStart)*2)),this.uvs6&&(e.uvs6=this.uvs6.slice(i.verticesStart*2,(i.verticesCount+i.verticesStart)*2)),this.matricesIndices&&(e.matricesIndices=this.matricesIndices.slice(i.verticesStart*4,(i.verticesCount+i.verticesStart)*4)),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra.slice(i.verticesStart*4,(i.verticesCount+i.verticesStart)*4)),this.matricesWeights&&(e.matricesWeights=this.matricesWeights.slice(i.verticesStart*4,(i.verticesCount+i.verticesStart)*4)),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra.slice(i.verticesStart*4,(i.verticesCount+i.verticesStart)*4)),this.indices){e.indices=[];for(let n=i.indexStart;n<i.indexStart+i.indexCount;n++)e.indices.push(this.indices[n]-i.verticesStart)}let s=new j;s.indexStart=0,s.indexCount=e.indices?e.indices.length:0,s.materialIndex=i.materialIndex,s.verticesStart=0,s.verticesCount=(e.positions?e.positions.length:0)/3,e.materialInfos=[s],t.push(e)}return t}merge(t,i=!1,e=!1,s=!1,n=!1){let o=Array.isArray(t)?t.map(a=>({vertexData:a})):[{vertexData:t}];return ct(this._mergeCoroutine(void 0,o,i,!1,e,s,n))}*_mergeCoroutine(t,i,e=!1,s,n,o=!1,a=!1){this._validate();let c=i.map(r=>r.vertexData),h=this;if(a)for(let r of c)r&&(r._validate(),!this.normals&&r.normals&&(this.normals=new Float32Array(this.positions.length)),!this.tangents&&r.tangents&&(this.tangents=new Float32Array(this.positions.length/3*4)),!this.uvs&&r.uvs&&(this.uvs=new Float32Array(this.positions.length/3*2)),!this.uvs2&&r.uvs2&&(this.uvs2=new Float32Array(this.positions.length/3*2)),!this.uvs3&&r.uvs3&&(this.uvs3=new Float32Array(this.positions.length/3*2)),!this.uvs4&&r.uvs4&&(this.uvs4=new Float32Array(this.positions.length/3*2)),!this.uvs5&&r.uvs5&&(this.uvs5=new Float32Array(this.positions.length/3*2)),!this.uvs6&&r.uvs6&&(this.uvs6=new Float32Array(this.positions.length/3*2)),!this.colors&&r.colors&&(this.colors=new Float32Array(this.positions.length/3*4),this.colors.fill(1)),!this.matricesIndices&&r.matricesIndices&&(this.matricesIndices=new Float32Array(this.positions.length/3*4)),!this.matricesWeights&&r.matricesWeights&&(this.matricesWeights=new Float32Array(this.positions.length/3*4)),!this.matricesIndicesExtra&&r.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.positions.length/3*4)),!this.matricesWeightsExtra&&r.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.positions.length/3*4)));for(let r of c)if(r){if(a)this.normals&&!r.normals&&(r.normals=new Float32Array(r.positions.length)),this.tangents&&!r.tangents&&(r.tangents=new Float32Array(r.positions.length/3*4)),this.uvs&&!r.uvs&&(r.uvs=new Float32Array(r.positions.length/3*2)),this.uvs2&&!r.uvs2&&(r.uvs2=new Float32Array(r.positions.length/3*2)),this.uvs3&&!r.uvs3&&(r.uvs3=new Float32Array(r.positions.length/3*2)),this.uvs4&&!r.uvs4&&(r.uvs4=new Float32Array(r.positions.length/3*2)),this.uvs5&&!r.uvs5&&(r.uvs5=new Float32Array(r.positions.length/3*2)),this.uvs6&&!r.uvs6&&(r.uvs6=new Float32Array(r.positions.length/3*2)),this.colors&&!r.colors&&(r.colors=new Float32Array(r.positions.length/3*4),r.colors.fill(1)),this.matricesIndices&&!r.matricesIndices&&(r.matricesIndices=new Float32Array(r.positions.length/3*4)),this.matricesWeights&&!r.matricesWeights&&(r.matricesWeights=new Float32Array(r.positions.length/3*4)),this.matricesIndicesExtra&&!r.matricesIndicesExtra&&(r.matricesIndicesExtra=new Float32Array(r.positions.length/3*4)),this.matricesWeightsExtra&&!r.matricesWeightsExtra&&(r.matricesWeightsExtra=new Float32Array(r.positions.length/3*4));else if(r._validate(),!this.normals!=!r.normals||!this.tangents!=!r.tangents||!this.uvs!=!r.uvs||!this.uvs2!=!r.uvs2||!this.uvs3!=!r.uvs3||!this.uvs4!=!r.uvs4||!this.uvs5!=!r.uvs5||!this.uvs6!=!r.uvs6||!this.colors!=!r.colors||!this.matricesIndices!=!r.matricesIndices||!this.matricesWeights!=!r.matricesWeights||!this.matricesIndicesExtra!=!r.matricesIndicesExtra||!this.matricesWeightsExtra!=!r.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes")}if(o){let r=0,p=0,_=0,D=[],b=null,A=[];for(let y of this.splitBasedOnMaterialID())A.push({vertexData:y,transform:t});for(let y of i)if(y.vertexData)for(let S of y.vertexData.splitBasedOnMaterialID())A.push({vertexData:S,transform:y.transform});A.sort((y,S)=>{let x=y.vertexData.materialInfos?y.vertexData.materialInfos[0].materialIndex:0,F=S.vertexData.materialInfos?S.vertexData.materialInfos[0].materialIndex:0;return x>F?1:x===F?0:-1});for(let y of A){let S=y.vertexData;if(S.materialInfos?r=S.materialInfos[0].materialIndex:r=0,b&&b.materialIndex===r)b.indexCount+=S.indices.length,b.verticesCount+=S.positions.length/3;else{let x=new j;x.materialIndex=r,x.indexStart=p,x.indexCount=S.indices.length,x.verticesStart=_,x.verticesCount=S.positions.length/3,D.push(x),b=x}p+=S.indices.length,_+=S.positions.length/3}let C=A.splice(0,1)[0];h=C.vertexData,t=C.transform,c=A.map(y=>y.vertexData),i=A,this.materialInfos=D}let u=c.reduce((r,p)=>r+(p.indices?.length??0),h.indices?.length??0),M=n||c.some(r=>r.indices===h.indices)?h.indices?.slice():h.indices;if(u>0){let r=M?.length??0;if(M||(M=new Array(u)),M.length!==u){if(Array.isArray(M))M.length=u;else{let _=e||M instanceof Uint32Array?new Uint32Array(u):new Uint16Array(u);_.set(M),M=_}t&&t.determinant()<0&&f._FlipFaces(M,0,r)}let p=h.positions?h.positions.length/3:0;for(let{vertexData:_,transform:D}of i)if(_.indices){for(let b=0;b<_.indices.length;b++)M[r+b]=_.indices[b]+p;D&&D.determinant()<0&&f._FlipFaces(M,r,_.indices.length),p+=_.positions.length/3,r+=_.indices.length,s&&(yield)}}return this.indices=M,this.positions=f._MergeElement(l.PositionKind,h.positions,t,i.map(r=>[r.vertexData.positions,r.transform])),s&&(yield),h.normals&&(this.normals=f._MergeElement(l.NormalKind,h.normals,t,i.map(r=>[r.vertexData.normals,r.transform])),s&&(yield)),h.tangents&&(this.tangents=f._MergeElement(l.TangentKind,h.tangents,t,i.map(r=>[r.vertexData.tangents,r.transform])),s&&(yield)),h.uvs&&(this.uvs=f._MergeElement(l.UVKind,h.uvs,t,i.map(r=>[r.vertexData.uvs,r.transform])),s&&(yield)),h.uvs2&&(this.uvs2=f._MergeElement(l.UV2Kind,h.uvs2,t,i.map(r=>[r.vertexData.uvs2,r.transform])),s&&(yield)),h.uvs3&&(this.uvs3=f._MergeElement(l.UV3Kind,h.uvs3,t,i.map(r=>[r.vertexData.uvs3,r.transform])),s&&(yield)),h.uvs4&&(this.uvs4=f._MergeElement(l.UV4Kind,h.uvs4,t,i.map(r=>[r.vertexData.uvs4,r.transform])),s&&(yield)),h.uvs5&&(this.uvs5=f._MergeElement(l.UV5Kind,h.uvs5,t,i.map(r=>[r.vertexData.uvs5,r.transform])),s&&(yield)),h.uvs6&&(this.uvs6=f._MergeElement(l.UV6Kind,h.uvs6,t,i.map(r=>[r.vertexData.uvs6,r.transform])),s&&(yield)),h.colors&&(this.colors=f._MergeElement(l.ColorKind,h.colors,t,i.map(r=>[r.vertexData.colors,r.transform])),(h.hasVertexAlpha!==void 0||i.some(r=>r.vertexData.hasVertexAlpha!==void 0))&&(this.hasVertexAlpha=h.hasVertexAlpha||i.some(r=>r.vertexData.hasVertexAlpha)),s&&(yield)),h.matricesIndices&&(this.matricesIndices=f._MergeElement(l.MatricesIndicesKind,h.matricesIndices,t,i.map(r=>[r.vertexData.matricesIndices,r.transform])),s&&(yield)),h.matricesWeights&&(this.matricesWeights=f._MergeElement(l.MatricesWeightsKind,h.matricesWeights,t,i.map(r=>[r.vertexData.matricesWeights,r.transform])),s&&(yield)),h.matricesIndicesExtra&&(this.matricesIndicesExtra=f._MergeElement(l.MatricesIndicesExtraKind,h.matricesIndicesExtra,t,i.map(r=>[r.vertexData.matricesIndicesExtra,r.transform])),s&&(yield)),h.matricesWeightsExtra&&(this.matricesWeightsExtra=f._MergeElement(l.MatricesWeightsExtraKind,h.matricesWeightsExtra,t,i.map(r=>[r.vertexData.matricesWeightsExtra,r.transform]))),this}static _MergeElement(t,i,e,s){let n=s.filter(c=>c[0]!==null&&c[0]!==void 0);if(!i&&n.length==0)return i;if(!i)return this._MergeElement(t,n[0][0],n[0][1],n.slice(1));let o=n.reduce((c,h)=>c+h[0].length,i.length),a=t===l.PositionKind?f._TransformVector3Coordinates:t===l.NormalKind?f._TransformVector3Normals:t===l.TangentKind?f._TransformVector4Normals:()=>{};if(i instanceof Float32Array){let c=new Float32Array(o);c.set(i),e&&a(c,e,0,i.length);let h=i.length;for(let[u,g]of n)c.set(u,h),g&&a(c,g,h,u.length),h+=u.length;return c}else{let c=new Array(o);for(let u=0;u<i.length;u++)c[u]=i[u];e&&a(c,e,0,i.length);let h=i.length;for(let[u,g]of n){for(let M=0;M<u.length;M++)c[h+M]=u[M];g&&a(c,g,h,u.length),h+=u.length}return c}}_validate(){if(!this.positions)throw new Mt("Positions are required",_t.MeshInvalidPositionsError);let t=(s,n)=>{let o=l.DeduceStride(s);if(n.length%o!==0)throw new Error("The "+s+"s array count must be a multiple of "+o);return n.length/o},i=t(l.PositionKind,this.positions),e=(s,n)=>{let o=t(s,n);if(o!==i)throw new Error("The "+s+"s element count ("+o+") does not match the positions count ("+i+")")};this.normals&&e(l.NormalKind,this.normals),this.tangents&&e(l.TangentKind,this.tangents),this.uvs&&e(l.UVKind,this.uvs),this.uvs2&&e(l.UV2Kind,this.uvs2),this.uvs3&&e(l.UV3Kind,this.uvs3),this.uvs4&&e(l.UV4Kind,this.uvs4),this.uvs5&&e(l.UV5Kind,this.uvs5),this.uvs6&&e(l.UV6Kind,this.uvs6),this.colors&&e(l.ColorKind,this.colors),this.matricesIndices&&e(l.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&e(l.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&e(l.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&e(l.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){let t=this.serialize();return f.Parse(t)}serialize(){let t={};if(this.positions&&(t.positions=Array.from(this.positions)),this.normals&&(t.normals=Array.from(this.normals)),this.tangents&&(t.tangents=Array.from(this.tangents)),this.uvs&&(t.uvs=Array.from(this.uvs)),this.uvs2&&(t.uvs2=Array.from(this.uvs2)),this.uvs3&&(t.uvs3=Array.from(this.uvs3)),this.uvs4&&(t.uvs4=Array.from(this.uvs4)),this.uvs5&&(t.uvs5=Array.from(this.uvs5)),this.uvs6&&(t.uvs6=Array.from(this.uvs6)),this.colors&&(t.colors=Array.from(this.colors),t.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(t.matricesIndices=Array.from(this.matricesIndices),t.matricesIndicesExpanded=!0),this.matricesWeights&&(t.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(t.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),t.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(t.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),t.indices=this.indices?Array.from(this.indices):[],this.materialInfos){t.materialInfos=[];for(let i of this.materialInfos){let e={indexStart:i.indexStart,indexCount:i.indexCount,materialIndex:i.materialIndex,verticesStart:i.verticesStart,verticesCount:i.verticesCount};t.materialInfos.push(e)}}return t}static ExtractFromMesh(t,i,e){return f._ExtractFrom(t,i,e)}static ExtractFromGeometry(t,i,e){return f._ExtractFrom(t,i,e)}static _ExtractFrom(t,i,e){let s=new f;if(t.isVerticesDataPresent(l.PositionKind)&&(s.positions=t.getVerticesData(l.PositionKind,i,e)),t.isVerticesDataPresent(l.NormalKind)&&(s.normals=t.getVerticesData(l.NormalKind,i,e)),t.isVerticesDataPresent(l.TangentKind)&&(s.tangents=t.getVerticesData(l.TangentKind,i,e)),t.isVerticesDataPresent(l.UVKind)&&(s.uvs=t.getVerticesData(l.UVKind,i,e)),t.isVerticesDataPresent(l.UV2Kind)&&(s.uvs2=t.getVerticesData(l.UV2Kind,i,e)),t.isVerticesDataPresent(l.UV3Kind)&&(s.uvs3=t.getVerticesData(l.UV3Kind,i,e)),t.isVerticesDataPresent(l.UV4Kind)&&(s.uvs4=t.getVerticesData(l.UV4Kind,i,e)),t.isVerticesDataPresent(l.UV5Kind)&&(s.uvs5=t.getVerticesData(l.UV5Kind,i,e)),t.isVerticesDataPresent(l.UV6Kind)&&(s.uvs6=t.getVerticesData(l.UV6Kind,i,e)),t.isVerticesDataPresent(l.ColorKind)){let n=t.geometry||t,o=n.getVertexBuffer(l.ColorKind),a=n.getVerticesData(l.ColorKind,i,e);if(o.getSize()===3){let c=new Float32Array(a.length*4/3);for(let h=0,u=0;h<a.length;h+=3,u+=4)c[u]=a[h],c[u+1]=a[h+1],c[u+2]=a[h+2],c[u+3]=1;s.colors=c}else if(o.getSize()===4)s.colors=a;else throw new Error(`Unexpected number of color components: ${o.getSize()}`)}return t.isVerticesDataPresent(l.MatricesIndicesKind)&&(s.matricesIndices=t.getVerticesData(l.MatricesIndicesKind,i,e)),t.isVerticesDataPresent(l.MatricesWeightsKind)&&(s.matricesWeights=t.getVerticesData(l.MatricesWeightsKind,i,e)),t.isVerticesDataPresent(l.MatricesIndicesExtraKind)&&(s.matricesIndicesExtra=t.getVerticesData(l.MatricesIndicesExtraKind,i,e)),t.isVerticesDataPresent(l.MatricesWeightsExtraKind)&&(s.matricesWeightsExtra=t.getVerticesData(l.MatricesWeightsExtraKind,i,e)),s.indices=t.getIndices(i,e),s}static CreateRibbon(t){throw R("ribbonBuilder")}static CreateBox(t){throw R("boxBuilder")}static CreateTiledBox(t){throw R("tiledBoxBuilder")}static CreateTiledPlane(t){throw R("tiledPlaneBuilder")}static CreateSphere(t){throw R("sphereBuilder")}static CreateCylinder(t){throw R("cylinderBuilder")}static CreateTorus(t){throw R("torusBuilder")}static CreateLineSystem(t){throw R("linesBuilder")}static CreateDashedLines(t){throw R("linesBuilder")}static CreateGround(t){throw R("groundBuilder")}static CreateTiledGround(t){throw R("groundBuilder")}static CreateGroundFromHeightMap(t){throw R("groundBuilder")}static CreatePlane(t){throw R("planeBuilder")}static CreateDisc(t){throw R("discBuilder")}static CreatePolygon(t,i,e,s,n,o,a){throw R("polygonBuilder")}static CreateIcoSphere(t){throw R("icoSphereBuilder")}static CreatePolyhedron(t){throw R("polyhedronBuilder")}static CreateCapsule(t={orientation:m.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){throw R("capsuleBuilder")}static CreateTorusKnot(t){throw R("torusKnotBuilder")}static ComputeNormals(t,i,e,s){let n=0,o=0,a=0,c=0,h=0,u=0,g=0,M=0,r=0,p=0,_=0,D=0,b=0,A=0,C=0,y=0,S=0,x=0,F=0,V=0,dt=!1,gt=!1,rt=!1,at=!1,J=1,B=0,G=null;s&&(dt=!!s.facetNormals,gt=!!s.facetPositions,rt=!!s.facetPartitioning,J=s.useRightHandedSystem===!0?-1:1,B=s.ratio||0,at=!!s.depthSort,G=s.distanceTo,at&&G===void 0&&(G=m.Zero()));let Q=0,Y=0,Z=0,H=0;for(rt&&s&&s.bbSize&&(Q=s.subDiv.X*B/s.bbSize.x,Y=s.subDiv.Y*B/s.bbSize.y,Z=s.subDiv.Z*B/s.bbSize.z,H=s.subDiv.max*s.subDiv.max,s.facetPartitioning.length=0),n=0;n<t.length;n++)e[n]=0;let Ct=i.length/3|0;for(n=0;n<Ct;n++){if(D=i[n*3]*3,b=D+1,A=D+2,C=i[n*3+1]*3,y=C+1,S=C+2,x=i[n*3+2]*3,F=x+1,V=x+2,o=t[D]-t[C],a=t[b]-t[y],c=t[A]-t[S],h=t[x]-t[C],u=t[F]-t[y],g=t[V]-t[S],M=J*(a*g-c*u),r=J*(c*h-o*g),p=J*(o*u-a*h),_=Math.sqrt(M*M+r*r+p*p),_=_===0?1:_,M/=_,r/=_,p/=_,dt&&s&&(s.facetNormals[n].x=M,s.facetNormals[n].y=r,s.facetNormals[n].z=p),gt&&s&&(s.facetPositions[n].x=(t[D]+t[C]+t[x])/3,s.facetPositions[n].y=(t[b]+t[y]+t[F])/3,s.facetPositions[n].z=(t[A]+t[S]+t[V])/3),rt&&s){let tt=Math.floor((s.facetPositions[n].x-s.bInfo.minimum.x*B)*Q),Tt=Math.floor((s.facetPositions[n].y-s.bInfo.minimum.y*B)*Y),Ft=Math.floor((s.facetPositions[n].z-s.bInfo.minimum.z*B)*Z),Bt=Math.floor((t[D]-s.bInfo.minimum.x*B)*Q),wt=Math.floor((t[b]-s.bInfo.minimum.y*B)*Y),Et=Math.floor((t[A]-s.bInfo.minimum.z*B)*Z),Vt=Math.floor((t[C]-s.bInfo.minimum.x*B)*Q),Lt=Math.floor((t[y]-s.bInfo.minimum.y*B)*Y),Ot=Math.floor((t[S]-s.bInfo.minimum.z*B)*Z),Wt=Math.floor((t[x]-s.bInfo.minimum.x*B)*Q),Nt=Math.floor((t[F]-s.bInfo.minimum.y*B)*Y),zt=Math.floor((t[V]-s.bInfo.minimum.z*B)*Z),L=Bt+s.subDiv.max*wt+H*Et,O=Vt+s.subDiv.max*Lt+H*Ot,W=Wt+s.subDiv.max*Nt+H*zt,N=tt+s.subDiv.max*Tt+H*Ft;s.facetPartitioning[N]=s.facetPartitioning[N]?s.facetPartitioning[N]:[],s.facetPartitioning[L]=s.facetPartitioning[L]?s.facetPartitioning[L]:[],s.facetPartitioning[O]=s.facetPartitioning[O]?s.facetPartitioning[O]:[],s.facetPartitioning[W]=s.facetPartitioning[W]?s.facetPartitioning[W]:[],s.facetPartitioning[L].push(n),O!=L&&s.facetPartitioning[O].push(n),W==O||W==L||s.facetPartitioning[W].push(n),N==L||N==O||N==W||s.facetPartitioning[N].push(n)}if(at&&s&&s.facetPositions){let tt=s.depthSortedFacets[n];tt.ind=n*3,tt.sqDistance=m.DistanceSquared(s.facetPositions[n],G)}e[D]+=M,e[b]+=r,e[A]+=p,e[C]+=M,e[y]+=r,e[S]+=p,e[x]+=M,e[F]+=r,e[V]+=p}for(n=0;n<e.length/3;n++)M=e[n*3],r=e[n*3+1],p=e[n*3+2],_=Math.sqrt(M*M+r*r+p*p),_=_===0?1:_,M/=_,r/=_,p/=_,e[n*3]=M,e[n*3+1]=r,e[n*3+2]=p}static _ComputeSides(t,i,e,s,n,o,a){let c=e.length,h=s.length,u,g;switch(t=t||f.DEFAULTSIDE,t){case f.FRONTSIDE:break;case f.BACKSIDE:for(u=0;u<c;u+=3){let M=e[u];e[u]=e[u+2],e[u+2]=M}for(g=0;g<h;g++)s[g]=-s[g];break;case f.DOUBLESIDE:{let M=i.length,r=M/3;for(let D=0;D<M;D++)i[M+D]=i[D];for(u=0;u<c;u+=3)e[u+c]=e[u+2]+r,e[u+1+c]=e[u+1]+r,e[u+2+c]=e[u]+r;for(g=0;g<h;g++)s[h+g]=-s[g];let p=n.length,_=0;for(_=0;_<p;_++)n[_+p]=n[_];for(o=o||new X(0,0,1,1),a=a||new X(0,0,1,1),_=0,u=0;u<p/2;u++)n[_]=o.x+(o.z-o.x)*n[_],n[_+1]=o.y+(o.w-o.y)*n[_+1],n[_+p]=a.x+(a.z-a.x)*n[_+p],n[_+p+1]=a.y+(a.w-a.y)*n[_+p+1],_+=2;break}}}static Parse(t){let i=new f,e=t.positions;e&&i.set(e,l.PositionKind);let s=t.normals;s&&i.set(s,l.NormalKind);let n=t.tangents;n&&i.set(n,l.TangentKind);let o=t.uvs;o&&i.set(o,l.UVKind);let a=t.uvs2;a&&i.set(a,l.UV2Kind);let c=t.uvs3;c&&i.set(c,l.UV3Kind);let h=t.uvs4;h&&i.set(h,l.UV4Kind);let u=t.uvs5;u&&i.set(u,l.UV5Kind);let g=t.uvs6;g&&i.set(g,l.UV6Kind);let M=t.colors;M&&(i.set(et.CheckColors4(M,e.length/3),l.ColorKind),t.hasVertexAlpha!==void 0&&(i.hasVertexAlpha=t.hasVertexAlpha));let r=t.matricesIndices;r&&i.set(r,l.MatricesIndicesKind);let p=t.matricesWeights;p&&i.set(p,l.MatricesWeightsKind);let _=t.indices;_&&(i.indices=_);let D=t.materialInfos;if(D){i.materialInfos=[];for(let b of D){let A=new j;A.indexCount=b.indexCount,A.indexStart=b.indexStart,A.verticesCount=b.verticesCount,A.verticesStart=b.verticesStart,A.materialIndex=b.materialIndex,i.materialInfos.push(A)}}return i}static ImportVertexData(t,i){let e=f.Parse(t);i.setAllVerticesData(e,t.updatable)}};w.FRONTSIDE=0;w.BACKSIDE=1;w.DOUBLESIDE=2;w.DEFAULTSIDE=0;w._UniqueIdGenerator=0;T([U.filter((...[f])=>!Array.isArray(f))],w,"_TransformVector3Coordinates",null);T([U.filter((...[f])=>!Array.isArray(f))],w,"_TransformVector3Normals",null);T([U.filter((...[f])=>!Array.isArray(f))],w,"_TransformVector4Normals",null);T([U.filter((...[f])=>!Array.isArray(f))],w,"_FlipFaces",null);var I=class f extends lt{get billboardMode(){return this._billboardMode}set billboardMode(t){this._billboardMode!==t&&(this._billboardMode=t,this._cache.useBillboardPosition=(this._billboardMode&f.BILLBOARDMODE_USE_POSITION)!==0)}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(t){this._infiniteDistance!==t&&(this._infiniteDistance=t)}constructor(t,i=null,e=!0){super(t,i,!1),this._forward=new m(0,0,1),this._up=new m(0,1,0),this._right=new m(1,0,0),this._position=m.Zero(),this._rotation=m.Zero(),this._rotationQuaternion=null,this._scaling=m.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=f.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=v.Zero(),this._usePivotMatrix=!1,this._absolutePosition=m.Zero(),this._absoluteScaling=m.Zero(),this._absoluteRotationQuaternion=P.Identity(),this._pivotMatrix=v.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new z,this._nonUniformScaling=!1,e&&this.getScene().addTransformNode(this)}getClassName(){return"TransformNode"}get position(){return this._position}set position(t){this._position=t,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._rotationQuaternion=null,this._markAsDirtyInternal()}get scaling(){return this._scaling}set scaling(t){this._scaling=t,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(t){this._rotationQuaternion=t,t&&this._rotation.setAll(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return m.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return m.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return m.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(t){return this._poseMatrix?(this._poseMatrix.copyFrom(t),this):(this._poseMatrix=t.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=v.Identity()),this._poseMatrix}_isSynchronized(){let t=this._cache;return!(this._billboardMode!==t.billboardMode||this._billboardMode!==f.BILLBOARDMODE_NONE||t.pivotMatrixUpdated||this._infiniteDistance||this._position._isDirty||this._scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)}_initCache(){super._initCache();let t=this._cache;t.localMatrixUpdated=!1,t.billboardMode=-1,t.infiniteDistance=!1,t.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(t){return this.setPivotMatrix(t,!1)}setPivotMatrix(t,i=!0){return this._pivotMatrix.copyFrom(t),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=i,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=v.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(t=null,i,e){let s=this.clone("Clone of "+(this.name||this.id),t||this.parent,!0);s&&e&&e(this,s);for(let n of this.getChildTransformNodes(!0))n.instantiateHierarchy(s,i,e);return s}freezeWorldMatrix(t=null,i=!1){return t?i?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||P.Identity(),t.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=t,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}get isWorldMatrixFrozen(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.computeWorldMatrix(),this._absolutePosition}setAbsolutePosition(t){if(!t)return this;let i,e,s;if(t.x===void 0){if(arguments.length<3)return this;i=arguments[0],e=arguments[1],s=arguments[2]}else i=t.x,e=t.y,s=t.z;if(this.parent){let n=d.Matrix[0];this.parent.getWorldMatrix().invertToRef(n),m.TransformCoordinatesFromFloatsToRef(i,e,s,n,this.position)}else this.position.x=i,this.position.y=e,this.position.z=s;return this._absolutePosition.copyFrom(t),this}setPositionWithLocalVector(t){return this.computeWorldMatrix(),this.position=m.TransformNormal(t,this._localMatrix),this}getPositionExpressedInLocalSpace(){this.computeWorldMatrix();let t=d.Matrix[0];return this._localMatrix.invertToRef(t),m.TransformNormal(this.position,t)}locallyTranslate(t){return this.computeWorldMatrix(!0),this.position=m.TransformCoordinates(t,this._localMatrix),this}lookAt(t,i=0,e=0,s=0,n=0){let o=f._LookAtVectorCache,a=n===0?this.position:this.getAbsolutePosition();if(t.subtractToRef(a,o),this.setDirection(o,i,e,s),n===1&&this.parent)if(this.rotationQuaternion){let c=d.Matrix[0];this.rotationQuaternion.toRotationMatrix(c);let h=d.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.invert(),c.multiplyToRef(h,c),this.rotationQuaternion.fromRotationMatrix(c)}else{let c=d.Quaternion[0];P.FromEulerVectorToRef(this.rotation,c);let h=d.Matrix[0];c.toRotationMatrix(h);let u=d.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(u),u.invert(),h.multiplyToRef(u,h),c.fromRotationMatrix(h),c.toEulerAnglesToRef(this.rotation)}return this}getDirection(t){let i=m.Zero();return this.getDirectionToRef(t,i),i}getDirectionToRef(t,i){return m.TransformNormalToRef(t,this.getWorldMatrix(),i),this}setDirection(t,i=0,e=0,s=0){let n=-Math.atan2(t.z,t.x)+Math.PI/2,o=Math.sqrt(t.x*t.x+t.z*t.z),a=-Math.atan2(t.y,o);return this.rotationQuaternion?P.RotationYawPitchRollToRef(n+i,a+e,s,this.rotationQuaternion):(this.rotation.x=a+e,this.rotation.y=n+i,this.rotation.z=s),this}setPivotPoint(t,i=0){this.getScene().getRenderId()==0&&this.computeWorldMatrix(!0);let e=this.getWorldMatrix();if(i==1){let s=d.Matrix[0];e.invertToRef(s),t=m.TransformCoordinates(t,s)}return this.setPivotMatrix(v.Translation(-t.x,-t.y,-t.z),!0)}getPivotPoint(){let t=m.Zero();return this.getPivotPointToRef(t),t}getPivotPointToRef(t){return t.x=-this._pivotMatrix.m[12],t.y=-this._pivotMatrix.m[13],t.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){let t=m.Zero();return this.getAbsolutePivotPointToRef(t),t}getAbsolutePivotPointToRef(t){return this.getPivotPointToRef(t),m.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this}markAsDirty(t){if(this._isDirty)return this;if(this._children)for(let i of this._children)i.markAsDirty(t);return super.markAsDirty(t)}setParent(t,i=!1,e=!1){if(!t&&!this.parent)return this;let s=d.Quaternion[0],n=d.Vector3[0],o=d.Vector3[1],a=d.Matrix[1];v.IdentityToRef(a);let c=d.Matrix[0];this.computeWorldMatrix(!0);let h=this.rotationQuaternion;return h||(h=f._TmpRotation,P.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,h)),v.ComposeToRef(this.scaling,h,this.position,c),this.parent&&c.multiplyToRef(this.parent.computeWorldMatrix(!0),c),t&&(t.computeWorldMatrix(!0).invertToRef(a),c.multiplyToRef(a,c)),c.decompose(o,s,n,i?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(s):s.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(o),this.position.copyFrom(n),this.parent=t,e&&this.setPivotMatrix(v.Identity()),this}addChild(t,i=!1){return t.setParent(this,i),this}removeChild(t,i=!1){return t.parent!==this?this:(t.setParent(null,i),this)}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(t){return this._nonUniformScaling===t?!1:(this._nonUniformScaling=t,!0)}attachToBone(t,i){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=i,this.parent=t,t.getSkeleton().prepare(!0),t.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(t=!1){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,t?this.parent=this._currentParentWhenAttachingToBone:this.parent=null,this):(t&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(t,i,e){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0));let s;if(!e||e===0)s=P.RotationAxisToRef(t,i,f._RotationAxisCache),this.rotationQuaternion.multiplyToRef(s,this.rotationQuaternion);else{if(this.parent){let n=this.parent.getWorldMatrix(),o=d.Matrix[0];n.invertToRef(o),t=m.TransformNormal(t,o),n.determinant()<0&&(i*=-1)}s=P.RotationAxisToRef(t,i,f._RotationAxisCache),s.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}return this}rotateAround(t,i,e){i.normalize(),this.rotationQuaternion||(this.rotationQuaternion=P.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));let s=d.Vector3[0],n=d.Vector3[1],o=d.Vector3[2],a=d.Quaternion[0],c=d.Matrix[0],h=d.Matrix[1],u=d.Matrix[2],g=d.Matrix[3];return t.subtractToRef(this.position,s),v.TranslationToRef(s.x,s.y,s.z,c),v.TranslationToRef(-s.x,-s.y,-s.z,h),v.RotationAxisToRef(i,e,u),h.multiplyToRef(u,g),g.multiplyToRef(c,g),g.decompose(n,a,o),this.position.addInPlace(o),a.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(t,i,e){let s=t.scale(i);if(!e||e===0){let n=this.getPositionExpressedInLocalSpace().add(s);this.setPositionWithLocalVector(n)}else this.setAbsolutePosition(this.getAbsolutePosition().add(s));return this}addRotation(t,i,e){let s;this.rotationQuaternion?s=this.rotationQuaternion:(s=d.Quaternion[1],P.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,s));let n=d.Quaternion[0];return P.RotationYawPitchRollToRef(i,t,e,n),s.multiplyInPlace(n),this.rotationQuaternion||s.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==f.BILLBOARDMODE_NONE}computeWorldMatrix(t=!1,i=null){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;let e=this.getScene().getRenderId();if(!this._isDirty&&!t&&(this._currentRenderId===e||this.isSynchronized()))return this._currentRenderId=e,this._worldMatrix;i=i||this.getScene().activeCamera,this._updateCache();let s=this._cache;s.pivotMatrixUpdated=!1,s.billboardMode=this.billboardMode,s.infiniteDistance=this.infiniteDistance,s.parent=this._parentNode,this._currentRenderId=e,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;let n=this._getEffectiveParent(),o=f._TmpScaling,a=this._position;if(this._infiniteDistance&&!this.parent&&i){let h=i.getWorldMatrix(),u=new m(h.m[12],h.m[13],h.m[14]);a=f._TmpTranslation,a.copyFromFloats(this._position.x+u.x,this._position.y+u.y,this._position.z+u.z)}o.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);let c;if(this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,c=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(P.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(c=f._TmpRotation,P.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,c)),this._usePivotMatrix){let h=d.Matrix[1];v.ScalingToRef(o.x,o.y,o.z,h);let u=d.Matrix[0];c.toRotationMatrix(u),this._pivotMatrix.multiplyToRef(h,d.Matrix[4]),d.Matrix[4].multiplyToRef(u,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(a.x,a.y,a.z)}else v.ComposeToRef(o,c,a,this._localMatrix);if(n&&n.getWorldMatrix){if(t&&n.computeWorldMatrix(t),this.billboardMode){if(this._transformToBoneReferal){let M=this.parent;M.getSkeleton().prepare(),M.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),d.Matrix[7])}else d.Matrix[7].copyFrom(n.getWorldMatrix());let h=d.Vector3[5],u=d.Vector3[6],g=d.Quaternion[0];d.Matrix[7].decompose(u,g,h),v.ScalingToRef(u.x,u.y,u.z,d.Matrix[7]),d.Matrix[7].setTranslation(h),f.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(g,h),this._localMatrix.setTranslation(h)),this._localMatrix.multiplyToRef(d.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){let h=this.parent;h.getSkeleton().prepare(),this._localMatrix.multiplyToRef(h.getFinalMatrix(),d.Matrix[6]),d.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._localMatrix.multiplyToRef(n.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(i&&this.billboardMode)if(s.useBillboardPosition){let h=d.Vector3[0];this._worldMatrix.getTranslationToRef(h);let u=i.globalPosition;this._worldMatrix.invertToRef(d.Matrix[1]);let g=d.Vector3[1];m.TransformCoordinatesToRef(u,d.Matrix[1],g),g.normalize();let M=-Math.atan2(g.z,g.x)+Math.PI/2,r=Math.sqrt(g.x*g.x+g.z*g.z),p=-Math.atan2(g.y,r);if(P.RotationYawPitchRollToRef(M,p,0,d.Quaternion[0]),(this.billboardMode&f.BILLBOARDMODE_ALL)!==f.BILLBOARDMODE_ALL){let _=d.Vector3[1];d.Quaternion[0].toEulerAnglesToRef(_),(this.billboardMode&f.BILLBOARDMODE_X)!==f.BILLBOARDMODE_X&&(_.x=0),(this.billboardMode&f.BILLBOARDMODE_Y)!==f.BILLBOARDMODE_Y&&(_.y=0),(this.billboardMode&f.BILLBOARDMODE_Z)!==f.BILLBOARDMODE_Z&&(_.z=0),v.RotationYawPitchRollToRef(_.y,_.x,_.z,d.Matrix[0])}else v.FromQuaternionToRef(d.Quaternion[0],d.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(d.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(d.Vector3[0])}else{let h=d.Vector3[0];this._worldMatrix.getTranslationToRef(h),d.Matrix[1].copyFrom(i.getViewMatrix());let u=this.getScene().useRightHandedSystem;if(u&&d.Matrix[1].multiplyToRef(f._TmpRHRestore,d.Matrix[1]),d.Matrix[1].setTranslationFromFloats(0,0,0),d.Matrix[1].invertToRef(d.Matrix[0]),(this.billboardMode&f.BILLBOARDMODE_ALL)!==f.BILLBOARDMODE_ALL){d.Matrix[0].decompose(void 0,d.Quaternion[0],void 0);let g=d.Vector3[1];d.Quaternion[0].toEulerAnglesToRef(g),(this.billboardMode&f.BILLBOARDMODE_X)!==f.BILLBOARDMODE_X&&(g.x=0),(this.billboardMode&f.BILLBOARDMODE_Y)!==f.BILLBOARDMODE_Y&&(g.y=0),(this.billboardMode&f.BILLBOARDMODE_Z)!==f.BILLBOARDMODE_Z&&(g.z=0),u&&(g.y+=Math.PI),v.RotationYawPitchRollToRef(g.y,g.x,g.z,d.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(d.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(d.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):n&&n._nonUniformScaling?this._updateNonUniformScalingState(n._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=v.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(t=!0){if(this.computeWorldMatrix(),t){let i=this.getChildren();for(let e=0;e<i.length;++e){let s=i[e];if(s){s.computeWorldMatrix();let n=d.Matrix[0];s._localMatrix.multiplyToRef(this._localMatrix,n);let o=d.Quaternion[0];n.decompose(s.scaling,o,s.position),s.rotationQuaternion?s.rotationQuaternion.copyFrom(o):o.toEulerAnglesToRef(s.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=P.Identity()),this._worldMatrix=v.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(t){return this.onAfterWorldMatrixUpdateObservable.add(t),this}unregisterAfterWorldMatrixUpdate(t){return this.onAfterWorldMatrixUpdateObservable.removeCallback(t),this}getPositionInCameraSpace(t=null){return t||(t=this.getScene().activeCamera),m.TransformCoordinates(this.getAbsolutePosition(),t.getViewMatrix())}getDistanceToCamera(t=null){return t||(t=this.getScene().activeCamera),this.getAbsolutePosition().subtract(t.globalPosition).length()}clone(t,i,e){let s=q.Clone(()=>new f(t,this.getScene()),this);if(s.name=t,s.id=t,i&&(s.parent=i),!e){let n=this.getDescendants(!0);for(let o=0;o<n.length;o++){let a=n[o];a.clone&&a.clone(t+"."+a.name,s)}}return s}serialize(t){let i=q.Serialize(this,t);return i.type=this.getClassName(),i.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(i),i.localMatrix=this.getPivotMatrix().asArray(),i.isEnabled=this.isEnabled(),q.AppendSerializedAnimations(this,i),i.ranges=this.serializeAnimationRanges(),i}static Parse(t,i,e){let s=q.Parse(()=>new f(t.name,i),t,i,e);if(t.localMatrix?s.setPreTransformMatrix(v.FromArray(t.localMatrix)):t.pivotMatrix&&s.setPivotMatrix(v.FromArray(t.pivotMatrix)),s.setEnabled(t.isEnabled),s._waitingParsedUniqueId=t.uniqueId,t.parentId!==void 0&&(s._waitingParentId=t.parentId),t.parentInstanceIndex!==void 0&&(s._waitingParentInstanceIndex=t.parentInstanceIndex),t.animations){for(let n=0;n<t.animations.length;n++){let o=t.animations[n],a=bt("BABYLON.Animation");a&&s.animations.push(a.Parse(o))}lt.ParseAnimationRanges(s,t,i)}return t.autoAnimate&&i.beginAnimation(s,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),s}getChildTransformNodes(t,i){let e=[];return this._getDescendants(e,t,s=>(!i||i(s))&&s instanceof f),e}dispose(t,i=!1){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){let e=this._parentContainer.transformNodes.indexOf(this);e>-1&&this._parentContainer.transformNodes.splice(e,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),t){let e=this.getChildTransformNodes(!0);for(let s of e)s.parent=null,s.computeWorldMatrix(!0)}super.dispose(t,i)}normalizeToUnitCube(t=!0,i=!1,e){let s=null,n=null;i&&(this.rotationQuaternion?(n=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(s=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));let o=this.getHierarchyBoundingVectors(t,e),a=o.max.subtract(o.min),c=Math.max(a.x,a.y,a.z);if(c===0)return this;let h=1/c;return this.scaling.scaleInPlace(h),i&&(this.rotationQuaternion&&n?this.rotationQuaternion.copyFrom(n):this.rotation&&s&&this.rotation.copyFrom(s)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}};I.BILLBOARDMODE_NONE=0;I.BILLBOARDMODE_X=1;I.BILLBOARDMODE_Y=2;I.BILLBOARDMODE_Z=4;I.BILLBOARDMODE_ALL=7;I.BILLBOARDMODE_USE_POSITION=128;I.BillboardUseParentOrientation=!1;I._TmpRotation=P.Zero();I._TmpScaling=m.Zero();I._TmpTranslation=m.Zero();I._TmpRHRestore=v.Scaling(1,1,-1);I._LookAtVectorCache=new m(0,0,0);I._RotationAxisCache=new P;T([st("position")],I.prototype,"_position",void 0);T([st("rotation")],I.prototype,"_rotation",void 0);T([It("rotationQuaternion")],I.prototype,"_rotationQuaternion",void 0);T([st("scaling")],I.prototype,"_scaling",void 0);T([k("billboardMode")],I.prototype,"_billboardMode",void 0);T([k()],I.prototype,"scalingDeterminant",void 0);T([k("infiniteDistance")],I.prototype,"_infiniteDistance",void 0);T([k()],I.prototype,"ignoreNonUniformScaling",void 0);T([k()],I.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0);var nt=class{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new m(0,0,0),this._diffPositionForCollisions=new m(0,0,0),this._collisionResponse=!0}};function Kt(f,t,i){let e=null;switch(t){case l.PositionKind:e=s=>s.getPositions();break;case l.NormalKind:e=s=>s.getNormals();break;case l.TangentKind:e=s=>s.getTangents();break;case l.UVKind:e=s=>s.getUVs();break;case l.UV2Kind:e=s=>s.getUV2s();break;case l.ColorKind:e=s=>s.getColors();break;default:return}for(let s=0;s<f.length;s++){let n=f[s];for(let o=0;o<i.numTargets;o++){let a=i.getTarget(o),c=a.influence;if(c!==0){let h=e(a);h&&(n+=(h[s]-f[s])*c)}}f[s]=n}}function Ut(f,t,i,e,s,n,o){let a=d.Vector3[0],c=d.Matrix[0],h=d.Matrix[1],u=t===l.NormalKind?m.TransformNormalFromFloatsToRef:m.TransformCoordinatesFromFloatsToRef;for(let g=0,M=0;g<f.length;g+=3,M+=4){c.reset();let r,p;for(r=0;r<4;r++)p=s[M+r],p>0&&(v.FromFloat32ArrayToRefScaled(i,Math.floor(e[M+r]*16),p,h),c.addToSelf(h));if(n&&o)for(r=0;r<4;r++)p=o[M+r],p>0&&(v.FromFloat32ArrayToRefScaled(i,Math.floor(n[M+r]*16),p,h),c.addToSelf(h));u(f[g],f[g+1],f[g+2],c,a),a.toArray(f,g)}}var ft=class{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=m.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}},ut=class{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new ft,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new nt,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._wasActiveLastFrame=!1}},E=class f extends I{static get BILLBOARDMODE_NONE(){return I.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return I.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return I.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return I.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return I.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return I.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(t){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=t}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(t){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=t}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=t}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=t}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(t){this._internalAbstractMeshDataInfo._collisionRetryCount=t}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(t){this._internalAbstractMeshDataInfo._morphTargetManager!==t&&(this._internalAbstractMeshDataInfo._morphTargetManager=t,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(t){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==t&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=t,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(t){return super._updateNonUniformScalingState(t)?(this._markSubMeshesAsMiscDirty(),!0):!1}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(t){this._internalAbstractMeshDataInfo._rawBoundingInfo=t}set onCollide(t){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(t)}set onCollisionPositionChange(t){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(t)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(t){if(this._internalAbstractMeshDataInfo._visibility===t)return;let i=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=t,(i===1&&t!==1||i!==1&&t===1)&&this._markSubMeshesAsDirty(e=>{e.markAsMiscDirty(),e.markAsPrePassDirty()})}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(t){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=t}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(t){this._internalAbstractMeshDataInfo._renderingGroupId=t}get material(){return this._internalAbstractMeshDataInfo._material}set material(t){this._setMaterial(t)}_setMaterial(t){this._internalAbstractMeshDataInfo._material!==t&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=t,t&&t.meshMap&&(t.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(void 0,t==null),this._unBindEffect()))}getMaterialForRenderPass(t){return this._internalAbstractMeshDataInfo._materialForRenderPass?.[t]}setMaterialForRenderPass(t,i){this.resetDrawCache(t),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);let e=this._internalAbstractMeshDataInfo._materialForRenderPass[t];e?.meshMap?.[this.uniqueId]&&(e.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[t]=i,i&&i.meshMap&&(i.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(t){this._internalAbstractMeshDataInfo._receiveShadows!==t&&(this._internalAbstractMeshDataInfo._receiveShadows=t,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(t){this._internalAbstractMeshDataInfo._hasVertexAlpha!==t&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=t,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(t){this._internalAbstractMeshDataInfo._useVertexColors!==t&&(this._internalAbstractMeshDataInfo._useVertexColors=t,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(t){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==t&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=t,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(t){this._internalAbstractMeshDataInfo._numBoneInfluencers!==t&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=t,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(t){this._internalAbstractMeshDataInfo._applyFog!==t&&(this._internalAbstractMeshDataInfo._applyFog=t,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(t){this._internalAbstractMeshDataInfo._enableDistantPicking=t}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(t){t!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=t,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(t)?-1:t}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=t}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(t){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(t)?-1:t}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(t){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=t}get lightSources(){return this._lightSources}set skeleton(t){let i=this._internalAbstractMeshDataInfo._skeleton;i&&i.needInitialSkinMatrix&&i._unregisterMeshWithPoseMatrix(this),t&&t.needInitialSkinMatrix&&t._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=t,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(t,i=null){switch(super(t,i,!1),this._internalAbstractMeshDataInfo=new ut,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.cullingStrategy=f.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this.onCollideObservable=new z,this.onCollisionPositionChangeObservable=new z,this.onMaterialChangedObservable=new z,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this.isPickable=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=ot.Red(),this.outlineWidth=.02,this.overlayColor=ot.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.alwaysSelectAsActiveMesh=!1,this.doNotSyncBoundingInfo=!1,this.actionManager=null,this.ellipsoid=new m(.5,1,.5),this.ellipsoidOffset=new m(0,0,0),this.edgesWidth=1,this.edgesColor=new et(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,freezeWorldMatrix:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new z,this._onCollisionPositionChange=(e,s,n=null)=>{s.subtractToRef(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>At.CollisionsEpsilon&&this.position.addInPlace(this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),n&&this.onCollideObservable.notifyObservers(n),this.onCollisionPositionChangeObservable.notifyObservers(this.position)},i=this.getScene(),i.addMesh(this),this._resyncLightSources(),this._uniformBuffer=new Dt(this.getScene().getEngine(),void 0,void 0,t,!this.getScene().getEngine().isWebGPU),this._buildUniformLayout(),i.performancePriority){case 2:this.doNotSyncBoundingInfo=!0;case 1:this.alwaysSelectAsActiveMesh=!0,this.isPickable=!1;break}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(t){let i=this._uniformBuffer;i.updateMatrix("world",t),i.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),i.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(t){let i="Name: "+this.name+", isInstance: "+(this.getClassName()==="InstancedMesh"?"YES":"NO");i+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);let e=this._internalAbstractMeshDataInfo._skeleton;return e&&(i+=", skeleton: "+e.name),t&&(i+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],i+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),i}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==I.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(t,i=!0){if(this.actionManager&&(i||this.actionManager.isRecursive))if(t){if(this.actionManager.hasSpecificTrigger(t))return this.actionManager}else return this.actionManager;return this.parent?this.parent._getActionManagerForTrigger(t,!1):null}_rebuild(t=!1){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery!==null&&(this._occlusionQuery=null),!!this.subMeshes){for(let i of this.subMeshes)i._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(let t of this.getScene().lights)t.isEnabled()&&t.canAffectMesh(this)&&this._lightSources.push(t);this._markSubMeshesAsLightDirty()}_resyncLightSource(t){let i=t.isEnabled()&&t.canAffectMesh(this),e=this._lightSources.indexOf(t),s=!1;if(e===-1){if(!i)return;this._lightSources.push(t)}else{if(i)return;s=!0,this._lightSources.splice(e,1)}this._markSubMeshesAsLightDirty(s)}_unBindEffect(){for(let t of this.subMeshes)t.setEffect(null)}_removeLightSource(t,i){let e=this._lightSources.indexOf(t);e!==-1&&(this._lightSources.splice(e,1),this._markSubMeshesAsLightDirty(i))}_markSubMeshesAsDirty(t){if(this.subMeshes)for(let i of this.subMeshes)for(let e=0;e<i._drawWrappers.length;++e){let s=i._drawWrappers[e];!s||!s.defines||!s.defines.markAllAsDirty||t(s.defines)}}_markSubMeshesAsLightDirty(t=!1){this._markSubMeshesAsDirty(i=>i.markAsLightDirty(t))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty(t=>t.markAsAttributesDirty())}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty(t=>t.markAsMiscDirty())}markAsDirty(t){return this._currentRenderId=Number.MAX_VALUE,super.markAsDirty(t),this._isDirty=!0,this}resetDrawCache(t,i=!1){if(this.subMeshes)for(let e of this.subMeshes)e.resetDrawCache(t,i)}get isBlocked(){return!1}getLOD(t){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}getIndices(){return null}getVerticesData(t){return null}setVerticesData(t,i,e,s){return this}updateVerticesData(t,i,e,s){return this}setIndices(t,i){return this}isVerticesDataPresent(t){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(t){return this._boundingInfo=t,this}get hasBoundingInfo(){return this._boundingInfo!==null}buildBoundingInfo(t,i,e){return this._boundingInfo=new $(t,i,e),this._boundingInfo}normalizeToUnitCube(t=!0,i=!1,e){return super.normalizeToUnitCube(t,i,e)}get useBones(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(l.MatricesIndicesKind)&&this.isVerticesDataPresent(l.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(t){}_activate(t,i){return this._renderId=t,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===I.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(t,i,e){return this.position.addInPlace(this.calcMovePOV(t,i,e)),this}calcMovePOV(t,i,e){let s=new v;(this.rotationQuaternion?this.rotationQuaternion:P.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(s);let o=m.Zero(),a=this.definedFacingForward?-1:1;return m.TransformCoordinatesFromFloatsToRef(t*a,i,e*a,s,o),o}rotatePOV(t,i,e){return this.rotation.addInPlace(this.calcRotatePOV(t,i,e)),this}calcRotatePOV(t,i,e){let s=this.definedFacingForward?1:-1;return new m(t*s,i,e*s)}_refreshBoundingInfo(t,i){if(t){let e=St(t,0,this.getTotalVertices(),i);this._boundingInfo?this._boundingInfo.reConstruct(e.minimum,e.maximum):this._boundingInfo=new $(e.minimum,e.maximum)}if(this.subMeshes)for(let e=0;e<this.subMeshes.length;e++)this.subMeshes[e].refreshBoundingInfo(t);this._updateBoundingInfo()}_refreshBoundingInfoDirect(t){if(this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new $(t.minimum,t.maximum),this.subMeshes)for(let i=0;i<this.subMeshes.length;i++)this.subMeshes[i].refreshBoundingInfo(null);this._updateBoundingInfo()}static _ApplySkeleton(t,i,e,s,n,o,a){Ut(t,i,e,s,n,o,a)}_getData(t,i,e=l.PositionKind){let s=t.cache,n=o=>{if(s){let a=s._vertexData||(s._vertexData={});return a[o]||this.copyVerticesData(o,a),a[o]}return this.getVerticesData(o)};if(i||(i=n(e)),!i)return null;if(s?(s._outputData?s._outputData.set(i):s._outputData=new Float32Array(i),i=s._outputData):(t.applyMorph&&this.morphTargetManager||t.applySkeleton&&this.skeleton)&&(i=i.slice()),t.applyMorph&&this.morphTargetManager&&Kt(i,e,this.morphTargetManager),t.applySkeleton&&this.skeleton){let o=n(l.MatricesIndicesKind),a=n(l.MatricesWeightsKind);if(a&&o){let c=this.numBoneInfluencers>4,h=c?n(l.MatricesIndicesExtraKind):null,u=c?n(l.MatricesWeightsExtraKind):null,g=this.skeleton.getTransformMatrices(this);f._ApplySkeleton(i,e,g,o,a,h,u)}}if(t.updatePositionsArray!==!1&&e===l.PositionKind){let o=this._internalAbstractMeshDataInfo._positions||[],a=o.length;if(o.length=i.length/3,a<o.length)for(let c=a;c<o.length;c++)o[c]=new m;for(let c=0,h=0;c<o.length;c++,h+=3)o[c].copyFromFloats(i[h],i[h+1],i[h+2]);this._internalAbstractMeshDataInfo._positions=o}return i}getNormalsData(t=!1,i=!1){return this._getData({applySkeleton:t,applyMorph:i,updatePositionsArray:!1},null,l.NormalKind)}getPositionData(t=!1,i=!1,e=null){return this._getData({applySkeleton:t,applyMorph:i,updatePositionsArray:!1},e,l.PositionKind)}_updateBoundingInfo(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new $(m.Zero(),m.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(t){if(!this.subMeshes)return this;let i=this.subMeshes.length;for(let e=0;e<i;e++){let s=this.subMeshes[e];(i>1||!s.IsGlobal)&&s.updateBoundingInfo(t)}return this}_afterComputeWorldMatrix(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}isInFrustum(t){return this.getBoundingInfo().isInFrustum(t,this.cullingStrategy)}isCompletelyInFrustum(t){return this.getBoundingInfo().isCompletelyInFrustum(t)}intersectsMesh(t,i=!1,e){let s=this.getBoundingInfo(),n=t.getBoundingInfo();if(s.intersects(n,i))return!0;if(e){for(let o of this.getChildMeshes())if(o.intersectsMesh(t,i,!0))return!0}return!1}intersectsPoint(t){return this.getBoundingInfo().intersectsPoint(t)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(t){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=t}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(t,i=!0){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);let s=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=s.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,s.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,t,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,i),this}_collideForSubMesh(t,i,e){if(this._generatePointsArray(),!this._positions)return this;if(!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];let s=t.verticesStart,n=t.verticesStart+t.verticesCount;for(let o=s;o<n;o++)t._lastColliderWorldVertices.push(m.TransformCoordinates(this._positions[o],i))}return e._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial(),this,this._shouldConvertRHS(),t.getMaterial()?.fillMode===7),this}_processCollisionsForSubMeshes(t,i){let e=this._scene.getCollidingSubMeshCandidates(this,t),s=e.length;for(let n=0;n<s;n++){let o=e.data[n];s>1&&!o._checkCollision(t)||this._collideForSubMesh(o,i,t)}return this}_shouldConvertRHS(){return!1}_checkCollision(t){if(!this.getBoundingInfo()._checkCollision(t))return this;let i=d.Matrix[0],e=d.Matrix[1];return v.ScalingToRef(1/t._radius.x,1/t._radius.y,1/t._radius.z,i),this.worldMatrixFromCache.multiplyToRef(i,e),this._processCollisionsForSubMeshes(t,e),this}_generatePointsArray(){return!1}intersects(t,i,e,s=!1,n,o=!1){let a=new vt,c=this.getClassName(),h=c==="InstancedLinesMesh"||c==="LinesMesh"||c==="GreasedLineMesh"?this.intersectionThreshold:0,u=this.getBoundingInfo();if(!this.subMeshes||!o&&(!t.intersectsSphere(u.boundingSphere,h)||!t.intersectsBox(u.boundingBox,h)))return a;if(s)return a.hit=!o,a.pickedMesh=o?null:this,a.distance=o?0:m.Distance(t.origin,u.boundingSphere.center),a.subMeshId=0,a;if(!this._generatePointsArray())return a;let g=null,M=this._scene.getIntersectingSubMeshCandidates(this,t),r=M.length,p=!1;for(let _=0;_<r;_++){let b=M.data[_].getMaterial();if(b&&(b.fillMode==7||b.fillMode==0||b.fillMode==1||b.fillMode==2||b.fillMode==4)){p=!0;break}}if(!p)return a.hit=!0,a.pickedMesh=this,a.distance=m.Distance(t.origin,u.boundingSphere.center),a.subMeshId=-1,a;for(let _=0;_<r;_++){let D=M.data[_];if(r>1&&!o&&!D.canIntersects(t))continue;let b=D.intersects(t,this._positions,this.getIndices(),i,e);if(b&&(i||!g||b.distance<g.distance)&&(g=b,g.subMeshId=D._id,g._internalSubMeshId=_,i))break}if(g){let _=n??this.getWorldMatrix(),D=d.Vector3[0],b=d.Vector3[1];m.TransformCoordinatesToRef(t.origin,_,D),t.direction.scaleToRef(g.distance,b);let C=m.TransformNormal(b,_).addInPlace(D);return a.hit=!0,a.distance=m.Distance(D,C),a.pickedPoint=C,a.pickedMesh=this,a.bu=g.bu||0,a.bv=g.bv||0,a.subMeshFaceId=g.faceId,a.faceId=g.faceId+M.data[g._internalSubMeshId].indexStart/(this.getClassName().indexOf("LinesMesh")!==-1?2:3),a.subMeshId=g.subMeshId,a}return a}clone(t,i,e){return null}releaseSubMeshes(t=!1){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose(t);else this.subMeshes=[];return this}dispose(t,i=!1){let e,s=this.getScene();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),s.freeActiveMeshes(),s.freeRenderingGroups(),s.renderingManager.maintainStateBetweenFrames&&s.renderingManager.restoreDispachedFlags(),this.actionManager!==void 0&&this.actionManager!==null&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some(a=>a!==this&&a.actionManager===this.actionManager)&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),e=0;e<this._intersectionsInProgress.length;e++){let a=this._intersectionsInProgress[e],c=a._intersectionsInProgress.indexOf(this);a._intersectionsInProgress.splice(c,1)}this._intersectionsInProgress.length=0;let n=s.lights;for(let a of n){let c=a.includedOnlyMeshes.indexOf(this);c!==-1&&a.includedOnlyMeshes.splice(c,1),c=a.excludedMeshes.indexOf(this),c!==-1&&a.excludedMeshes.splice(c,1);let h=a.getShadowGenerators();if(h){let u=h.values();for(let g=u.next();g.done!==!0;g=u.next()){let r=g.value.getShadowMap();r&&r.renderList&&(c=r.renderList.indexOf(this),c!==-1&&r.renderList.splice(c,1))}}}(this.getClassName()!=="InstancedMesh"||this.getClassName()!=="InstancedLinesMesh")&&this.releaseSubMeshes(!0);let o=s.getEngine();if(this._occlusionQuery!==null&&(this.isOcclusionQueryInProgress=!1,o.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),o.wipeCaches(),s.removeMesh(this),this._parentContainer){let a=this._parentContainer.meshes.indexOf(this);a>-1&&this._parentContainer.meshes.splice(a,1),this._parentContainer=null}if(i&&this.material&&(this.material.getClassName()==="MultiMaterial"?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!t)for(e=0;e<s.particleSystems.length;e++)s.particleSystems[e].emitter===this&&(s.particleSystems[e].dispose(),e--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(t,i)}_initFacetData(){let t=this._internalAbstractMeshDataInfo._facetData;t.facetNormals||(t.facetNormals=[]),t.facetPositions||(t.facetPositions=[]),t.facetPartitioning||(t.facetPartitioning=new Array),t.facetNb=this.getIndices().length/3|0,t.partitioningSubdivisions=t.partitioningSubdivisions?t.partitioningSubdivisions:10,t.partitioningBBoxRatio=t.partitioningBBoxRatio?t.partitioningBBoxRatio:1.01;for(let i=0;i<t.facetNb;i++)t.facetNormals[i]=m.Zero(),t.facetPositions[i]=m.Zero();return t.facetDataEnabled=!0,this}updateFacetData(){let t=this._internalAbstractMeshDataInfo._facetData;t.facetDataEnabled||this._initFacetData();let i=this.getVerticesData(l.PositionKind),e=this.getIndices(),s=this.getVerticesData(l.NormalKind),n=this.getBoundingInfo();if(t.facetDepthSort&&!t.facetDepthSortEnabled){if(t.facetDepthSortEnabled=!0,e instanceof Uint16Array)t.depthSortedIndices=new Uint16Array(e);else if(e instanceof Uint32Array)t.depthSortedIndices=new Uint32Array(e);else{let a=!1;for(let c=0;c<e.length;c++)if(e[c]>65535){a=!0;break}a?t.depthSortedIndices=new Uint32Array(e):t.depthSortedIndices=new Uint16Array(e)}if(t.facetDepthSortFunction=function(a,c){return c.sqDistance-a.sqDistance},!t.facetDepthSortFrom){let a=this.getScene().activeCamera;t.facetDepthSortFrom=a?a.position:m.Zero()}t.depthSortedFacets=[];for(let a=0;a<t.facetNb;a++){let c={ind:a*3,sqDistance:0};t.depthSortedFacets.push(c)}t.invertedMatrix=v.Identity(),t.facetDepthSortOrigin=m.Zero()}t.bbSize.x=n.maximum.x-n.minimum.x>K?n.maximum.x-n.minimum.x:K,t.bbSize.y=n.maximum.y-n.minimum.y>K?n.maximum.y-n.minimum.y:K,t.bbSize.z=n.maximum.z-n.minimum.z>K?n.maximum.z-n.minimum.z:K;let o=t.bbSize.x>t.bbSize.y?t.bbSize.x:t.bbSize.y;if(o=o>t.bbSize.z?o:t.bbSize.z,t.subDiv.max=t.partitioningSubdivisions,t.subDiv.X=Math.floor(t.subDiv.max*t.bbSize.x/o),t.subDiv.Y=Math.floor(t.subDiv.max*t.bbSize.y/o),t.subDiv.Z=Math.floor(t.subDiv.max*t.bbSize.z/o),t.subDiv.X=t.subDiv.X<1?1:t.subDiv.X,t.subDiv.Y=t.subDiv.Y<1?1:t.subDiv.Y,t.subDiv.Z=t.subDiv.Z<1?1:t.subDiv.Z,t.facetParameters.facetNormals=this.getFacetLocalNormals(),t.facetParameters.facetPositions=this.getFacetLocalPositions(),t.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),t.facetParameters.bInfo=n,t.facetParameters.bbSize=t.bbSize,t.facetParameters.subDiv=t.subDiv,t.facetParameters.ratio=this.partitioningBBoxRatio,t.facetParameters.depthSort=t.facetDepthSort,t.facetDepthSort&&t.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(t.invertedMatrix),m.TransformCoordinatesToRef(t.facetDepthSortFrom,t.invertedMatrix,t.facetDepthSortOrigin),t.facetParameters.distanceTo=t.facetDepthSortOrigin),t.facetParameters.depthSortedFacets=t.depthSortedFacets,s&&w.ComputeNormals(i,e,s,t.facetParameters),t.facetDepthSort&&t.facetDepthSortEnabled){t.depthSortedFacets.sort(t.facetDepthSortFunction);let a=t.depthSortedIndices.length/3|0;for(let c=0;c<a;c++){let h=t.depthSortedFacets[c].ind;t.depthSortedIndices[c*3]=e[h],t.depthSortedIndices[c*3+1]=e[h+1],t.depthSortedIndices[c*3+2]=e[h+2]}this.updateIndices(t.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){let t=this._internalAbstractMeshDataInfo._facetData;return t.facetNormals||this.updateFacetData(),t.facetNormals}getFacetLocalPositions(){let t=this._internalAbstractMeshDataInfo._facetData;return t.facetPositions||this.updateFacetData(),t.facetPositions}getFacetLocalPartitioning(){let t=this._internalAbstractMeshDataInfo._facetData;return t.facetPartitioning||this.updateFacetData(),t.facetPartitioning}getFacetPosition(t){let i=m.Zero();return this.getFacetPositionToRef(t,i),i}getFacetPositionToRef(t,i){let e=this.getFacetLocalPositions()[t],s=this.getWorldMatrix();return m.TransformCoordinatesToRef(e,s,i),this}getFacetNormal(t){let i=m.Zero();return this.getFacetNormalToRef(t,i),i}getFacetNormalToRef(t,i){let e=this.getFacetLocalNormals()[t];return m.TransformNormalToRef(e,this.getWorldMatrix(),i),this}getFacetsAtLocalCoordinates(t,i,e){let s=this.getBoundingInfo(),n=this._internalAbstractMeshDataInfo._facetData,o=Math.floor((t-s.minimum.x*n.partitioningBBoxRatio)*n.subDiv.X*n.partitioningBBoxRatio/n.bbSize.x),a=Math.floor((i-s.minimum.y*n.partitioningBBoxRatio)*n.subDiv.Y*n.partitioningBBoxRatio/n.bbSize.y),c=Math.floor((e-s.minimum.z*n.partitioningBBoxRatio)*n.subDiv.Z*n.partitioningBBoxRatio/n.bbSize.z);return o<0||o>n.subDiv.max||a<0||a>n.subDiv.max||c<0||c>n.subDiv.max?null:n.facetPartitioning[o+n.subDiv.max*a+n.subDiv.max*n.subDiv.max*c]}getClosestFacetAtCoordinates(t,i,e,s,n=!1,o=!0){let a=this.getWorldMatrix(),c=d.Matrix[5];a.invertToRef(c);let h=d.Vector3[8];m.TransformCoordinatesFromFloatsToRef(t,i,e,c,h);let u=this.getClosestFacetAtLocalCoordinates(h.x,h.y,h.z,s,n,o);return s&&m.TransformCoordinatesFromFloatsToRef(s.x,s.y,s.z,a,s),u}getClosestFacetAtLocalCoordinates(t,i,e,s,n=!1,o=!0){let a=null,c=0,h=0,u=0,g=0,M=0,r=0,p=0,_=0,D=this.getFacetLocalPositions(),b=this.getFacetLocalNormals(),A=this.getFacetsAtLocalCoordinates(t,i,e);if(!A)return null;let C=Number.MAX_VALUE,y=C,S,x,F;for(let V=0;V<A.length;V++)S=A[V],x=b[S],F=D[S],g=(t-F.x)*x.x+(i-F.y)*x.y+(e-F.z)*x.z,(!n||n&&o&&g>=0||n&&!o&&g<=0)&&(g=x.x*F.x+x.y*F.y+x.z*F.z,M=-(x.x*t+x.y*i+x.z*e-g)/(x.x*x.x+x.y*x.y+x.z*x.z),r=t+x.x*M,p=i+x.y*M,_=e+x.z*M,c=r-t,h=p-i,u=_-e,y=c*c+h*h+u*u,y<C&&(C=y,a=S,s&&(s.x=r,s.y=p,s.z=_)));return a}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){let t=this._internalAbstractMeshDataInfo._facetData;return t.facetDataEnabled&&(t.facetDataEnabled=!1,t.facetPositions=[],t.facetNormals=[],t.facetPartitioning=new Array,t.facetParameters={},t.depthSortedIndices=new Uint32Array(0)),this}updateIndices(t,i,e=!1){return this}createNormals(t){let i=this.getVerticesData(l.PositionKind),e=this.getIndices(),s;return this.isVerticesDataPresent(l.NormalKind)?s=this.getVerticesData(l.NormalKind):s=[],w.ComputeNormals(i,e,s,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(l.NormalKind,s,t),this}optimizeIndicesAsync(){return it(this,null,function*(){let t=this.getIndices();if(!t)return this;let{OptimizeIndices:i}=yield import("./chunk-S2JVYXF4.js");return i(t),this.setIndices(t,this.getTotalVertices()),this})}alignWithNormal(t,i){i||(i=xt.Y);let e=d.Vector3[0],s=d.Vector3[1];return m.CrossToRef(i,t,s),m.CrossToRef(t,s,e),this.rotationQuaternion?P.RotationQuaternionFromAxisToRef(e,t,s,this.rotationQuaternion):m.RotationFromAxisToRef(e,t,s,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw R("EdgesRenderer")}enableEdgesRendering(t,i,e){throw R("EdgesRenderer")}getConnectedParticleSystems(){return this._scene.particleSystems.filter(t=>t.emitter===this)}};E.OCCLUSION_TYPE_NONE=0;E.OCCLUSION_TYPE_OPTIMISTIC=1;E.OCCLUSION_TYPE_STRICT=2;E.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0;E.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1;E.CULLINGSTRATEGY_STANDARD=0;E.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1;E.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2;E.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3;T([U.filter((...[f,t,i,e,s])=>!Array.isArray(f)&&!Array.isArray(t)&&!Array.isArray(i)&&!Array.isArray(e)&&!Array.isArray(s))],E,"_ApplySkeleton",null);pt("BABYLON.AbstractMesh",E);export{kt as a,ct as b,Qt as c,w as d,I as e,E as f};
