import{b as A}from"./chunk-U7MLFAZU.js";import{a as _}from"./chunk-A6K5JERA.js";import"./chunk-Z6SLAXJD.js";import"./chunk-ECE5LYUU.js";import{d as p,f as s,g as f}from"./chunk-3I5CJTBG.js";import"./chunk-ONJQLIA2.js";import"./chunk-ONKGPWX4.js";import"./chunk-YWVEFMAA.js";import"./chunk-7PKF2HBK.js";import"./chunk-ESU2LKTX.js";import"./chunk-WOSX534W.js";import"./chunk-UTB7MUBH.js";import"./chunk-DTW6C2NU.js";import"./chunk-4L3AMN6L.js";import"./chunk-BBMLNH3A.js";import"./chunk-DXIW36IF.js";import"./chunk-FJN7KTAM.js";import"./chunk-ADGVNOWV.js";import"./chunk-RPO3NA2D.js";import"./chunk-MUVVFX4O.js";import"./chunk-CO7QZEHY.js";import"./chunk-TZYBJFW2.js";import"./chunk-MZYVXJQS.js";import"./chunk-TYRUT66Y.js";import"./chunk-GCSIM5MW.js";import"./chunk-2LR3BD57.js";import"./chunk-QCR5HLUD.js";import"./chunk-G5DRJZ63.js";import"./chunk-IMSFUDDL.js";import"./chunk-5T7GZZEX.js";import"./chunk-NHIHMT2T.js";import"./chunk-CW5F3XFN.js";import"./chunk-NPZEPKVW.js";import"./chunk-FWZ75RMU.js";import"./chunk-OPJEXU7D.js";import"./chunk-YFTPYCF4.js";import"./chunk-YZWYFFYQ.js";import"./chunk-5H5AAOGY.js";import"./chunk-J7UYENZA.js";import"./chunk-CCUABLZY.js";import"./chunk-LYHSKFCL.js";import"./chunk-5SDLENZK.js";import"./chunk-XXSLHR3E.js";import{a as G}from"./chunk-3WG2WLZ4.js";import"./chunk-ZUHEGR2G.js";import"./chunk-XI4OBPMN.js";import"./chunk-SO644OCK.js";import"./chunk-CXW3WAWT.js";import"./chunk-A3WFPZFR.js";import"./chunk-CWQQB2EJ.js";import"./chunk-PMYBMJFK.js";import"./chunk-CJK33JLH.js";import"./chunk-PTJ4CXVK.js";import"./chunk-L3UYHT7M.js";import"./chunk-YVY7FGQB.js";var g=class extends _{constructor(i){super(i,["animationLoop","animationEnd","animationGroupLoop"]),this.config=i,this.speed=this.registerDataInput("speed",s),this.loop=this.registerDataInput("loop",f),this.from=this.registerDataInput("from",s,0),this.to=this.registerDataInput("to",s),this.currentFrame=this.registerDataOutput("currentFrame",s),this.currentTime=this.registerDataOutput("currentTime",s),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",p),this.animationGroup=this.registerDataInput("animationGroup",p,i?.animationGroup),this.animation=this.registerDataInput("animation",p),this.object=this.registerDataInput("object",p)}_preparePendingTasks(i){let t=this.animationGroup.getValue(i),r=this.animation.getValue(i);if(!t&&!r)return this._reportError(i,"No animation or animation group provided");{let e=this.currentAnimationGroup.getValue(i);e&&e!==t&&e.dispose();let n=t;if(r&&!n){let o=this.object.getValue(i);if(!o)return this._reportError(i,"No target object provided");let h=Array.isArray(r)?r:[r],y=h[0].name;n=new A("flowGraphAnimationGroup-"+y+"-"+o.name,i.configuration.scene);let c=!1,V=i._getGlobalContextVariable("interpolationAnimations",[]);for(let d of h)n.addTargetedAnimation(d,o),V.indexOf(d.uniqueId)!==-1&&(c=!0);c&&this._checkInterpolationDuplications(i,h,o)}let u=this.speed.getValue(i)||1,a=this.from.getValue(i)??0,m=this.to.getValue(i)||n.to,b=!isFinite(m)||this.loop.getValue(i);this.currentAnimationGroup.setValue(n,i);let l=i._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);l.indexOf(n.uniqueId)!==-1&&n.stop();try{n.start(b,u,a,m),n.onAnimationGroupEndObservable.add(()=>this._onAnimationGroupEnd(i)),n.onAnimationEndObservable.add(()=>this._eventsSignalOutputs.animationEnd._activateSignal(i)),n.onAnimationLoopObservable.add(()=>this._eventsSignalOutputs.animationLoop._activateSignal(i)),n.onAnimationGroupLoopObservable.add(()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(i)),l.push(n.uniqueId),i._setGlobalContextVariable("currentlyRunningAnimationGroups",l)}catch(o){this._reportError(i,o)}}}_reportError(i,t){super._reportError(i,t),this.currentFrame.setValue(-1,i),this.currentTime.setValue(-1,i)}_executeOnTick(i){let t=this.currentAnimationGroup.getValue(i);t&&(this.currentFrame.setValue(t.getCurrentFrame(),i),this.currentTime.setValue(t.animatables[0]?.elapsedTime??0,i))}_execute(i){this._startPendingTasks(i)}_onAnimationGroupEnd(i){this._removeFromCurrentlyRunning(i,this.currentAnimationGroup.getValue(i)),this._resetAfterCanceled(i),this.done._activateSignal(i)}_checkInterpolationDuplications(i,t,r){let e=i._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(let n of e){let u=i.assetsContext.animationGroups.find(a=>a.uniqueId===n);if(u)for(let a of u.targetedAnimations)for(let m of t)a.animation.targetProperty===m.targetProperty&&a.target===r&&this._stopAnimationGroup(i,u)}}_stopAnimationGroup(i,t){t.stop(!0),t.dispose(),this._removeFromCurrentlyRunning(i,t)}_removeFromCurrentlyRunning(i,t){let r=i._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),e=r.indexOf(t.uniqueId);e!==-1&&(r.splice(e,1),i._setGlobalContextVariable("currentlyRunningAnimationGroups",r))}_cancelPendingTasks(i){let t=this.currentAnimationGroup.getValue(i);t&&this._stopAnimationGroup(i,t)}getClassName(){return"FlowGraphPlayAnimationBlock"}};G("FlowGraphPlayAnimationBlock",g);export{g as FlowGraphPlayAnimationBlock};
