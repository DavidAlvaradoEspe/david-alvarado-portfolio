import{c as b}from"./chunk-DE7K33UC.js";import{d as m}from"./chunk-FWZ75RMU.js";import{e as v,f as W}from"./chunk-6KAGRIFJ.js";import{a as w,q as A}from"./chunk-CCUABLZY.js";var c=class{static extractMinAndMaxIndexed(e,t,n,a,i,r){for(let s=n;s<n+a;s++){let o=t[s]*3,h=e[o],u=e[o+1],l=e[o+2];i.minimizeInPlaceFromFloats(h,u,l),r.maximizeInPlaceFromFloats(h,u,l)}}static extractMinAndMax(e,t,n,a,i,r){for(let s=t,o=t*a;s<t+n;s++,o+=a){let h=e[o],u=e[o+1],l=e[o+2];i.minimizeInPlaceFromFloats(h,u,l),r.maximizeInPlaceFromFloats(h,u,l)}}};w([A.filter((...[d,e])=>!Array.isArray(d)&&!Array.isArray(e))],c,"extractMinAndMaxIndexed",null);w([A.filter((...[d])=>!Array.isArray(d))],c,"extractMinAndMax",null);function y(d,e,t,n,a=null){let i=new m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return c.extractMinAndMaxIndexed(d,e,t,n,i,r),a&&(i.x-=i.x*a.x+a.y,i.y-=i.y*a.x+a.y,i.z-=i.z*a.x+a.y,r.x+=r.x*a.x+a.y,r.y+=r.y*a.x+a.y,r.z+=r.z*a.x+a.y),{minimum:i,maximum:r}}function V(d,e,t,n=null,a){let i=new m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return a||(a=3),c.extractMinAndMax(d,e,t,a,i,r),n&&(i.x-=i.x*n.x+n.y,i.y-=i.y*n.x+n.y,i.z-=i.z*n.x+n.y,r.x+=r.x*n.x+n.y,r.y+=r.y*n.x+n.y,r.z+=r.z*n.x+n.y),{minimum:i,maximum:r}}var x=class{constructor(e,t,n){this.bu=e,this.bv=t,this.distance=n,this.faceId=0,this.subMeshId=0,this._internalSubMeshId=0}};var B=class d{get materialDefines(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:this._getDrawWrapper()?.defines}set materialDefines(e){let t=this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0);t.defines=e}_getDrawWrapper(e,t=!1){e=e??this._engine.currentRenderPassId;let n=this._drawWrappers[e];return!n&&t&&(this._drawWrappers[e]=n=new W(this._mesh.getScene().getEngine())),n}_removeDrawWrapper(e,t=!0,n=!1){t&&this._drawWrappers[e]?.dispose(n),this._drawWrappers[e]=void 0}get effect(){return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:this._getDrawWrapper()?.effect??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(e){this._mainDrawWrapperOverride=e}setEffect(e,t=null,n,a=!0){let i=this._drawWrapper;i.setEffect(e,t,a),n!==void 0&&(i.materialContext=n),e||(i.defines=null,i.materialContext=void 0)}resetDrawCache(e,t=!1){if(this._drawWrappers)if(e!==void 0){this._removeDrawWrapper(e,!0,t);return}else for(let n of this._drawWrappers)n?.dispose(t);this._drawWrappers=[]}static AddToMesh(e,t,n,a,i,r,s,o=!0){return new d(e,t,n,a,i,r,s,o)}constructor(e,t,n,a,i,r,s,o=!0,h=!0){this.materialIndex=e,this.verticesStart=t,this.verticesCount=n,this.indexStart=a,this.indexCount=i,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=r,this._renderingMesh=s||r,h&&r.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=r.subMeshes.length-1,o&&(this.refreshBoundingInfo(),r.computeWorldMatrix(!0))}get IsGlobal(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()&&this.indexStart===0&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(e){return this._boundingInfo=e,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){let e=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return e||this._renderingMesh}getMaterial(e=!0){let t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(t){if(this._isMultiMaterial(t)){let n=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==n&&(this._currentMaterial=n,this.resetDrawCache()),n}}else return e&&this._mesh.getScene()._hasDefaultMaterial?this._mesh.getScene().defaultMaterial:null;return t}_isMultiMaterial(e){return e.getSubMaterial!==void 0}refreshBoundingInfo(e=null){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(v.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;let t=this._renderingMesh.getIndices(),n;if(this.indexStart===0&&this.indexCount===t.length){let a=this._renderingMesh.getBoundingInfo();n={minimum:a.minimum.clone(),maximum:a.maximum.clone()}}else n=y(e,t,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new b(n.minimum,n.maximum),this}_checkCollision(e){return this.getBoundingInfo()._checkCollision(e)}updateBoundingInfo(e){let t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this}isInFrustum(e){let t=this.getBoundingInfo();return t?t.isInFrustum(e,this._mesh.cullingStrategy):!1}isCompletelyInFrustum(e){let t=this.getBoundingInfo();return t?t.isCompletelyInFrustum(e):!1}render(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(e,t){if(!this._linesIndexBuffer){let n=Math.floor(this.indexCount/3)*6,i=this.verticesStart+this.verticesCount>65535?new Uint32Array(n):new Uint16Array(n),r=0;if(e.length===0)for(let s=this.indexStart;s<this.indexStart+this.indexCount;s+=3)i[r++]=s,i[r++]=s+1,i[r++]=s+1,i[r++]=s+2,i[r++]=s+2,i[r++]=s;else for(let s=this.indexStart;s<this.indexStart+this.indexCount;s+=3)i[r++]=e[s],i[r++]=e[s+1],i[r++]=e[s+1],i[r++]=e[s+2],i[r++]=e[s+2],i[r++]=e[s];this._linesIndexBuffer=t.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer}canIntersects(e){let t=this.getBoundingInfo();return t?e.intersectsBox(t.boundingBox):!1}intersects(e,t,n,a,i){let r=this.getMaterial();if(!r)return null;let s=3,o=!1;switch(r.fillMode){case 3:case 5:case 6:case 8:return null;case 7:s=1,o=!0;break;default:break}return r.fillMode===4?n.length?this._intersectLines(e,t,n,this._mesh.intersectionThreshold,a):this._intersectUnIndexedLines(e,t,n,this._mesh.intersectionThreshold,a):!n.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,n,a,i):this._intersectTriangles(e,t,n,s,o,a,i)}_intersectLines(e,t,n,a,i){let r=null;for(let s=this.indexStart;s<this.indexStart+this.indexCount;s+=2){let o=t[n[s]],h=t[n[s+1]],u=e.intersectionSegment(o,h,a);if(!(u<0)&&(i||!r||u<r.distance)&&(r=new x(null,null,u),r.faceId=s/2,i))break}return r}_intersectUnIndexedLines(e,t,n,a,i){let r=null;for(let s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=2){let o=t[s],h=t[s+1],u=e.intersectionSegment(o,h,a);if(!(u<0)&&(i||!r||u<r.distance)&&(r=new x(null,null,u),r.faceId=s/2,i))break}return r}_intersectTriangles(e,t,n,a,i,r,s){let o=null,h=-1;for(let u=this.indexStart;u<this.indexStart+this.indexCount-(3-a);u+=a){h++;let l=n[u],f=n[u+1],g=n[u+2];if(i&&g===4294967295){u+=2;continue}let I=t[l],p=t[f],M=t[g];if(!I||!p||!M||s&&!s(I,p,M,e,l,f,g))continue;let _=e.intersectsTriangle(I,p,M);if(_){if(_.distance<0)continue;if((r||!o||_.distance<o.distance)&&(o=_,o.faceId=h,r))break}}return o}_intersectUnIndexedTriangles(e,t,n,a,i){let r=null;for(let s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=3){let o=t[s],h=t[s+1],u=t[s+2];if(i&&!i(o,h,u,e,-1,-1,-1))continue;let l=e.intersectsTriangle(o,h,u);if(l){if(l.distance<0)continue;if((a||!r||l.distance<r.distance)&&(r=l,r.faceId=s/3,a))break}}return r}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(e,t){let n=new d(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){let a=this.getBoundingInfo();if(!a)return n;n._boundingInfo=new b(a.minimum,a.maximum)}return n}dispose(e=!1){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);let t=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(t,1),this.resetDrawCache(void 0,e)}getClassName(){return"SubMesh"}static CreateFromIndices(e,t,n,a,i,r=!0){let s=Number.MAX_VALUE,o=-Number.MAX_VALUE,u=(i||a).getIndices();for(let l=t;l<t+n;l++){let f=u[l];f<s&&(s=f),f>o&&(o=f)}return new d(e,s,o-s+1,t,n,a,i,r)}};export{x as a,V as b,B as c};
