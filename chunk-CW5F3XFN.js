import{a as A,b as k}from"./chunk-NPZEPKVW.js";import{c as y,d as T,f as P,g as h}from"./chunk-FWZ75RMU.js";import{b as g}from"./chunk-CCUABLZY.js";import{a as d}from"./chunk-A3WFPZFR.js";var m=class o{static Eval(e,r){return e.match(/\([^()]*\)/g)?e=e.replace(/\([^()]*\)/g,s=>(s=s.slice(1,s.length-1),o._HandleParenthesisContent(s,r))):e=o._HandleParenthesisContent(e,r),e==="true"?!0:e==="false"?!1:o.Eval(e,r)}static _HandleParenthesisContent(e,r){r=r||(i=>i==="true");let s,n=e.split("||");for(let i in n)if(Object.prototype.hasOwnProperty.call(n,i)){let c=o._SimplifyNegation(n[i].trim()),a=c.split("&&");if(a.length>1)for(let p=0;p<a.length;++p){let t=o._SimplifyNegation(a[p].trim());if(t!=="true"&&t!=="false"?t[0]==="!"?s=!r(t.substring(1)):s=r(t):s=t==="true",!s){c="false";break}}if(s||c==="true"){s=!0;break}c!=="true"&&c!=="false"?c[0]==="!"?s=!r(c.substring(1)):s=r(c):s=c==="true"}return s?"true":"false"}static _SimplifyNegation(e){return e=e.replace(/^[\s!]+/,r=>(r=r.replace(/[\s]/g,()=>""),r.length%2?"!":"")),e=e.trim(),e==="!true"?e="false":e==="!false"&&(e="true"),e}};var f=class o{static EnableFor(e){e._tags=e._tags||{},e.hasTags=()=>o.HasTags(e),e.addTags=r=>o.AddTagsTo(e,r),e.removeTags=r=>o.RemoveTagsFrom(e,r),e.matchesTagsQuery=r=>o.MatchesQuery(e,r)}static DisableFor(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery}static HasTags(e){if(!e._tags)return!1;let r=e._tags;for(let s in r)if(Object.prototype.hasOwnProperty.call(r,s))return!0;return!1}static GetTags(e,r=!0){if(!e._tags)return null;if(r){let s=[];for(let n in e._tags)Object.prototype.hasOwnProperty.call(e._tags,n)&&e._tags[n]===!0&&s.push(n);return s.join(" ")}else return e._tags}static AddTagsTo(e,r){if(!r||typeof r!="string")return;let s=r.split(" ");for(let n of s)o._AddTagTo(e,n)}static _AddTagTo(e,r){r=r.trim(),!(r===""||r==="true"||r==="false")&&(r.match(/[\s]/)||r.match(/^([!]|([|]|[&]){2})/)||(o.EnableFor(e),e._tags[r]=!0))}static RemoveTagsFrom(e,r){if(!o.HasTags(e))return;let s=r.split(" ");for(let n in s)o._RemoveTagFrom(e,s[n])}static _RemoveTagFrom(e,r){delete e._tags[r]}static MatchesQuery(e,r){return r===void 0?!0:r===""?o.HasTags(e):m.Eval(r,s=>o.HasTags(e)&&e._tags[s])}};var I=function(o,e,r,s={}){let n=o();f&&f.HasTags(e)&&f.AddTagsTo(n,f.GetTags(e,!0));let i=g(n),c={};for(let a in i){let p=i[a],t=e[a],l=p.type;if(t!=null&&(a!=="uniqueId"||F.AllowLoadingUniqueId))switch(l){case 0:case 6:case 9:case 11:n[a]=t;break;case 1:s.cloneTexturesOnlyOnce&&c[t.uniqueId]?n[a]=c[t.uniqueId]:(n[a]=r||t.isRenderTarget?t:t.clone(),c[t.uniqueId]=n[a]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:n[a]=r?t:t.clone();break}}return n},F=(()=>{class o{static AppendSerializedAnimations(r,s){if(r.animations){s.animations=[];for(let n=0;n<r.animations.length;n++){let i=r.animations[n];s.animations.push(i.serialize())}}}static Serialize(r,s){s||(s={}),f&&(s.tags=f.GetTags(r));let n=g(r);for(let i in n){let c=n[i],a=c.sourceName||i,p=c.type,t=r[i];if(t!=null&&(i!=="uniqueId"||o.AllowLoadingUniqueId))switch(p){case 0:Array.isArray(t)?s[a]=t.slice():s[a]=t;break;case 1:s[a]=t.serialize();break;case 2:s[a]=t.asArray();break;case 3:s[a]=t.serialize();break;case 4:s[a]=t.asArray();break;case 5:s[a]=t.asArray();break;case 6:s[a]=t.id;break;case 7:s[a]=t.serialize();break;case 8:s[a]=t.asArray();break;case 9:s[a]=t.serialize();break;case 10:s[a]=t.asArray();break;case 11:s[a]=t.id;break;case 12:s[a]=t.asArray();break}}return s}static ParseProperties(r,s,n,i){i||(i="");let c=g(s);for(let a in c){let p=c[a],t=r[p.sourceName||a],l=p.type;if(t!=null&&(a!=="uniqueId"||o.AllowLoadingUniqueId)){let u=s;switch(l){case 0:u[a]=t;break;case 1:n&&(u[a]=o._TextureParser(t,n,i));break;case 2:u[a]=A.FromArray(t);break;case 3:u[a]=o._FresnelParametersParser(t);break;case 4:u[a]=y.FromArray(t);break;case 5:u[a]=T.FromArray(t);break;case 6:n&&(u[a]=n.getLastMeshById(t));break;case 7:u[a]=o._ColorCurvesParser(t);break;case 8:u[a]=k.FromArray(t);break;case 9:u[a]=o._ImageProcessingConfigurationParser(t);break;case 10:u[a]=P.FromArray(t);break;case 11:n&&(u[a]=n.getCameraById(t));break;case 12:u[a]=h.FromArray(t);break}}}}static Parse(r,s,n,i=null){let c=r();return f&&f.AddTagsTo(c,s.tags),o.ParseProperties(s,c,n,i),c}static Clone(r,s,n={}){return I(r,s,!1,n)}static Instanciate(r,s){return I(r,s,!0)}}return o.AllowLoadingUniqueId=!1,o._ImageProcessingConfigurationParser=e=>{throw d("ImageProcessingConfiguration")},o._FresnelParametersParser=e=>{throw d("FresnelParameters")},o._ColorCurvesParser=e=>{throw d("ColorCurves")},o._TextureParser=(e,r,s)=>{throw d("Texture")},o})();export{f as a,F as b};
