import{c as T,d as i,g as W,h as p}from"./chunk-FWZ75RMU.js";import{d as R,e as y}from"./chunk-OPJEXU7D.js";import{e as b}from"./chunk-6KAGRIFJ.js";var _=class{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(t=!1,r=!0){if(!this.pickedMesh||r&&!this.pickedMesh.isVerticesDataPresent(b.NormalKind))return null;let e=this.pickedMesh.getIndices();e?.length===0&&(e=null);let s,n=p.Vector3[0],c=p.Vector3[1],a=p.Vector3[2];if(r){let o=this.pickedMesh.getVerticesData(b.NormalKind),m=e?i.FromArrayToRef(o,e[this.faceId*3]*3,n):n.copyFromFloats(o[this.faceId*3*3],o[this.faceId*3*3+1],o[this.faceId*3*3+2]),d=e?i.FromArrayToRef(o,e[this.faceId*3+1]*3,c):c.copyFromFloats(o[(this.faceId*3+1)*3],o[(this.faceId*3+1)*3+1],o[(this.faceId*3+1)*3+2]),h=e?i.FromArrayToRef(o,e[this.faceId*3+2]*3,a):a.copyFromFloats(o[(this.faceId*3+2)*3],o[(this.faceId*3+2)*3+1],o[(this.faceId*3+2)*3+2]);m=m.scale(this.bu),d=d.scale(this.bv),h=h.scale(1-this.bu-this.bv),s=new i(m.x+d.x+h.x,m.y+d.y+h.y,m.z+d.z+h.z)}else{let o=this.pickedMesh.getVerticesData(b.PositionKind),m=e?i.FromArrayToRef(o,e[this.faceId*3]*3,n):n.copyFromFloats(o[this.faceId*3*3],o[this.faceId*3*3+1],o[this.faceId*3*3+2]),d=e?i.FromArrayToRef(o,e[this.faceId*3+1]*3,c):c.copyFromFloats(o[(this.faceId*3+1)*3],o[(this.faceId*3+1)*3+1],o[(this.faceId*3+1)*3+2]),h=e?i.FromArrayToRef(o,e[this.faceId*3+2]*3,a):a.copyFromFloats(o[(this.faceId*3+2)*3],o[(this.faceId*3+2)*3+1],o[(this.faceId*3+2)*3+2]),x=m.subtract(d),g=h.subtract(d);s=i.Cross(x,g)}let l=(o,m)=>{if(this.thinInstanceIndex!==-1){let h=o.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];h&&i.TransformNormalToRef(m,h,m)}let d=o.getWorldMatrix();o.nonUniformScaling&&(p.Matrix[0].copyFrom(d),d=p.Matrix[0],d.setTranslationFromFloats(0,0,0),d.invert(),d.transposeToRef(p.Matrix[1]),d=p.Matrix[1]),i.TransformNormalToRef(m,d,m)};if(t&&l(this.pickedMesh,s),this.ray){let o=p.Vector3[0].copyFrom(s);t||l(this.pickedMesh,o),i.Dot(o,this.ray.direction)>0&&s.negateInPlace()}return s.normalize(),s}getTextureCoordinates(t=b.UVKind){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(t))return null;let r=this.pickedMesh.getIndices();if(!r)return null;let e=this.pickedMesh.getVerticesData(t);if(!e)return null;let s=T.FromArray(e,r[this.faceId*3]*2),n=T.FromArray(e,r[this.faceId*3+1]*2),c=T.FromArray(e,r[this.faceId*3+2]*2);return s=s.scale(this.bu),n=n.scale(this.bv),c=c.scale(1-this.bu-this.bv),new T(s.x+n.x+c.x,s.y+n.y+c.y)}};var F=class u{constructor(t,r,e){this.vectors=y(8,i.Zero),this.center=i.Zero(),this.centerWorld=i.Zero(),this.extendSize=i.Zero(),this.extendSizeWorld=i.Zero(),this.directions=y(3,i.Zero),this.vectorsWorld=y(8,i.Zero),this.minimumWorld=i.Zero(),this.maximumWorld=i.Zero(),this.minimum=i.Zero(),this.maximum=i.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(t,r,e)}reConstruct(t,r,e){let s=t.x,n=t.y,c=t.z,a=r.x,l=r.y,o=r.z,m=this.vectors;this.minimum.copyFromFloats(s,n,c),this.maximum.copyFromFloats(a,l,o),m[0].copyFromFloats(s,n,c),m[1].copyFromFloats(a,l,o),m[2].copyFromFloats(a,n,c),m[3].copyFromFloats(s,l,c),m[4].copyFromFloats(s,n,o),m[5].copyFromFloats(a,l,c),m[6].copyFromFloats(s,l,o),m[7].copyFromFloats(a,n,o),r.addToRef(t,this.center).scaleInPlace(.5),r.subtractToRef(t,this.extendSize).scaleInPlace(.5),this._worldMatrix=e||W.IdentityReadOnly,this._update(this._worldMatrix)}scale(t){let r=u._TmpVector3,e=this.maximum.subtractToRef(this.minimum,r[0]),s=e.length();e.normalizeFromLength(s);let n=s*t,c=e.scaleInPlace(n*.5),a=this.center.subtractToRef(c,r[1]),l=this.center.addToRef(c,r[2]);return this.reConstruct(a,l,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(t){let r=this.minimumWorld,e=this.maximumWorld,s=this.directions,n=this.vectorsWorld,c=this.vectors;if(t.isIdentity()){r.copyFrom(this.minimum),e.copyFrom(this.maximum);for(let a=0;a<8;++a)n[a].copyFrom(c[a]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{r.setAll(Number.MAX_VALUE),e.setAll(-Number.MAX_VALUE);for(let a=0;a<8;++a){let l=n[a];i.TransformCoordinatesToRef(c[a],t,l),r.minimizeInPlace(l),e.maximizeInPlace(l)}e.subtractToRef(r,this.extendSizeWorld).scaleInPlace(.5),e.addToRef(r,this.centerWorld).scaleInPlace(.5)}i.FromArrayToRef(t.m,0,s[0]),i.FromArrayToRef(t.m,4,s[1]),i.FromArrayToRef(t.m,8,s[2]),this._worldMatrix=t}isInFrustum(t){return u.IsInFrustum(this.vectorsWorld,t)}isCompletelyInFrustum(t){return u.IsCompletelyInFrustum(this.vectorsWorld,t)}intersectsPoint(t){let r=this.minimumWorld,e=this.maximumWorld,s=r.x,n=r.y,c=r.z,a=e.x,l=e.y,o=e.z,m=t.x,d=t.y,h=t.z,x=-R;return!(a-m<x||x>m-s||l-d<x||x>d-n||o-h<x||x>h-c)}intersectsSphere(t){return u.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)}intersectsMinMax(t,r){let e=this.minimumWorld,s=this.maximumWorld,n=e.x,c=e.y,a=e.z,l=s.x,o=s.y,m=s.z,d=t.x,h=t.y,x=t.z,g=r.x,B=r.y,z=r.z;return!(l<d||n>g||o<h||c>B||m<x||a>z)}dispose(){this._drawWrapperFront?.dispose(),this._drawWrapperBack?.dispose()}static Intersects(t,r){return t.intersectsMinMax(r.minimumWorld,r.maximumWorld)}static IntersectsSphere(t,r,e,s){let n=u._TmpVector3[0];return i.ClampToRef(e,t,r,n),i.DistanceSquared(e,n)<=s*s}static IsCompletelyInFrustum(t,r){for(let e=0;e<6;++e){let s=r[e];for(let n=0;n<8;++n)if(s.dotCoordinate(t[n])<0)return!1}return!0}static IsInFrustum(t,r){for(let e=0;e<6;++e){let s=!0,n=r[e];for(let c=0;c<8;++c)if(n.dotCoordinate(t[c])>=0){s=!1;break}if(s)return!1}return!0}};F._TmpVector3=y(3,i.Zero);var I=class u{constructor(t,r,e){this.center=i.Zero(),this.centerWorld=i.Zero(),this.minimum=i.Zero(),this.maximum=i.Zero(),this.reConstruct(t,r,e)}reConstruct(t,r,e){this.minimum.copyFrom(t),this.maximum.copyFrom(r);let s=i.Distance(t,r);r.addToRef(t,this.center).scaleInPlace(.5),this.radius=s*.5,this._update(e||W.IdentityReadOnly)}scale(t){let r=this.radius*t,e=u._TmpVector3,s=e[0].setAll(r),n=this.center.subtractToRef(s,e[1]),c=this.center.addToRef(s,e[2]);return this.reConstruct(n,c,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{i.TransformCoordinatesToRef(this.center,t,this.centerWorld);let r=u._TmpVector3[0];i.TransformNormalFromFloatsToRef(1,1,1,t,r),this.radiusWorld=Math.max(Math.abs(r.x),Math.abs(r.y),Math.abs(r.z))*this.radius}}isInFrustum(t){let r=this.centerWorld,e=this.radiusWorld;for(let s=0;s<6;s++)if(t[s].dotCoordinate(r)<=-e)return!1;return!0}isCenterInFrustum(t){let r=this.centerWorld;for(let e=0;e<6;e++)if(t[e].dotCoordinate(r)<0)return!1;return!0}intersectsPoint(t){let r=i.DistanceSquared(this.centerWorld,t);return!(this.radiusWorld*this.radiusWorld<r)}static Intersects(t,r){let e=i.DistanceSquared(t.centerWorld,r.centerWorld),s=t.radiusWorld+r.radiusWorld;return!(s*s<e)}static CreateFromCenterAndRadius(t,r,e){this._TmpVector3[0].copyFrom(t),this._TmpVector3[1].copyFromFloats(0,0,r),this._TmpVector3[2].copyFrom(t),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);let s=new u(this._TmpVector3[0],this._TmpVector3[2]);return e?s._worldMatrix=e:s._worldMatrix=W.Identity(),s}};I._TmpVector3=y(3,i.Zero);var M={min:0,max:0},C={min:0,max:0},S=(u,t,r)=>{let e=i.Dot(t.centerWorld,u),s=Math.abs(i.Dot(t.directions[0],u))*t.extendSize.x,n=Math.abs(i.Dot(t.directions[1],u))*t.extendSize.y,c=Math.abs(i.Dot(t.directions[2],u))*t.extendSize.z,a=s+n+c;r.min=e-a,r.max=e+a},f=(u,t,r)=>(S(u,t,M),S(u,r,C),!(M.min>C.max||C.min>M.max)),V=class u{constructor(t,r,e){this._isLocked=!1,this.boundingBox=new F(t,r,e),this.boundingSphere=new I(t,r,e)}reConstruct(t,r,e){this.boundingBox.reConstruct(t,r,e),this.boundingSphere.reConstruct(t,r,e)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(t){this._isLocked=t}update(t){this._isLocked||(this.boundingBox._update(t),this.boundingSphere._update(t))}centerOn(t,r){let e=u._TmpVector3[0].copyFrom(t).subtractInPlace(r),s=u._TmpVector3[1].copyFrom(t).addInPlace(r);return this.boundingBox.reConstruct(e,s,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(e,s,this.boundingBox.getWorldMatrix()),this}encapsulate(t){let r=i.Minimize(this.minimum,t),e=i.Maximize(this.maximum,t);return this.reConstruct(r,e,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(t){let r=p.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(r);let e=p.Vector3[0];return i.TransformCoordinatesToRef(t.boundingBox.minimumWorld,r,e),this.encapsulate(e),i.TransformCoordinatesToRef(t.boundingBox.maximumWorld,r,e),this.encapsulate(e),this}scale(t){return this.boundingBox.scale(t),this.boundingSphere.scale(t),this}isInFrustum(t,r=0){return(r===2||r===3)&&this.boundingSphere.isCenterInFrustum(t)?!0:this.boundingSphere.isInFrustum(t)?r===1||r===3?!0:this.boundingBox.isInFrustum(t):!1}get diagonalLength(){let t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,u._TmpVector3[0]).length()}isCompletelyInFrustum(t){return this.boundingBox.isCompletelyInFrustum(t)}_checkCollision(t){return t._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(t){return!(!this.boundingSphere.centerWorld||!this.boundingSphere.intersectsPoint(t)||!this.boundingBox.intersectsPoint(t))}intersects(t,r){if(!I.Intersects(this.boundingSphere,t.boundingSphere)||!F.Intersects(this.boundingBox,t.boundingBox))return!1;if(!r)return!0;let e=this.boundingBox,s=t.boundingBox;return!(!f(e.directions[0],e,s)||!f(e.directions[1],e,s)||!f(e.directions[2],e,s)||!f(s.directions[0],e,s)||!f(s.directions[1],e,s)||!f(s.directions[2],e,s)||!f(i.Cross(e.directions[0],s.directions[0]),e,s)||!f(i.Cross(e.directions[0],s.directions[1]),e,s)||!f(i.Cross(e.directions[0],s.directions[2]),e,s)||!f(i.Cross(e.directions[1],s.directions[0]),e,s)||!f(i.Cross(e.directions[1],s.directions[1]),e,s)||!f(i.Cross(e.directions[1],s.directions[2]),e,s)||!f(i.Cross(e.directions[2],s.directions[0]),e,s)||!f(i.Cross(e.directions[2],s.directions[1]),e,s)||!f(i.Cross(e.directions[2],s.directions[2]),e,s))}};V._TmpVector3=y(2,i.Zero);export{_ as a,I as b,V as c};
